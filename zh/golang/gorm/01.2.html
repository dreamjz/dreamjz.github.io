<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CRUD | 今朝のブログ</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
    <link rel="shortcut icon" herf="favicon.ico">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-3RQ3LRSTKM"></script>
    <script>window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
		  
			gtag('config', 'G-3RQ3LRSTKM');</script>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="google-site-verification" content="lHBWOiWCnBWvc1h4REqjllalv9ZpQbXbHDdM8chFuuw">
    
    <link rel="preload" href="/assets/css/0.styles.6a6b0998.css" as="style"><link rel="preload" href="/assets/js/app.b38e2a09.js" as="script"><link rel="preload" href="/assets/js/6.fb8c21e5.js" as="script"><link rel="preload" href="/assets/js/1.3bdf79e4.js" as="script"><link rel="preload" href="/assets/js/96.54e50cf2.js" as="script"><link rel="prefetch" href="/assets/js/10.52d329d9.js"><link rel="prefetch" href="/assets/js/100.c3cfb04d.js"><link rel="prefetch" href="/assets/js/101.bb4c0613.js"><link rel="prefetch" href="/assets/js/102.5bdcce1e.js"><link rel="prefetch" href="/assets/js/103.cecc8ef6.js"><link rel="prefetch" href="/assets/js/104.cb3b12df.js"><link rel="prefetch" href="/assets/js/105.f737c72b.js"><link rel="prefetch" href="/assets/js/106.10aaefaa.js"><link rel="prefetch" href="/assets/js/107.caba34f2.js"><link rel="prefetch" href="/assets/js/108.0f8ad604.js"><link rel="prefetch" href="/assets/js/109.a8bd3392.js"><link rel="prefetch" href="/assets/js/11.59f979f0.js"><link rel="prefetch" href="/assets/js/110.417f894f.js"><link rel="prefetch" href="/assets/js/111.0365e513.js"><link rel="prefetch" href="/assets/js/112.7547f273.js"><link rel="prefetch" href="/assets/js/113.cd31b696.js"><link rel="prefetch" href="/assets/js/114.ca7d243a.js"><link rel="prefetch" href="/assets/js/115.a167b046.js"><link rel="prefetch" href="/assets/js/116.bdda1e2a.js"><link rel="prefetch" href="/assets/js/117.24bdc7b0.js"><link rel="prefetch" href="/assets/js/118.1cba3d39.js"><link rel="prefetch" href="/assets/js/119.43c34142.js"><link rel="prefetch" href="/assets/js/12.dccfd9fb.js"><link rel="prefetch" href="/assets/js/120.a9de9dd8.js"><link rel="prefetch" href="/assets/js/121.c9639220.js"><link rel="prefetch" href="/assets/js/122.43ddb05a.js"><link rel="prefetch" href="/assets/js/123.6298a8e0.js"><link rel="prefetch" href="/assets/js/124.d96f03ff.js"><link rel="prefetch" href="/assets/js/125.59e466b9.js"><link rel="prefetch" href="/assets/js/126.edfb2ca5.js"><link rel="prefetch" href="/assets/js/127.75bbdd9a.js"><link rel="prefetch" href="/assets/js/128.bf7836c0.js"><link rel="prefetch" href="/assets/js/129.84729dcc.js"><link rel="prefetch" href="/assets/js/13.f5038764.js"><link rel="prefetch" href="/assets/js/130.acf06865.js"><link rel="prefetch" href="/assets/js/131.e43c2443.js"><link rel="prefetch" href="/assets/js/132.c5e9ed0b.js"><link rel="prefetch" href="/assets/js/133.3bd1c639.js"><link rel="prefetch" href="/assets/js/134.67cdf26d.js"><link rel="prefetch" href="/assets/js/14.ba6fc720.js"><link rel="prefetch" href="/assets/js/15.5e30188c.js"><link rel="prefetch" href="/assets/js/16.677c6212.js"><link rel="prefetch" href="/assets/js/17.165cf853.js"><link rel="prefetch" href="/assets/js/18.787abb1d.js"><link rel="prefetch" href="/assets/js/19.9cda970a.js"><link rel="prefetch" href="/assets/js/2.f099030c.js"><link rel="prefetch" href="/assets/js/20.53557f0e.js"><link rel="prefetch" href="/assets/js/21.dfb9a479.js"><link rel="prefetch" href="/assets/js/22.319b4229.js"><link rel="prefetch" href="/assets/js/23.81b00f85.js"><link rel="prefetch" href="/assets/js/24.b48a0bc2.js"><link rel="prefetch" href="/assets/js/25.bad781e1.js"><link rel="prefetch" href="/assets/js/26.43a4ee17.js"><link rel="prefetch" href="/assets/js/27.3834e0c5.js"><link rel="prefetch" href="/assets/js/28.4d9f2ef9.js"><link rel="prefetch" href="/assets/js/29.01c5c2f1.js"><link rel="prefetch" href="/assets/js/30.6d71675d.js"><link rel="prefetch" href="/assets/js/31.1a414ad8.js"><link rel="prefetch" href="/assets/js/32.ef850f4e.js"><link rel="prefetch" href="/assets/js/33.dc136b2e.js"><link rel="prefetch" href="/assets/js/34.babb6a17.js"><link rel="prefetch" href="/assets/js/35.72251327.js"><link rel="prefetch" href="/assets/js/36.e3eecfa9.js"><link rel="prefetch" href="/assets/js/37.0131f8af.js"><link rel="prefetch" href="/assets/js/38.a8fb0a86.js"><link rel="prefetch" href="/assets/js/39.8f6a1ce2.js"><link rel="prefetch" href="/assets/js/40.80ff349e.js"><link rel="prefetch" href="/assets/js/41.6899acdc.js"><link rel="prefetch" href="/assets/js/42.414fea6f.js"><link rel="prefetch" href="/assets/js/43.cf002bb0.js"><link rel="prefetch" href="/assets/js/44.5f5ae9a8.js"><link rel="prefetch" href="/assets/js/45.30226fd4.js"><link rel="prefetch" href="/assets/js/46.ca868584.js"><link rel="prefetch" href="/assets/js/47.5936413e.js"><link rel="prefetch" href="/assets/js/48.eba3068a.js"><link rel="prefetch" href="/assets/js/49.3e7713c8.js"><link rel="prefetch" href="/assets/js/5.abd33908.js"><link rel="prefetch" href="/assets/js/50.c1f22a24.js"><link rel="prefetch" href="/assets/js/51.1ba12691.js"><link rel="prefetch" href="/assets/js/52.4847ec8e.js"><link rel="prefetch" href="/assets/js/53.af4e98b2.js"><link rel="prefetch" href="/assets/js/54.c79d922c.js"><link rel="prefetch" href="/assets/js/55.9bfd3959.js"><link rel="prefetch" href="/assets/js/56.ffc00f64.js"><link rel="prefetch" href="/assets/js/57.1b4ea0eb.js"><link rel="prefetch" href="/assets/js/58.c229ac4b.js"><link rel="prefetch" href="/assets/js/59.3f5f2a80.js"><link rel="prefetch" href="/assets/js/60.1bb4a5d0.js"><link rel="prefetch" href="/assets/js/61.899517c6.js"><link rel="prefetch" href="/assets/js/62.3bd0c3a5.js"><link rel="prefetch" href="/assets/js/63.3c50522d.js"><link rel="prefetch" href="/assets/js/64.a2e124aa.js"><link rel="prefetch" href="/assets/js/65.b2d21469.js"><link rel="prefetch" href="/assets/js/66.fc7133e8.js"><link rel="prefetch" href="/assets/js/67.f454c7cf.js"><link rel="prefetch" href="/assets/js/68.57b33cfd.js"><link rel="prefetch" href="/assets/js/69.bbece1d3.js"><link rel="prefetch" href="/assets/js/7.da61580a.js"><link rel="prefetch" href="/assets/js/70.5c1eed08.js"><link rel="prefetch" href="/assets/js/71.6d8face7.js"><link rel="prefetch" href="/assets/js/72.30d07cc5.js"><link rel="prefetch" href="/assets/js/73.a9fa9877.js"><link rel="prefetch" href="/assets/js/74.67c800c0.js"><link rel="prefetch" href="/assets/js/75.17d0931e.js"><link rel="prefetch" href="/assets/js/76.a0a4998f.js"><link rel="prefetch" href="/assets/js/77.02ad2aa0.js"><link rel="prefetch" href="/assets/js/78.0a7616e5.js"><link rel="prefetch" href="/assets/js/79.1c031ef0.js"><link rel="prefetch" href="/assets/js/8.7f257ffd.js"><link rel="prefetch" href="/assets/js/80.7d00332e.js"><link rel="prefetch" href="/assets/js/81.6eabcc80.js"><link rel="prefetch" href="/assets/js/82.dceef211.js"><link rel="prefetch" href="/assets/js/83.71db4330.js"><link rel="prefetch" href="/assets/js/84.412c6342.js"><link rel="prefetch" href="/assets/js/85.f91991cb.js"><link rel="prefetch" href="/assets/js/86.eeae4505.js"><link rel="prefetch" href="/assets/js/87.90826b55.js"><link rel="prefetch" href="/assets/js/88.e13fbc62.js"><link rel="prefetch" href="/assets/js/89.e4daa3dc.js"><link rel="prefetch" href="/assets/js/9.ef81e3be.js"><link rel="prefetch" href="/assets/js/90.a01aae84.js"><link rel="prefetch" href="/assets/js/91.799d540b.js"><link rel="prefetch" href="/assets/js/92.d031cf09.js"><link rel="prefetch" href="/assets/js/93.e9fd4826.js"><link rel="prefetch" href="/assets/js/94.5a7c8cf7.js"><link rel="prefetch" href="/assets/js/95.7968e5be.js"><link rel="prefetch" href="/assets/js/97.51e7073e.js"><link rel="prefetch" href="/assets/js/98.2d55bdaa.js"><link rel="prefetch" href="/assets/js/99.6914bde2.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.6dee4dbb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6a6b0998.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>今朝のブログ</h3> <p class="description" data-v-355e03f9 data-v-355e03f9></p> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>今朝</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/image/hero.jpg" alt="今朝のブログ" class="logo"> <span class="site-name">今朝のブログ</span></a> <div class="links"><!----> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/reading-note/index.html" class="nav-link"><i class="iconfont reco-document"></i>
  Reading Note
</a></div><div class="nav-item"><a href="/lang/index.html" class="nav-link"><i class="iconfont reco-message"></i>
  Language
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/categories/golang/" class="nav-link"><i class="iconfont reco-category"></i>
  Category
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/zh/about-me/" class="nav-link"><i class="iconfont reco-account"></i>
  About
</a></div><div class="nav-item"><a href="https://github.com/dreamjz" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0f44a727></div> <aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><img src="/image/hero.jpg" alt="author-avatar" class="personal-img" data-v-5aaeb100> <h3 class="name" data-v-5aaeb100>
    今朝
  </h3> <div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>92</h3> <h6 data-v-5aaeb100>文章</h6></div> <div data-v-5aaeb100><h3 data-v-5aaeb100>26</h3> <h6 data-v-5aaeb100>标签</h6></div></div> <ul class="social-links" data-v-5aaeb100></ul> <hr data-v-5aaeb100></div> <nav class="nav-links"><div class="nav-item"><a href="/zh/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/reading-note/index.html" class="nav-link"><i class="iconfont reco-document"></i>
  Reading Note
</a></div><div class="nav-item"><a href="/lang/index.html" class="nav-link"><i class="iconfont reco-message"></i>
  Language
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/categories/golang/" class="nav-link"><i class="iconfont reco-category"></i>
  Category
</a></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="/zh/about-me/" class="nav-link"><i class="iconfont reco-account"></i>
  About
</a></div><div class="nav-item"><a href="https://github.com/dreamjz" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/zh/" aria-current="page" class="sidebar-link">Welcome</a></li><li><a href="/zh/indexes.html" class="sidebar-link">Index</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Golang</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/golang/Preface.html" class="sidebar-link">Preface</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Gin blog</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>The Design and Implementation of Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced Go Programming</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>High Performance Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Gorm</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/golang/gorm/01.1.html" class="sidebar-link">Gorm</a></li><li><a href="/zh/golang/gorm/01.2.html" aria-current="page" class="active sidebar-link">CRUD</a></li><li><a href="/zh/golang/gorm/01.3.html" class="sidebar-link">Associations</a></li><li><a href="/zh/golang/gorm/01.4.html" class="sidebar-link">Tutorials</a></li><li><a href="/zh/golang/gorm/01.5.html" class="sidebar-link">Advanced Topics</a></li><li><a href="/zh/golang/gorm/gorm.html" class="sidebar-link">Total</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Golang lib</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/zh/golang/gin.html" class="sidebar-link">Gin Web Framework</a></li><li><a href="/zh/golang/endless.html" class="sidebar-link">Graceful Shutdown or Restart</a></li><li><a href="/zh/golang/go-jwt.html" class="sidebar-link">Go jwt</a></li><li><a href="/zh/golang/uber-go-zap/01.1.html" class="sidebar-link">Zap</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Minidb</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>7Days-Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/zh/golang/concurrency/GMPModel.html" class="sidebar-link">GMP 原理分析</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Leet Code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>RPC</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Raspberry Pi</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Front End</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Learning Method</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Interviews</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>CRUD</h3> <!----> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>今朝</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-0f44a727><div id="particles-js" color="#dedede" particleOpacity="0.7" linesColor="#dedede" particlesNumber="80" shapeType="circle" particleSize="4" linesWidth="1" lineLinked="true" lineOpacity="0.4" linesDistance="150" moveSpeed="3" hoverEffect="true" hoverMode="grab" clickEffect="true" clickMode="push" class="bg-particles"></div> <main class="page"><section><div class="page-title"><h1 class="title">CRUD</h1> <div data-v-ff1aa866><i class="iconfont reco-account" data-v-ff1aa866><span data-v-ff1aa866>今朝</span></i> <i class="iconfont reco-date" data-v-ff1aa866><span data-v-ff1aa866>2021/11/27</span></i> <!----> <i class="tags iconfont reco-tag" data-v-ff1aa866><span class="tag-item" data-v-ff1aa866>gorm</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_5-crud"><a href="#_5-crud" class="header-anchor">#</a> 5. CRUD</h2> <h3 id="_5-1-create"><a href="#_5-1-create" class="header-anchor">#</a> 5.1 Create</h3> <h4 id="_5-1-1-创建记录"><a href="#_5-1-1-创建记录" class="header-anchor">#</a> 5.1.1 创建记录</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;time&quot;</span>

	<span class="token string">&quot;gorm.io/gorm/logger&quot;</span>

	<span class="token string">&quot;gorm.io/driver/sqlite&quot;</span>
	<span class="token string">&quot;gorm.io/gorm&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name     <span class="token builtin">string</span>
	Age      <span class="token builtin">int</span>
	Birthday time<span class="token punctuation">.</span>Time
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
	timeFormat <span class="token operator">=</span> <span class="token string">&quot;2006-01-02 15:04:05.000&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;ID: %d, Name: %s, Age: %d, Birthday: %s\nCreatedAy: %s, UpadtedAt: %s, DeletedAt: %s&quot;</span><span class="token punctuation">,</span>
		u<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> u<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> u<span class="token punctuation">.</span>Age<span class="token punctuation">,</span> u<span class="token punctuation">.</span>Birthday<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>timeFormat<span class="token punctuation">)</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>CreatedAt<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>timeFormat<span class="token punctuation">)</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span>UpdatedAt<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>timeFormat<span class="token punctuation">)</span><span class="token punctuation">,</span>
		u<span class="token punctuation">.</span>DeletedAt<span class="token punctuation">.</span>Time<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>timeFormat<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;create.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
		Logger<span class="token punctuation">:</span> logger<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>Info<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;failed to connect database&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	sqlDB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> sqlDB<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;kesa&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> Birthday<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;New record ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><ul><li><code>db.Create</code>: 通过数据的指针创建记录,会将插入的数据的主键写入到对象中，所以这里必须是指针类型</li> <li><code>result.Error</code>: 执行错误，nil 为成功</li> <li><code>result.RowsAffected</code>: 影响记录数</li></ul> <p><code>result</code>   的类型为 <code>tx *DB</code>:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// DB GORM DB definition</span>
<span class="token keyword">type</span> DB <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token operator">*</span>Config
	Error        <span class="token builtin">error</span>
	RowsAffected <span class="token builtin">int64</span>
	Statement    <span class="token operator">*</span>Statement
	clone        <span class="token builtin">int</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-1-2-用指定字段创建记录"><a href="#_5-1-2-用指定字段创建记录" class="header-anchor">#</a> 5.1.2 用指定字段创建记录</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;kesa&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> Birthday<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;New record ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">)</span>

	user1 <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;kesa&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> Birthday<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CreatedAt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user1<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;New record ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li><code>Select</code>: 创建记录并更新指定字段</li> <li><code>omit</code>: 创建记录但忽略指定字段</li></ul> <p>执行程序，并查询数据：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sqlite&gt; select * from users where id=11 or id = 12;
id  created_at                           updated_at                           deleted_at  name  age  birthday                           
--  -----------------------------------  -----------------------------------  ----------  ----  ---  -----------------------------------
11  2021-11-25 17:29:25.000032484+08:00  2021-11-25 17:29:25.000032484+08:00              kesa  18                                      
12                                       2021-11-25 17:29:26.071051452+08:00                         2021-11-25 17:29:26.070793799+08:00
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-1-3-批量插入"><a href="#_5-1-3-批量插入" class="header-anchor">#</a> 5.1.3 批量插入</h4> <p>批量插入数据可以将<code>slice</code>作为参数传给<code>Create</code>方法， GORM 将会单独生成一条 SQL 来执行并回填主键值，钩子方法也将被调用</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token keyword">var</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d,Error: %s&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> user <span class="token operator">:=</span> <span class="token keyword">range</span> users <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Inserted ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>通过 GORM 的日志可以看到，Create 方法通过一条 SQL 插入了所有数据</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>INSERT INTO `users` (`created_at`,`updated_at`,`deleted_at`,`name`,`age`,`birthday`) VALUES (&quot;2021-11-25 17:54:34.823&quot;,&quot;2021-11-25 17:54:34.823&quot;,NULL,&quot;user_1&quot;,0,&quot;0000-00-00 00:00:00&quot;),(&quot;2021-11-25 17:54:34.823&quot;,&quot;2021-11-25 17:54:34.823&quot;,NULL,&quot;user_2&quot;,0,&quot;0000-00-00 00:00:00&quot;),(&quot;2021-11-25 17:54:34.823&quot;,&quot;2021-11-25 17:54:34.823&quot;,NULL,&quot;user_3&quot;,0,&quot;0000-00-00 00:00:00&quot;) RETURNING `id`
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用<code>CreateInBatches</code>进行分批创建，可以指定每批的数量</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">var</span> users1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_5&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_6&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">CreateInBatches</span><span class="token punctuation">(</span>users1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d,Error: %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> user <span class="token operator">:=</span> <span class="token keyword">range</span> users1 <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Inserted ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>启动后查看 GORM 日志可以看到 SQL 分为了三条执行</p> <p><code>Upsert</code> 和 <code>Create With Associations</code>也支持批量插入</p> <p><strong>注意</strong></p> <p>使用 <code>CreateBatchSize</code> 选项初始化 GORM 时，所有的创建和关联 INSERT 遵循该选项</p> <p>修改上例中的 GORM 配置，添加 CreateBatchSize 为 3</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;create-in-batches.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
		Logger<span class="token punctuation">:</span>          logger<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>Info<span class="token punctuation">)</span><span class="token punctuation">,</span>
		CreateBatchSize<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
<span class="token keyword">var</span> users <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d,Error: %s&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> user <span class="token operator">:=</span> <span class="token keyword">range</span> users <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Inserted ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token comment">// ... </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>再次执行程序可以看到 <code>Create</code> 语句插入三条记录时只会执行一条 SQL 了</p> <h4 id="_5-1-4-钩子函数"><a href="#_5-1-4-钩子函数" class="header-anchor">#</a> 5.1.4 钩子函数</h4> <p>GORM 创建相关的钩子函数有 <code>BeforeSave</code>, <code>BeforeCreate</code>, <code>AfterSave</code>, <code>AfterCreate</code> ，创建记录时将调用这些钩子函数</p> <p>钩子（Hook）是在创建，查询，更新，删除等操作之前，之后调用的函数</p> <p>若函数返回错误，GORM 将停止后续的操作并回滚事务</p> <p>钩子函数的签名为 <code>func(*gorm.DB) error</code></p> <p>创建操作时 hook 的调用顺序如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// 开始事务
BeforeSave
BeforeCreate
// 关联前的 save
// 插入记录至 db
// 关联后的 save
AfterCreate
AfterSave
// 提交或回滚事务
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>示例：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">BeforeCreate</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Before Create&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">BeforeSave</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Before Save&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">AfterCreate</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;After Create&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>u User<span class="token punctuation">)</span> <span class="token function">AfterSave</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;After Save&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> u<span class="token punctuation">.</span>Age <span class="token operator">&lt;</span> <span class="token number">21</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;illegal age,roll back&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//...</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;kesa&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span> Birthday<span class="token punctuation">:</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d, Error: %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;New record ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>上例在 AfterSave 钩子中加入了返回错误的条件，此时再次插入数据，将会返回错误，GORM 会将事务回滚</p> <p>查询数据库可以看到数据库是没有数据的</p> <h4 id="_5-1-5-根据-map-创建"><a href="#_5-1-5-根据-map-创建" class="header-anchor">#</a> 5.1.5 根据 Map 创建</h4> <p>GORM 支持根据 <code>map[string]interface{}</code> 和 <code>[]map[string]interface{}</code> 创建记录</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	data <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;kesa-map&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span>  <span class="token number">18</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">)</span>

	datas <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>
		<span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;kesa_map_1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;kesa_map_2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;kesa_map_3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
	result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>datas<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>注意</strong></p> <p>使用 map 创建记录时， association 不会调用，map 中未涉及的字段也不会被更新</p> <h4 id="todo-5-1-6-使用-sql-表达式-context-valuer-创建记录"><a href="#todo-5-1-6-使用-sql-表达式-context-valuer-创建记录" class="header-anchor">#</a> TODO:: 5.1.6 使用 SQL 表达式 Context Valuer 创建记录</h4> <p>// TODO</p> <h4 id="_5-1-7-关联创建"><a href="#_5-1-7-关联创建" class="header-anchor">#</a> 5.1.7 关联创建</h4> <p>创建关联数据时，若关联值为非零值，这些关联会被 upsert ，且它们的 Hook 方法也会被调用</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>

	<span class="token string">&quot;gorm.io/gorm/clause&quot;</span>

	<span class="token string">&quot;gorm.io/gorm/logger&quot;</span>

	<span class="token string">&quot;gorm.io/driver/sqlite&quot;</span>
	<span class="token string">&quot;gorm.io/gorm&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Name       <span class="token builtin">string</span>
	CreditCard CreditCard
<span class="token punctuation">}</span>

<span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	gorm<span class="token punctuation">.</span>Model
	Number <span class="token builtin">string</span>
	UserID <span class="token builtin">uint</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ... db connection</span>

	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>CreditCard<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;kesa&quot;</span><span class="token punctuation">,</span> CreditCard<span class="token punctuation">:</span> CreditCard<span class="token punctuation">{</span>Number<span class="token punctuation">:</span> <span class="token string">&quot;12346&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;New user ID: %d, CreditCard ID: %d&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> user<span class="token punctuation">.</span>CreditCard<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d, Error: %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>

	user1 <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;kesa&quot;</span><span class="token punctuation">,</span> CreditCard<span class="token punctuation">:</span> CreditCard<span class="token punctuation">{</span>Number<span class="token punctuation">:</span> <span class="token string">&quot;78910&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
	result <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Omit</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Associations<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user1<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;New user ID: %d, CreditCard ID: %d&quot;</span><span class="token punctuation">,</span> user1<span class="token punctuation">.</span>ID<span class="token punctuation">,</span> user1<span class="token punctuation">.</span>CreditCard<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Rows affected: %d, Error: %v&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span>RowsAffected<span class="token punctuation">,</span> result<span class="token punctuation">.</span>Error<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><ul><li><code>db.Omit(clause.Associations).Create(&amp;user1)</code>: 跳过所有的关联</li></ul> <p>也以通过 <code>Select</code>,<code>Omit</code> 方法来跳过关联保存</p> <h4 id="_5-1-8-默认值"><a href="#_5-1-8-默认值" class="header-anchor">#</a> 5.1.8 默认值</h4> <p>可以通过标签 <code>default</code> 为字段定义默认值</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">int64</span>
  Name <span class="token builtin">string</span> <span class="token string">`gorm:&quot;default:galeone&quot;`</span>
  Age  <span class="token builtin">int64</span>  <span class="token string">`gorm:&quot;default:18&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>插入记录到数据库时，默认值会被用于填充值为零值的字段</p> <p><strong>注意</strong></p> <p>像<code>0</code>,<code>''</code>,<code>false</code>等零值，不会将这些字段定义的默认值保存到数据库，需要使用指针类型或  <code>Scanner/Valuer</code> 来避免这个问题，例如：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Name <span class="token builtin">string</span>
  Age  <span class="token operator">*</span><span class="token builtin">int</span>           <span class="token string">`gorm:&quot;default:18&quot;`</span>
  Active sql<span class="token punctuation">.</span>NullBool <span class="token string">`gorm:&quot;default:true&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>若要数据库有默认值，必须为字段设置 <code>default</code> 标签，使用 <code>default:(-)</code> 在迁移时跳过默认值定义</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID        <span class="token builtin">string</span> <span class="token string">`gorm:&quot;default:uuid_generate_v3()&quot;`</span> <span class="token comment">// db func</span>
  FirstName <span class="token builtin">string</span>
  LastName  <span class="token builtin">string</span>
  Age       <span class="token builtin">uint8</span>
  FullName  <span class="token builtin">string</span> <span class="token string">`gorm:&quot;-&gt;;type:GENERATED ALWAYS AS (concat(firstname,' ',lastname));default:(-);&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用 <code>virtual/generate</code> 值时，需要禁用其创建，更新的权限</p> <h4 id="_5-1-9-upset-及冲突"><a href="#_5-1-9-upset-及冲突" class="header-anchor">#</a> 5.1.9 Upset 及冲突</h4> <p>GORM 为不同数据库提供了兼容的 Upsert 支持</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;gorm.io/gorm/clause&quot;</span>

<span class="token comment">// 在冲突时，什么都不做</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>OnConflict<span class="token punctuation">{</span>DoNothing<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// 在`id`冲突时，将列更新为默认值</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>OnConflict<span class="token punctuation">{</span>
  Columns<span class="token punctuation">:</span>   <span class="token punctuation">[</span><span class="token punctuation">]</span>clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  DoUpdates<span class="token punctuation">:</span> clause<span class="token punctuation">.</span><span class="token function">Assignments</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;role&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// MERGE INTO &quot;users&quot; USING *** WHEN NOT MATCHED THEN INSERT *** WHEN MATCHED THEN UPDATE SET ***; SQL Server</span>
<span class="token comment">// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE ***; MySQL</span>

<span class="token comment">// 使用SQL语句</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>OnConflict<span class="token punctuation">{</span>
  Columns<span class="token punctuation">:</span>   <span class="token punctuation">[</span><span class="token punctuation">]</span>clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  DoUpdates<span class="token punctuation">:</span> clause<span class="token punctuation">.</span><span class="token function">Assignments</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">:</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;GREATEST(count, VALUES(count))&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE `count`=GREATEST(count, VALUES(count));</span>

<span class="token comment">// 在`id`冲突时，将列更新为新值</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>OnConflict<span class="token punctuation">{</span>
  Columns<span class="token punctuation">:</span>   <span class="token punctuation">[</span><span class="token punctuation">]</span>clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  DoUpdates<span class="token punctuation">:</span> clause<span class="token punctuation">.</span><span class="token function">AssignmentColumns</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// MERGE INTO &quot;users&quot; USING *** WHEN NOT MATCHED THEN INSERT *** WHEN MATCHED THEN UPDATE SET &quot;name&quot;=&quot;excluded&quot;.&quot;name&quot;; SQL Server</span>
<span class="token comment">// INSERT INTO &quot;users&quot; *** ON CONFLICT (&quot;id&quot;) DO UPDATE SET &quot;name&quot;=&quot;excluded&quot;.&quot;name&quot;, &quot;age&quot;=&quot;excluded&quot;.&quot;age&quot;; PostgreSQL</span>
<span class="token comment">// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE `name`=VALUES(name),`age=VALUES(age); MySQL</span>

<span class="token comment">// 在冲突时，更新除主键以外的所有列到新值。</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>OnConflict<span class="token punctuation">{</span>
  UpdateAll<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// INSERT INTO &quot;users&quot; *** ON CONFLICT (&quot;id&quot;) DO UPDATE SET &quot;name&quot;=&quot;excluded&quot;.&quot;name&quot;, &quot;age&quot;=&quot;excluded&quot;.&quot;age&quot;, ...;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_5-2-read"><a href="#_5-2-read" class="header-anchor">#</a> 5.2 Read</h3> <h4 id="_5-2-1-检索单个对象"><a href="#_5-2-1-检索单个对象" class="header-anchor">#</a> 5.2.1 检索单个对象</h4> <p>GORM 提供了 <code>First</code>, <code>Take</code>, <code>Last</code> 方法，以便从数据库中检索单个对象。</p> <p>查询数据库时会添加  <code>LIMIT 1</code> 条件，若未找到记录会返回 <code>ErrRecordNotFound</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;strconv&quot;</span>

	<span class="token string">&quot;gorm.io/driver/sqlite&quot;</span>
	<span class="token string">&quot;gorm.io/gorm&quot;</span>
	<span class="token string">&quot;gorm.io/gorm/logger&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID   <span class="token builtin">uint</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;single-obj.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
		Logger<span class="token punctuation">:</span> logger<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>Info<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;failed to connect db: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	sqlDB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> sqlDB<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token function">CreateUsers</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>

	<span class="token keyword">var</span> user<span class="token punctuation">,</span> user1<span class="token punctuation">,</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user1<span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Last</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>

	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;First user: %+v&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;One  of users: %+v&quot;</span><span class="token punctuation">,</span> user1<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Last user: %+v&quot;</span><span class="token punctuation">,</span> user2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CreateUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	users <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">11</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		name <span class="token operator">:=</span> <span class="token string">&quot;user_&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		age <span class="token operator">:=</span> <span class="token number">10</span> <span class="token operator">+</span> i
		users<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> Age<span class="token punctuation">:</span> age<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><ul><li><code>First</code>: 获取第一条记录，主键升序
SQL: SELECT * FROM users ORDER BY id LIMIT 1;</li> <li><code>Take</code>: 获取一条记录，无排序字段
SQL: SELECT * FROM users LIMIT 1;</li> <li><code>Last</code>:获取最后一条记录，主键降序
SQL: SELECT * FROM users ORDER BY id DESC LIMIT 1;</li></ul> <p>若想要避免 <code>ErrRecordNotFound</code> 错误，可以使用 <code>Find</code>,可以接收 strcut 或 slice 参数</p> <p><code>First</code> 和 <code>Last</code> 会根据主键排序，分别查询第一条和最后一条记录，只有在 struct 是指针或通过 <code>db.Model()</code>指定 model 时才有效，若相关的 model 没有定义主键将按照第一个字段排序</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 	<span class="token comment">// ... db init</span>
	<span class="token keyword">var</span> user3 User
	<span class="token comment">// SELECT * FROM users ORDER BY id LIMIT 1;</span>
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users ORDER BY id LIMIT 1;</span>
	ret <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ret<span class="token punctuation">)</span>
	<span class="token comment">// invalid</span>
	ret1 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ret1<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users LIMIT 1;</span>
	ret2 <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ret2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM languages ORDER BY code LIMIT 1;</span>
	<span class="token keyword">type</span> Language <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		Code <span class="token builtin">string</span>
		Name <span class="token builtin">string</span>
	<span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Language<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_5-2-2-用主键检索"><a href="#_5-2-2-用主键检索" class="header-anchor">#</a> 5.2.2 用主键检索</h4> <p>若主键是数字型，可以使用内联条件检索，传入字符串参数时，需要注意 SQL 注入问题</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ... </span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
	<span class="token comment">// SELECT * FROM users WHERE id = 10 ORDER BY id LIMIT 1;</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Record: %+v&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE id = 10 ORDER BY id LIMIT 1;</span>
	<span class="token keyword">var</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">,</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Record: %+v&quot;</span><span class="token punctuation">,</span> user2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE id IN (1,2,3)</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Record: %+v&quot;</span><span class="token punctuation">,</span> users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>如果主键是字符串型：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// SELECT * FROM users WHERE id = '1b74413f-f3b8-409f-ac47-e8c062e3472a'</span>
db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;1b74413f-f3b8-409f-ac47-e8c062e3472a&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-2-3-检索全部对象"><a href="#_5-2-3-检索全部对象" class="header-anchor">#</a> 5.2.3 检索全部对象</h4> <p>使用 <code>Find</code> 可以查询所有数据</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>reuslt.RowsAffected</code> 返回找到的记录数，<code>result.Error</code>返回出现的错误</p> <h4 id="_5-2-4-条件查询"><a href="#_5-2-4-条件查询" class="header-anchor">#</a> 5.2.4  条件查询</h4> <p><strong>String</strong></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID   <span class="token builtin">uint</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	Name <span class="token builtin">string</span>
	Age  <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token function">CreateUsers</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

	<span class="token comment">// String</span>
	<span class="token function">StringCondition</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CreateUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> num <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> count <span class="token builtin">int64</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
	<span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	users <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		name <span class="token operator">:=</span> <span class="token string">&quot;user_&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
		age <span class="token operator">:=</span> <span class="token number">10</span> <span class="token operator">+</span> i
		users<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> Age<span class="token punctuation">:</span> age<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">PrintRecord</span><span class="token punctuation">(</span>record <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">switch</span> val <span class="token operator">:=</span> record<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> User<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Record: %+v&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Records: %+v&quot;</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">StringCondition</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user' ORDER BY id LIMIT 1;</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name &lt;&gt; 'user';</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name &lt;&gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name IN ('user_1','user_2','user_3')</span>
	<span class="token keyword">var</span> users1 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name IN ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;user_1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users1<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users1<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name LIKE '%user%';</span>
	<span class="token keyword">var</span> users3 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name LIKE ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;%user%&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users3<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users3<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' AND age = 11;</span>
	<span class="token keyword">var</span> users4 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ? AND age = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users4<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users4<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age &lt;= 10;</span>
	<span class="token keyword">var</span> users5 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &lt;= ?&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users5<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users5<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age BETWEEN 10 AND 16;</span>
	<span class="token keyword">var</span> users6 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age BETWEEN ? AND ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users6<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users6<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p><code>Where</code> 方法中可以直接使用 SQL 和占位符来构成条件查询</p> <p><strong>Struct and Map</strong></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// Struct and Map</span>
	<span class="token function">StructMapCondition</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">StructMapCondition</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Struct</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' AND age = 10 ORDER BY id LIMIT 1;</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_2' AND age = 11;</span>
	<span class="token keyword">var</span> user2 User
	cond <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>cond<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE id IN (1,2,3)</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>

	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' LIMIT 1;</span>
	<span class="token keyword">var</span> user3 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_2' AND age = 0 LIMIT 1;</span>
	<span class="token keyword">var</span> user4 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user4<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user4<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_3' AND age = 12 LIMIT 1;</span>
	<span class="token keyword">var</span> user5 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user5<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user5<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age = 0 LIMIT 1;</span>
	<span class="token keyword">var</span> user6 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user6<span class="token punctuation">)</span>
	<span class="token function">PrintRecord</span><span class="token punctuation">(</span>user6<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>也可以使用 Struct 和 Map 来构建查询条件</p> <p><strong>注意： 当使用 Struct 作为查询条件时，只能查询非零值字段，零值字段将不会用于构建查询条件</strong></p> <p>若需要使用零值字段查询，可以使用 Map 或 指定 Struct 查询字段</p> <ul><li><code>db.Where(map[string]interface{}{&quot;Name&quot;: &quot;user_2&quot;, &quot;Age&quot;: 0})</code>:使用 map 构建查询条件</li> <li><code>db.Where(&amp;User{Name: &quot;user_3&quot;}, &quot;age&quot;)</code>: 指定 Struct 字段构建查询条件</li></ul> <p><strong>内联条件</strong></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// Inline Conditions</span>
	<span class="token comment">// SELECT * FROM users WHERE id = 1 ORDER BY id LIMIT 1;</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' LIMIT 1;</span>
	<span class="token keyword">var</span> user1 User
	db<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user1<span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name &lt;&gt; 'user_2' AND age &gt;= 15;</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token string">&quot;name &lt;&gt; ? AND age &gt;= ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age = 16 LIMIT 1;</span>
	<span class="token keyword">var</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">,</span> User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age = 13 LIMIT 1;</span>
	<span class="token keyword">var</span> user3 User
	db<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><strong>Not&amp;Or Conditions</strong></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// Not Conditions</span>
	<span class="token comment">// SELECT * FROM users WHERE NOT name = 'user_1' LIMIT 1;</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name NOT IN ('user_2','user_3','user_4');</span>
	<span class="token keyword">var</span> users1 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;user_2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_4&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users1<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users1<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name &lt;&gt; 'user_5' AND age &lt;&gt; 11;</span>
	<span class="token keyword">var</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_5&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE id NOT IN (1,2,3);</span>
	<span class="token keyword">var</span> users3 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Not</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int64</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users3<span class="token punctuation">)</span>

	<span class="token comment">// Or Conditions</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' OR age = 16;</span>
	<span class="token keyword">var</span> users4 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users4<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users4<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM user WHERE name = 'user_2' OR (name = 'user_3' AND age = 13) ;</span>
	<span class="token keyword">var</span> users5 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = 'user_2'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users5<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users5<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age = 10 OR (name = 'user_0' AND age = 10);</span>
	<span class="token keyword">var</span> users6 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users6<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users6<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p><code>Not</code>和 <code>Or</code> 和<code>Where</code> 的构造类似</p> <h4 id="_5-2-5-选择特定字段"><a href="#_5-2-5-选择特定字段" class="header-anchor">#</a> 5.2.5 选择特定字段</h4> <p>使用 <code>Select</code> 可以指定查询字段，默认情况会查询所有的字段</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// SELECT name FROM users ;</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT name,age FROM users ;</span>
	<span class="token keyword">var</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_5-2-6-order"><a href="#_5-2-6-order" class="header-anchor">#</a> 5.2.6 Order</h4> <p>指定查询的排列方式</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// SELECT name,age FROM users ORDER BY age desc, name ;</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age desc,name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT name,age FROM users ORDER BY age asc, name desc ;</span>
	<span class="token keyword">var</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age asc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;name desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_5-2-7-limit-offset"><a href="#_5-2-7-limit-offset" class="header-anchor">#</a> 5.2.7 Limit&amp;Offset</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
	UserAllFields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// Limit&amp;Offset</span>
	<span class="token comment">// SELECT id,name,age FROM users LIMIT 3 ;</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT id,name,age FROM users LIMIT 10 ;</span>
	<span class="token comment">// SELECT id,name,age FROM users ;</span>
	<span class="token keyword">var</span> users1<span class="token punctuation">,</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users1<span class="token punctuation">,</span> users2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT id,name,age FROM users OFFSET 3 ;</span>
	<span class="token keyword">var</span> users3 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users3<span class="token punctuation">)</span>
	<span class="token comment">// SELECT id,name,age FROM users OFFSET 3 LIMIT 4 ;</span>
	<span class="token keyword">var</span> users4 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users4<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users4<span class="token punctuation">)</span>
	<span class="token comment">// SELECT id,name,age FROM users OFFSET 3;</span>
	<span class="token comment">// SELECT id,name,age FROM users ;</span>
	<span class="token keyword">var</span> users5<span class="token punctuation">,</span> users6 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users5<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Offset</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users6<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users5<span class="token punctuation">,</span> users6<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><ul><li><code>Limit(-1)</code>:可取消 LIMIT 条件</li> <li><code>Offset(-1)</code>: 可取消 OFFSET 条件</li> <li><code>db.Select(UserAllFields).Offset(3).Find(&amp;users5).Offset(-1).Find(&amp;users6)</code> : GORM 可以进行多次查询，调用两次 <code>Find</code> 可以查询两次，并且可以修改查询条件</li></ul> <p>为了能够打印多个结果，修改<code>utils</code>:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> utils

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;log&quot;</span>
	<span class="token string">&quot;reflect&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">PrintRecord</span><span class="token punctuation">(</span>record <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> r <span class="token operator">:=</span> <span class="token keyword">range</span> record <span class="token punctuation">{</span>
		<span class="token function">printSingle</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">printSingle</span><span class="token punctuation">(</span>record <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	v <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span>
	k <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">switch</span> k <span class="token punctuation">{</span>
	<span class="token keyword">case</span> reflect<span class="token punctuation">.</span>Struct<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Record: %+v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token keyword">case</span> reflect<span class="token punctuation">.</span>Slice<span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Records: %+v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token keyword">default</span><span class="token punctuation">:</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;%#v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h4 id="_5-2-8-group-by-having"><a href="#_5-2-8-group-by-having" class="header-anchor">#</a> 5.2.8 Group By &amp; Having</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
	GroupAndAvgAge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AVG(age) as avg_age&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID    <span class="token builtin">uint</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	Name  <span class="token builtin">string</span>
	Group <span class="token builtin">string</span>
	Age   <span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> GrpByResult <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Group  <span class="token builtin">string</span>
	AvgAge <span class="token builtin">float64</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>DBName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
		Logger<span class="token punctuation">:</span> logger<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>Info<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;connect db failed: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	sqlDB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> sqlDB<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token function">CreateUsers</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> UserCount<span class="token punctuation">)</span>

	<span class="token comment">// Group By &amp; Having</span>
	<span class="token comment">// SELECT group,AVG(age) as avg_age FROM users GROUP BY `group` ;</span>
	<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span>GrpAvgAge
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>GroupAndAvgAge<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
	<span class="token comment">// SELECT group,AVG(age) as avg_age FROM users GROUP BY `group` HAVING avg_age &gt; 14 ;</span>
	<span class="token keyword">var</span> results1 <span class="token punctuation">[</span><span class="token punctuation">]</span>GrpAvgAge
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>GroupAndAvgAge<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Having</span><span class="token punctuation">(</span><span class="token string">&quot;avg_age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results1<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results1<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CreateUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> num <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> count <span class="token builtin">int64</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
	<span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	users <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		grp <span class="token operator">:=</span> <span class="token string">&quot;group_&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">)</span>
		name <span class="token operator">:=</span> <span class="token string">&quot;user_&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		age <span class="token operator">:=</span> <span class="token number">10</span> <span class="token operator">+</span> i
		users<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> Age<span class="token punctuation">:</span> age<span class="token punctuation">,</span> Group<span class="token punctuation">:</span> grp<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h4 id="_5-2-9-distinct"><a href="#_5-2-9-distinct" class="header-anchor">#</a> 5.2.9 Distinct</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
	<span class="token comment">// Distinct</span>
	<span class="token comment">// SELECT DISTINCT name FROM users ;</span>
	<span class="token keyword">var</span> result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-2-10-joins"><a href="#_5-2-10-joins" class="header-anchor">#</a> 5.2.10 Joins</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">var</span> <span class="token punctuation">(</span>
	GroupAndAvgAge <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;AVG(age) as avg_age&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID    <span class="token builtin">uint</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	Name  <span class="token builtin">string</span>
	Group <span class="token builtin">string</span>
	Age   <span class="token builtin">int</span>
	Email Email
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Email <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	ID     <span class="token builtin">uint</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
	UserID <span class="token builtin">uint</span>
	Email  <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>DBName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
		Logger<span class="token punctuation">:</span> logger<span class="token punctuation">.</span>Default<span class="token punctuation">.</span><span class="token function">LogMode</span><span class="token punctuation">(</span>logger<span class="token punctuation">.</span>Info<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;connect db failed: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	sqlDB<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">DB</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> sqlDB<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">AutoMigrate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Email<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token function">CreateUsers</span><span class="token punctuation">(</span>db<span class="token punctuation">,</span> UserCount<span class="token punctuation">)</span>

	<span class="token comment">// JOINS</span>
	<span class="token comment">// SELECT users.name,emails.email FROM users INNER JOIN emails ON users.id = emails.user_id;</span>
	<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;users.name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;emails.email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">&quot;INNER JOIN emails ON users.id = emails.user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>	

<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">CreateUsers</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> num <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> count <span class="token builtin">int64</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
	<span class="token keyword">if</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	users <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>User<span class="token punctuation">,</span> num<span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		grp <span class="token operator">:=</span> <span class="token string">&quot;group_&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token operator">%</span><span class="token number">3</span><span class="token punctuation">)</span>
		name <span class="token operator">:=</span> <span class="token string">&quot;user_&quot;</span> <span class="token operator">+</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
		age <span class="token operator">:=</span> <span class="token number">10</span> <span class="token operator">+</span> i
		email <span class="token operator">:=</span> name <span class="token operator">+</span> <span class="token string">&quot;@example.com&quot;</span>
		users<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> name<span class="token punctuation">,</span> Age<span class="token punctuation">:</span> age<span class="token punctuation">,</span> Group<span class="token punctuation">:</span> grp<span class="token punctuation">,</span> Email<span class="token punctuation">:</span> Email<span class="token punctuation">{</span>Email<span class="token punctuation">:</span> email<span class="token punctuation">}</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h4 id="_5-2-11-scan"><a href="#_5-2-11-scan" class="header-anchor">#</a> 5.2.11 Scan</h4> <p><code>Scan</code> 和 <code>Find</code> 类似都是将结果解析至 struct/map 中,两者的区别在于 <code>Find</code> 会调用所有注册的钩子函数，而<code>Scan</code>则不会</p> <h4 id="_5-2-12-智能选择字段"><a href="#_5-2-12-智能选择字段" class="header-anchor">#</a> 5.2.12 智能选择字段</h4> <p>GORM 可以通过 <code>Select</code> 选择特定字段，也可以通过结构体来选择字段</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID     <span class="token builtin">uint</span>
  Name   <span class="token builtin">string</span>
  Age    <span class="token builtin">int</span>
  Gender <span class="token builtin">string</span>
  <span class="token comment">// 假设后面还有几百个字段...</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> APIUser <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">uint</span>
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 查询时会自动选择 `id`, `name` 字段</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>APIUser<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT `id`, `name` FROM `users` LIMIT 10</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_5-2-13-locking"><a href="#_5-2-13-locking" class="header-anchor">#</a> 5.2.13 Locking</h4> <p>GORM 支持多种类型的锁，例如：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Locking<span class="token punctuation">{</span>Strength<span class="token punctuation">:</span> <span class="token string">&quot;UPDATE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM `users` FOR UPDATE</span>

db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Locking<span class="token punctuation">{</span>
  Strength<span class="token punctuation">:</span> <span class="token string">&quot;SHARE&quot;</span><span class="token punctuation">,</span>
  Table<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>Table<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>CurrentTable<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM `users` FOR SHARE OF `users`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-2-14-subquery"><a href="#_5-2-14-subquery" class="header-anchor">#</a> 5.2.14  SubQuery</h4> <p>A subquery can be nested within a query, GORM can generate subquery when using a <code>*gorm.DB</code> object as param</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
	<span class="token comment">// SubQuery</span>
	<span class="token comment">// SELECT name,age FROM users WHERE age &gt; (SELECT AVG(age) FROM users) ;</span>
	<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	subQuery <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;AVG(age)&quot;</span><span class="token punctuation">)</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; (?)&quot;</span><span class="token punctuation">,</span> subQuery<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-2-15-from-subquery"><a href="#_5-2-15-from-subquery" class="header-anchor">#</a> 5.2.15 From SubQuery</h4> <p>GORM allows you using subquery in FROM clause with method <code>Table</code>：</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// SELECT * FROM (SELECT name,age FROM users) as u WHERE age &lt; 15 ;</span>
	<span class="token keyword">var</span> result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;(?) as u&quot;</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &lt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_5-2-16-group-conditions"><a href="#_5-2-16-group-conditions" class="header-anchor">#</a> 5.2.16 Group Conditions</h4> <p>Easier to write complicated SQL query with Group Conditions</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// SELECT * FROM users WHERE (name = 'user_0' AND age = 10) OR (age &gt; 15) ;</span>
	<span class="token keyword">var</span> results2 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>
		db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Or</span><span class="token punctuation">(</span>
		db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; 15&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_5-2-17-in-with-multiple-colums"><a href="#_5-2-17-in-with-multiple-colums" class="header-anchor">#</a> 5.2.17 IN with multiple colums</h4> <p>Selecting IN with multiple columns</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// SELECT * FROM users WHERE (name,age) IN (('user_0', 10),('user_1', 11),('user_2', 12));</span>
	<span class="token keyword">var</span> results3 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;(name,age) IN ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token string">&quot;user_0&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;user_1&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;user_2&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>results3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results3<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意：sqlite3 不支持上述写法，在 sqlite3 中要写成</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>age<span class="token punctuation">)</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'user_0'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'user_1'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'user_2'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-2-18-named-argument"><a href="#_5-2-18-named-argument" class="header-anchor">#</a> 5.2.18 Named Argument</h4> <p>GORM supports named arguments with <code>sql.NamedArg</code> or <code>map[string]interface{}</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' OR age = 16;</span>
	<span class="token keyword">var</span> results4 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = @name OR age = @age&quot;</span><span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results4<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results4<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_1' OR age = 16;</span>
	<span class="token keyword">var</span> results5 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = @name OR age = @age&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results5<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results5<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_5-2-19-find-to-map"><a href="#_5-2-19-find-to-map" class="header-anchor">#</a> 5.2.19 Find To Map</h4> <p>GORM allows scan result to <code>map[string]interface{}</code> or <code>[]map[string]interface{}</code>, don't forget to specify <code>Model</code> or <code>Table</code>,</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>result <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">,</span> <span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-2-20-firstorinit"><a href="#_5-2-20-firstorinit" class="header-anchor">#</a> 5.2.20 FirstOrInit</h4> <p>Get first matched record or initialize a new instance with given conditions (only works with struct or map conditions)</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// FirstOrInit</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">//</span>
	<span class="token keyword">var</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>initialize struct with more attributes if record not found, thoes <code>Attrs</code> won't be used to build SQL query</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// SELECT * FROM users WHERE name = 'non_existing' ORDER BY id LIMIT 1 ;</span>
	<span class="token keyword">var</span> user3 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><code>Assign</code> attributes to struct regardless it is found or not, thoes attributes won't be used to build SQL query and the final data won't be saved into database</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// SELECT * FROM users WHERE name = 'user_0' ORDER BY id LIMIT 1 ;	var user4 User</span>
	<span class="token keyword">var</span> user4 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrInit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user4<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user4<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_5-2-21-firstorcreate"><a href="#_5-2-21-firstorcreate" class="header-anchor">#</a> 5.2.21 FirstOrCreate</h4> <p>此方法和<code>FirstOrInit</code> 类似，未找到记录则会根据条件和属性新增记录</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// FirstOrCreate</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'non_existing' ORDER BY id LIMIT 1 ;</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_0' ORDER BY id LIMIT 1 ;</span>
	<span class="token keyword">var</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'non_existing' ORDER BY id LIMIT 1 ;</span>
	<span class="token keyword">var</span> user3 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;non_existing&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Attrs</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_0' ORDER BY id LIMIT 1 ;	var user4 User</span>
	<span class="token keyword">var</span> user4 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Assign</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Age<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FirstOrCreate</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user4<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user4<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_5-2-22-optimizer-index-hints"><a href="#_5-2-22-optimizer-index-hints" class="header-anchor">#</a> 5.2.22 Optimizer/Index Hints</h4> <p>Optimizer hints allow to control the query optimizer to choose a certain query execution plan, GORM supports it with <code>gorm.io/hints</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;gorm.io/hints&quot;</span>

db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>hints<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;MAX_EXECUTION_TIME(10000)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * /*+ MAX_EXECUTION_TIME(10000) */ FROM `users`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Index hints allow passing index hints to the database in case the query planner gets confused.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;gorm.io/hints&quot;</span>

db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>hints<span class="token punctuation">.</span><span class="token function">UseIndex</span><span class="token punctuation">(</span><span class="token string">&quot;idx_user_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM `users` USE INDEX (`idx_user_name`)</span>

db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>hints<span class="token punctuation">.</span><span class="token function">ForceIndex</span><span class="token punctuation">(</span><span class="token string">&quot;idx_user_name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;idx_user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ForJoin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * FROM `users` FORCE INDEX FOR JOIN (`idx_user_name`,`idx_user_id`)&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-2-23-iteration"><a href="#_5-2-23-iteration" class="header-anchor">#</a> 5.2.23 Iteration</h4> <p>GORM supports iterating through Rows</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Iteration</span>
	rows<span class="token punctuation">,</span> err <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;query record error: &quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;[%d] Row&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
		<span class="token keyword">var</span> user User
		db<span class="token punctuation">.</span><span class="token function">ScanRows</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
		utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_5-2-24-hooks"><a href="#_5-2-24-hooks" class="header-anchor">#</a> 5.2.24 Hooks</h4> <p>Available hooks for querying</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// load data from database
// Preloading (eager loading)
AfterFind
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">AfterFind</span><span class="token punctuation">(</span><span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	u<span class="token punctuation">.</span>Age <span class="token operator">+=</span> <span class="token number">10</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// Hooks</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;`group` = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-2-25-pluck"><a href="#_5-2-25-pluck" class="header-anchor">#</a> 5.2.25 Pluck</h4> <p>Query single column from databases and scan into a slice, if you want to query multiple columns, use <code>Select</code> with <code>Scan</code> instead</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Pluck</span>
	<span class="token comment">// SELECT age FROM users ;</span>
	<span class="token keyword">var</span> ages <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ages<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>ages<span class="token punctuation">)</span>
	<span class="token comment">// SELECT age FROM users ;</span>
	<span class="token keyword">var</span> ages2 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ages2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>ages2<span class="token punctuation">)</span>
	<span class="token comment">// SELECT name FROM users ;</span>
	<span class="token keyword">var</span> names <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>names<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span>
	<span class="token comment">// SELECT DISTINCT `group` FROM users ;</span>
	<span class="token keyword">var</span> groups <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>groups<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_5-2-26-scopes"><a href="#_5-2-26-scopes" class="header-anchor">#</a> 5.2.26 Scopes</h4> <p><code>Scopes</code> allows you to specify commonly-used queries which can be referenced as method calls</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	<span class="token comment">// Scopes</span>
	<span class="token comment">// SELECT id,name,age,group FROM users WHERE age &gt; 15 ;</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Scopes</span><span class="token punctuation">(</span>AgeGreaterThan15<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// SELECT id,name,age,group FROM users WHERE group IN ('group_0','group_2') ;</span>
	<span class="token keyword">var</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>UserAllFields<span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Scopes</span><span class="token punctuation">(</span><span class="token function">GroupIn</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;group_0&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;group_2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users2<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">AgeGreaterThan15</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
	<span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">GroupIn</span><span class="token punctuation">(</span>groups <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
		<span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;`group` IN (?)&quot;</span><span class="token punctuation">,</span> groups<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_5-2-27-count"><a href="#_5-2-27-count" class="header-anchor">#</a> 5.2.27 Count</h4> <p>Get matched records count</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Count</span>
	<span class="token comment">// SELECT COUNT(DISTINCT(`group`)) FROM users ;</span>
	<span class="token keyword">var</span> count <span class="token builtin">int64</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token string">&quot;group&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Groups count: %d&quot;</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span>
	<span class="token comment">// SELECT COUNT(*) FROM</span>
	<span class="token keyword">var</span> count2 <span class="token builtin">int64</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>count2<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Records count: %d&quot;</span><span class="token punctuation">,</span> count2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="_5-2-28-findinbatches"><a href="#_5-2-28-findinbatches" class="header-anchor">#</a> 5.2.28 FindInBatches</h4> <p>Query and process records in batch</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// batch size 100</span>
result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;processed = ?&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">FindInBatches</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">,</span> batch <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> result <span class="token operator">:=</span> <span class="token keyword">range</span> results <span class="token punctuation">{</span>
    <span class="token comment">// batch processing found records</span>
  <span class="token punctuation">}</span>

  tx<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>

  tx<span class="token punctuation">.</span>RowsAffected <span class="token comment">// number of records in this batch</span>

  batch <span class="token comment">// Batch 1, 2, 3</span>

  <span class="token comment">// returns error will stop future batches</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

result<span class="token punctuation">.</span>Error <span class="token comment">// returned error</span>
result<span class="token punctuation">.</span>RowsAffected <span class="token comment">// processed records count in all batches</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_5-3-update"><a href="#_5-3-update" class="header-anchor">#</a> 5.3 Update</h3> <h4 id="_5-3-1-save-all-fields"><a href="#_5-3-1-save-all-fields" class="header-anchor">#</a> 5.3.1 Save All Fields</h4> <p><code>Save</code> will save all fields when performing the Updating SQL</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// INSERT INTO users (name,group,age) VALUES ('user_0','',100) ;</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET name = 'user_0',age = 100,group = 'group_0' WHERE id =1 ;</span>
	<span class="token keyword">var</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Before update&quot;</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
	user2<span class="token punctuation">.</span>Age <span class="token operator">*=</span> <span class="token number">10</span>
	db<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;After update&quot;</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><ul><li><code>Save</code>: Save update value in database, if the value doesn't have primary key, will insert it</li></ul> <h4 id="_5-3-2-update-single-column"><a href="#_5-3-2-update-single-column" class="header-anchor">#</a> 5.3.2 Update single column</h4> <p>When updating a single column with <code>Update</code>, it needs to have any conditions or it will raise error <code>ErrMissingWhereClause</code>,</p> <p>When using the <code>Model</code> method and its value has a primary value, the primary key will be used to build the condition</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Update single column</span>
	<span class="token comment">// Update with conditions</span>
	<span class="token comment">// UPDATE users SET name = 'user_0_edited' WHERE name = 'user_0' ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0_edited&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET name = 'user_1_edited' WHERE id = 2 ;</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_1_edited&quot;</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// Update with conditions and model value</span>
	<span class="token comment">// UPDATE users SET name = 'user_2_edited' WHERE id = 3 AND name = 'user_2'</span>
	user2 <span class="token operator">:=</span> User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Group<span class="token punctuation">:</span> <span class="token string">&quot;group_2&quot;</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_2_edited&quot;</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>注意：使用 <code>Model</code> 时，<code>Update</code> 之后会将更新的列值回写到对象中，故需要使用指针作为参数</p> <p><code>Model</code> 中若 <strong>主键</strong> 字段之外的字段有值，也不会作为 UPDATE 的条件，即 更新时只会将 model 中的主键字段作为条件</p> <h4 id="_5-3-3-update-multiple-columns"><a href="#_5-3-3-update-multiple-columns" class="header-anchor">#</a> 5.3.3 Update multiple columns</h4> <p><code>Updates</code> supports update with <code>struct</code> or <code>map[string]interface{}</code>, when updating with <code>struct</code> it will only update non-zero fileds by default</p> <p><strong>Note</strong></p> <p>When update with struct, GORM will only update non-zero fields, you might want to user <code>map</code> to update attributes or use <code>Select</code> to specify fields to udpate</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Update multiple columns</span>
	<span class="token comment">// Update with struct</span>
	<span class="token comment">// UPDATE users SET name = 'user_0_edited' WHERE id = 1;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0_edited&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// Update with map</span>
	<span class="token comment">// UPDATE users SET name = 'user_1_edited',age = 0 WHERE id = 2 ;</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;user_1_edited&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// Update specified fields</span>
	<span class="token comment">// UPDATE users SET name = 'user_2_edited',age = 0 WHERE id = 3 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_2_edited&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_5-3-4-udpate-selected-fields"><a href="#_5-3-4-udpate-selected-fields" class="header-anchor">#</a> 5.3.4 Udpate Selected Fields</h4> <p>If you want to update selected fields or ignore some fields when updating, you can use <code>Selcet</code>,<code>Omit</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Update selected fields</span>
	<span class="token comment">// UPDATE users SET name = 'user_0_new' WHERE id = 1 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0_new&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET age = 10 WHERE id = 2 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1_new&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// Select all fields</span>
	<span class="token comment">// UPDATE users SET id = 0,name = 'user_2_new',age = 0,group = '' WHERE id = 3;</span>
	db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_2_new&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// Select all fields but omit name</span>
	<span class="token comment">// UPDATE users SET id = 0,age = 0,group = '' WHERE id = 4;</span>
	db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Omit</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_3_new&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>注意 ：使用 <code>Select(&quot;*&quot;)</code> 后，主键也可能被修改</p> <h4 id="_5-3-5-update-hooks"><a href="#_5-3-5-update-hooks" class="header-anchor">#</a> 5.3.5 Update Hooks</h4> <p>Available hooks for updating</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// begin transaction
BeforeSave
BeforeUpdate
// save before associations
// update database
// save after associations
AfterUpdate
AfterSave
// commit or rollback transaction
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">BeforeUpdate</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Before update&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">BeforeSave</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Before save&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">AfterUpdate</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;After update&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">AfterSave</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;After save&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>

	<span class="token comment">// Update hooks</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0_new&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_5-3-6-batch-updates"><a href="#_5-3-6-batch-updates" class="header-anchor">#</a> 5.3.6 Batch Updates</h4> <p>If we haven't specified a record having primary key value with <code>Model</code>, GORM will perform a batch updates</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Update with struct</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;role = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// UPDATE users SET name='hello', age=18 WHERE role = 'admin';</span>

<span class="token comment">// Update with map</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id IN ?&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// UPDATE users SET name='hello', age=18 WHERE id IN (10, 11);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-3-7-block-global-updates"><a href="#_5-3-7-block-global-updates" class="header-anchor">#</a> 5.3.7 Block Global Updates</h4> <p>If you perform a batch update without any conditions, GORM WON'T run it and will return <code>ErrMissingWhereClause</code> error by default</p> <p>You have to use some conditions or use raw SQL or enable the <code>AllowGlobalUpdate</code> mode</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
	<span class="token comment">// Global Update</span>
	<span class="token comment">// ErrMissingWhereClause</span>
	err <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;new_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Error
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span><span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET name = 'new_name' WHERE 1 = 1;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;1 = 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;new_name&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET name = 'name_global_update' ;</span>
	db<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Session<span class="token punctuation">{</span>AllowGlobalUpdate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name_global_update&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_5-3-8-updated-records-count"><a href="#_5-3-8-updated-records-count" class="header-anchor">#</a> 5.3.8 Updated Records Count</h4> <p>Get the number of rows affected by a update</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Get updated records count with `RowsAffected`</span>
result <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;role = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// UPDATE users SET name='hello', age=18 WHERE role = 'admin';</span>

result<span class="token punctuation">.</span>RowsAffected <span class="token comment">// returns updated records count</span>
result<span class="token punctuation">.</span>Error        <span class="token comment">// returns updating error</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_5-3-9-update-with-sql-expression"><a href="#_5-3-9-update-with-sql-expression" class="header-anchor">#</a> 5.3.9 Update with SQL Expression</h4> <p>GORM allows updates column with SQL expression</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Update with SQL expression</span>
	<span class="token comment">// UPDATE users SET age = age * 2 + 100 WHERE id = 1;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age * ? + ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET name = name || '123' WHERE id = 2 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;name || ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET age = age * 100 WHERE id = 3 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UpdateColumn</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age * ?&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这里出现了 <code>UpdateColumn</code>,作用和<code>Update</code> 是一样的，那么有什么区别呢</p> <p>这里看下源码</p> <p><code>Update</code>:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Update update attributes with callbacks, refer: https://gorm.io/docs/update.html#Update-Changed-Fields</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>DB<span class="token punctuation">)</span> <span class="token function">Update</span><span class="token punctuation">(</span>column <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>tx <span class="token operator">*</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   tx <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Dest <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>column<span class="token punctuation">:</span> value<span class="token punctuation">}</span>
   <span class="token keyword">return</span> tx<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>UpdateColumn</code>:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>db <span class="token operator">*</span>DB<span class="token punctuation">)</span> <span class="token function">UpdateColumn</span><span class="token punctuation">(</span>column <span class="token builtin">string</span><span class="token punctuation">,</span> value <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>tx <span class="token operator">*</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	tx <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Dest <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span>column<span class="token punctuation">:</span> value<span class="token punctuation">}</span>
	tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>SkipHooks <span class="token operator">=</span> <span class="token boolean">true</span>
	<span class="token keyword">return</span> tx<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看到 <code>UpdateColumn</code> 会跳过 hooks，后续的文档还会告诉 <code>UpdateColumn</code> 将不会追踪 update time，这里接着看源码</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>
<span class="token comment">// ConvertToAssignments convert to update assignments</span>
<span class="token keyword">func</span> <span class="token function">ConvertToAssignments</span><span class="token punctuation">(</span>stmt <span class="token operator">*</span>gorm<span class="token punctuation">.</span>Statement<span class="token punctuation">)</span> <span class="token punctuation">(</span>set clause<span class="token punctuation">.</span>Set<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>stmt<span class="token punctuation">.</span>SkipHooks <span class="token operator">&amp;&amp;</span> stmt<span class="token punctuation">.</span>Schema <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> dbName <span class="token operator">:=</span> <span class="token keyword">range</span> stmt<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>DBNames <span class="token punctuation">{</span>
				field <span class="token operator">:=</span> stmt<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span><span class="token function">LookUpField</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
				<span class="token keyword">if</span> field<span class="token punctuation">.</span>AutoUpdateTime <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">[</span>field<span class="token punctuation">.</span>Name<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">[</span>field<span class="token punctuation">.</span>DBName<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> selectColumns<span class="token punctuation">[</span>field<span class="token punctuation">.</span>DBName<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>ok <span class="token operator">&amp;&amp;</span> v<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
						now <span class="token operator">:=</span> stmt<span class="token punctuation">.</span>DB<span class="token punctuation">.</span><span class="token function">NowFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
						<span class="token function">assignValue</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> now<span class="token punctuation">)</span>

						<span class="token keyword">if</span> field<span class="token punctuation">.</span>AutoUpdateTime <span class="token operator">==</span> schema<span class="token punctuation">.</span>UnixNanosecond <span class="token punctuation">{</span>
							set <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> clause<span class="token punctuation">.</span>Assignment<span class="token punctuation">{</span>Column<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> field<span class="token punctuation">.</span>DBName<span class="token punctuation">}</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> now<span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> field<span class="token punctuation">.</span>AutoUpdateTime <span class="token operator">==</span> schema<span class="token punctuation">.</span>UnixMillisecond <span class="token punctuation">{</span>
							set <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> clause<span class="token punctuation">.</span>Assignment<span class="token punctuation">{</span>Column<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> field<span class="token punctuation">.</span>DBName<span class="token punctuation">}</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> now<span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1e6</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> field<span class="token punctuation">.</span>GORMDataType <span class="token operator">==</span> schema<span class="token punctuation">.</span>Time <span class="token punctuation">{</span>
							set <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> clause<span class="token punctuation">.</span>Assignment<span class="token punctuation">{</span>Column<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> field<span class="token punctuation">.</span>DBName<span class="token punctuation">}</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> now<span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							set <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>set<span class="token punctuation">,</span> clause<span class="token punctuation">.</span>Assignment<span class="token punctuation">{</span>Column<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> field<span class="token punctuation">.</span>DBName<span class="token punctuation">}</span><span class="token punctuation">,</span> Value<span class="token punctuation">:</span> now<span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
 <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>可以看到当 <code>skipHooks</code> 为 false 时，更新操作将不会追踪更新时间</p> <h4 id="_5-3-10-update-from-subquery"><a href="#_5-3-10-update-from-subquery" class="header-anchor">#</a> 5.3.10 Update from SubQuery</h4> <p>Update a table by using SubQuery</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Update From SubQuery</span>
	<span class="token comment">// UPDATE users SET name = name || (SELECT email FROM emails WHERE emails.user_id = users.id) WHERE id = 1 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;name || (?)&quot;</span><span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Email<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
			<span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;emails.user_id = users.id &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5-3-11-without-hooks-time-tracking"><a href="#_5-3-11-without-hooks-time-tracking" class="header-anchor">#</a> 5.3.11 Without Hooks/Time Tracking</h4> <p>If you want to skip <code>Hooks</code> methods and don’t track the update time when updating, you can use <code>UpdateColumn</code>,<code>UpdateColumns</code>, it  works like <code>Update</code>,<code>Updates</code></p> <h4 id="_5-3-12-returning-data-from-modified-rows"><a href="#_5-3-12-returning-data-from-modified-rows" class="header-anchor">#</a> 5.3.12 Returning Data From Modified Rows</h4> <p>Return changed data, only works for database support Returning, for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// return all columns</span>
<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
DB<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Returning<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;role = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;salary * ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// UPDATE `users` SET `salary`=salary * 2,`updated_at`=&quot;2021-10-28 17:37:23.19&quot; WHERE role = &quot;admin&quot; RETURNING *</span>
<span class="token comment">// users =&gt; []User{{ID: 1, Name: &quot;jinzhu&quot;, Role: &quot;admin&quot;, Salary: 100}, {ID: 2, Name: &quot;jinzhu.2&quot;, Role: &quot;admin&quot;, Salary: 1000}}</span>

<span class="token comment">// return specified columns</span>
DB<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Returning<span class="token punctuation">{</span>Columns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;salary&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;role = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;salary&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;salary * ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// UPDATE `users` SET `salary`=salary * 2,`updated_at`=&quot;2021-10-28 17:37:23.19&quot; WHERE role = &quot;admin&quot; RETURNING `name`, `salary`</span>
<span class="token comment">// users =&gt; []User{{ID: 0, Name: &quot;jinzhu&quot;, Role: &quot;&quot;, Salary: 100}, {ID: 0, Name: &quot;jinzhu.2&quot;, Role: &quot;&quot;, Salary: 1000}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_5-3-13-check-field-has-changed"><a href="#_5-3-13-check-field-has-changed" class="header-anchor">#</a> 5.3.13 Check Field has changed</h4> <p>GORM provides <code>Changed</code> method could be used in <code>BeforeUpdate</code> hooks, it will return the field changed or not</p> <p>The <code>Changed</code> method only works with methods <code>Update</code>,<code>Updates</code>, and it only checks if the updating value from <code>Update</code>/<code>Updates</code> equals the model value, will return true if it is changed and not omitted</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// ...</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>u <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">BeforeUpdate</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// if age changed</span>
	<span class="token keyword">if</span> tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">Changed</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;name changed&quot;</span><span class="token punctuation">)</span>
		tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">SetColumn</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// if name or age changed</span>
	<span class="token keyword">if</span> tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">Changed</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;name or age changed&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// if any fields changed</span>
	<span class="token keyword">if</span> tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">Changed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;any fields changed&quot;</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
	<span class="token comment">// Check Field has changed</span>
	<span class="token comment">// UPDATE users SET name = 'new_name',age = 100  WHERE id = 1 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;new_name&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET age = age * 2 WHERE id =2  ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">11</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> gorm<span class="token punctuation">.</span><span class="token function">Expr</span><span class="token punctuation">(</span><span class="token string">&quot;age * ?&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token comment">// UPDATE users SET name = 'new_name',age = 1300 WHERE id = 3 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Updates</span><span class="token punctuation">(</span>User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;new_name&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">1300</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_5-3-14-change-updating-values"><a href="#_5-3-14-change-updating-values" class="header-anchor">#</a> 5.3.14 Change Updating Values</h4> <p>To change updating values in Before Hooks, you should use <code>SetColumn</code> unless it is a full updates with <code>Save</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>user <span class="token operator">*</span>User<span class="token punctuation">)</span> <span class="token function">BeforeSave</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> pw<span class="token punctuation">,</span> err <span class="token operator">:=</span> bcrypt<span class="token punctuation">.</span><span class="token function">GenerateFromPassword</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Password<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">SetColumn</span><span class="token punctuation">(</span><span class="token string">&quot;EncryptedPassword&quot;</span><span class="token punctuation">,</span> pw<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">Changed</span><span class="token punctuation">(</span><span class="token string">&quot;Code&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    s<span class="token punctuation">.</span>Age <span class="token operator">+=</span> <span class="token number">20</span>
    tx<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span><span class="token function">SetColumn</span><span class="token punctuation">(</span><span class="token string">&quot;Age&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>Age<span class="token operator">+</span><span class="token number">20</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_5-4-delete"><a href="#_5-4-delete" class="header-anchor">#</a> 5.4 Delete</h3> <h4 id="_5-4-1-delete-a-record"><a href="#_5-4-1-delete-a-record" class="header-anchor">#</a> 5.4.1 Delete a  Record</h4> <p>When deleting a record, the deleted value needs to have primary key or it will trigger a batch delete</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Delete a Record</span>
	<span class="token comment">// DELETE FROM users WHERE id = 1;</span>
	user <span class="token operator">:=</span> User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// Error: WHERE conditions required</span>
	user2 <span class="token operator">:=</span> User<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_1&quot;</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
	<span class="token comment">// DELETE FROM users WHERE id = 3 AND name = 'user_2' ;</span>
	user3 <span class="token operator">:=</span> User<span class="token punctuation">{</span>ID<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user3<span class="token punctuation">)</span>
	<span class="token comment">// DELETE FROM users WHERE name = 'user_3' ;</span>
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>删除时需要传入的 struct 中包含主键值，若没有且未定义其他条件则会返错误；</p> <p>若 struct 中包含主键值之外的字段值，除主键之外的字段将不会用于构成删除条件，这点和 update 类似</p> <p>可以使用 <code>Where</code>  手动添加条件</p> <h4 id="_5-4-2-delete-with-primary-key"><a href="#_5-4-2-delete-with-primary-key" class="header-anchor">#</a> 5.4.2 Delete with primary key</h4> <p>GORM allows to delete objects using primary key(s) with inline condition, it works with numbers</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Delete with primary key</span>
	<span class="token comment">// DELETE FROM users WHERE id = 1;</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token comment">// DELETE FROM users WHERE id = 2 ;</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
	<span class="token comment">// DELETE FROM users WHERE id IN (3,4,5) ;</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5-4-3-delete-hooks"><a href="#_5-4-3-delete-hooks" class="header-anchor">#</a> 5.4.3 Delete Hooks</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>// begin transaction
BeforeDelete
// delete from database
AfterDelete
// commit or rollback transaction
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">BeforeDelete</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Before Delete&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>User<span class="token punctuation">)</span> <span class="token function">AfterDelete</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">(</span>err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;After Delete&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_5-4-4-batch-delete"><a href="#_5-4-4-batch-delete" class="header-anchor">#</a> 5.4.4 Batch Delete</h4> <p>The specified values has no primary value, GORM will perform a batch delete, it will delete all mathed records</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// DELETE FROM users WHERE age &gt; 10 ;</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; ?&quot;</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-4-5-block-global-delete"><a href="#_5-4-5-block-global-delete" class="header-anchor">#</a> 5.4.5 Block Global Delete</h4> <p>If you perform a batch delete without any conditions, GORM WON’T run it, and will return <code>ErrMissingWhereClause</code> error</p> <p>You have to use some conditions or use raw SQL or enable <code>AllowGlobalUpdate</code> mode</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// DELTE FROM users ;</span>
db<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Session<span class="token punctuation">{</span>AllowGlobalUpdate<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_5-4-6-returning-data-from-deleted-rows"><a href="#_5-4-6-returning-data-from-deleted-rows" class="header-anchor">#</a> 5.4.6 Returning Data From Deleted Rows</h4> <p>Return deleted data, only works for database support Returning, for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// return all columns</span>
<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
DB<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Returning<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;role = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// DELETE FROM `users` WHERE role = &quot;admin&quot; RETURNING *</span>
<span class="token comment">// users =&gt; []User{{ID: 1, Name: &quot;jinzhu&quot;, Role: &quot;admin&quot;, Salary: 100}, {ID: 2, Name: &quot;jinzhu.2&quot;, Role: &quot;admin&quot;, Salary: 1000}}</span>

<span class="token comment">// return specified columns</span>
DB<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Returning<span class="token punctuation">{</span>Columns<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span><span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;salary&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;role = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">)</span>
<span class="token comment">// DELETE FROM `users` WHERE role = &quot;admin&quot; RETURNING `name`, `salary`</span>
<span class="token comment">// users =&gt; []User{{ID: 0, Name: &quot;jinzhu&quot;, Role: &quot;&quot;, Salary: 100}, {ID: 0, Name: &quot;jinzhu.2&quot;, Role: &quot;&quot;, Salary: 1000}}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_5-4-7-soft-delete"><a href="#_5-4-7-soft-delete" class="header-anchor">#</a> 5.4.7  Soft Delete</h4> <p>If your model includes a <code>gorm.DeletedAt</code> field (which is included in <code>gorm.Model</code>), it will get soft delete ability automatically</p> <p>When calling <code>Delete</code>, the record WON’T be removed from the database, but GORM will set the <code>DeletedAt</code>'s value to the current time, and the data is not findable with normal Query methods anymore</p> <p>If you don’t want to include <code>grom.Model</code>, you can enable the soft delete feature like:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    ID <span class="token builtin">int</span> 
    DeletedAt gorm<span class="token punctuation">.</span>DeletedAt
    Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Find soft deleted records</strong></p> <p>You can find soft deleted records with <code>Unscoped</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	DeletedAt gorm<span class="token punctuation">.</span>DeletedAt
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>
	<span class="token comment">// Soft Delete</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// cannot find</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// find with unscoped</span>
	<span class="token keyword">var</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="_5-4-8-delete-permanetly"><a href="#_5-4-8-delete-permanetly" class="header-anchor">#</a> 5.4.8 Delete permanetly</h4> <p>You can delete matched records permanetly with <code>Unscoped</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>order<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5-4-9-delete-flag"><a href="#_5-4-9-delete-flag" class="header-anchor">#</a> 5.4.9 Delete Flag</h4> <p>Use unix second as delete flag</p> <p>when using unique field with soft delete, you should create a composite index with the unix second based <code>DeletedAt</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	<span class="token comment">// ...</span>
	DeletedAt soft_delete<span class="token punctuation">.</span>DeletedAt <span class="token string">`gorm:&quot;uniqueIndex:udx_name&quot;`</span>
	<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
	<span class="token comment">// delete flag</span>
	db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">// cannot find</span>
	<span class="token keyword">var</span> users <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
	<span class="token comment">// find with unscoped</span>
	<span class="token keyword">var</span> users2 <span class="token punctuation">[</span><span class="token punctuation">]</span>User
	db<span class="token punctuation">.</span><span class="token function">Unscoped</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>users2<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>users2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>Use <code>1</code> / <code>0</code> as delete flag</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;gorm.io/plugin/soft_delete&quot;</span>

<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID    <span class="token builtin">uint</span>
  Name  <span class="token builtin">string</span>
  IsDel soft_delete<span class="token punctuation">.</span>DeletedAt <span class="token string">`gorm:&quot;softDelete:flag&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// Query</span>
SELECT <span class="token operator">*</span> FROM users WHERE is_del <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// Delete</span>
UPDATE users SET is_del <span class="token operator">=</span> <span class="token number">1</span> WHERE ID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="_6-raw-sql-and-sql-builder"><a href="#_6-raw-sql-and-sql-builder" class="header-anchor">#</a> 6. Raw SQL and SQL Builder</h2> <h3 id="_6-1-raw-sql"><a href="#_6-1-raw-sql" class="header-anchor">#</a> 6.1 Raw SQL</h3> <p>Query Raw SQL with <code>Scan</code>, <code>Exec</code> with Raw SQL</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Raw SQL</span>
	<span class="token comment">// Scan</span>
	<span class="token keyword">var</span> result <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id,name,age FROM users WHERE id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
	<span class="token keyword">var</span> results <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id,name FROM users WHERE age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>results<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
	<span class="token keyword">var</span> sumAge <span class="token builtin">int</span>
	db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT SUM(age) FROM users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sumAge<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Sum age: &quot;</span><span class="token punctuation">,</span> sumAge<span class="token punctuation">)</span>
	<span class="token comment">// Exec</span>
	db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;UPDATE users SET age = age + ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><strong>NOTE</strong></p> <p>GORM allows cache prepared statement to increase performance</p> <h3 id="_6-2-named-argument"><a href="#_6-2-named-argument" class="header-anchor">#</a> 6.2 Named Argument</h3> <p>GORM supports named argument with <code>sql.NamedArg</code>, <code>map[string]interface{}</code> or struct</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// Named argument</span>
	<span class="token comment">// SELECT * FROM users WHERE name = 'user_0' LIMIT 1;</span>
	<span class="token keyword">var</span> user User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = @name&quot;</span><span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token comment">// SELECT * FROM users WHERE age = 12 LIMIT 1 ;</span>
	<span class="token keyword">var</span> user2 User
	db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age = @age &quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span>
	<span class="token comment">// Named Argument with Raw SQL</span>
	<span class="token keyword">var</span> result <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT id,name FROM users WHERE age = @age OR id = @id &quot;</span><span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sql<span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
	<span class="token keyword">var</span> result2 <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT name,age FROM users WHERE id = @id OR age &gt; @age&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">:</span> <span class="token number">13</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result2<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
	<span class="token comment">// struct</span>
	<span class="token keyword">type</span> NameArg <span class="token keyword">struct</span> <span class="token punctuation">{</span>
		Name <span class="token builtin">string</span>
		Age  <span class="token builtin">int</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">var</span> result3 <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
	db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT * FROM users WHERE name = @Name AND age = @Age&quot;</span><span class="token punctuation">,</span> NameArg<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">,</span> Age<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>result3<span class="token punctuation">)</span>
	utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>result3<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_6-3-dryrun-mode"><a href="#_6-3-dryrun-mode" class="header-anchor">#</a> 6.3 DryRun Mode</h3> <p>Generate <code>SQL</code> and its arguments without executing, can be used to prepare or test generated SQL</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// DryRun</span>
	stmt <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Session</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Session<span class="token punctuation">{</span>DryRun<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;id = ?&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Statement
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;SQL: %s, VAL: %v&quot;</span><span class="token punctuation">,</span> stmt<span class="token punctuation">.</span>SQL<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> stmt<span class="token punctuation">.</span>Vars<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_6-4-tosql"><a href="#_6-4-tosql" class="header-anchor">#</a> 6.4 ToSQL</h3> <p>Returns generated <code>SQL</code> without executing</p> <p>GORM uses the databases/sql's argument placeholders to construct the SQL statement, which will automatically escape arguments to avoid SQL injection, but the generated SQL don't provide the safety gurantees, please only use it for debugging</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>	<span class="token comment">// DryRun</span>
	sql <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">ToSQL</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>tx <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB <span class="token punctuation">{</span>
		<span class="token keyword">return</span> tx<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;SQL: &quot;</span><span class="token punctuation">,</span> sql<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_6-5-row-and-rows"><a href="#_6-5-row-and-rows" class="header-anchor">#</a> 6.5 <code>Row</code> and <code>Rows</code></h3> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Row and Rows</span>
	<span class="token comment">// Row</span>
	<span class="token keyword">var</span> <span class="token punctuation">(</span>
		name <span class="token builtin">string</span>
		age  <span class="token builtin">int</span>
	<span class="token punctuation">)</span>
	row <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; 10&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;user_0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;age desc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
		<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	row<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>age<span class="token punctuation">)</span>
	log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Name: %s,Age: %d&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>
	<span class="token comment">// Rows</span>
	rows<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;age &gt; ?&quot;</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">defer</span> rows<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> rows<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">var</span> name <span class="token builtin">string</span>
		<span class="token keyword">var</span> age <span class="token builtin">int</span>
		rows<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>age<span class="token punctuation">)</span>
		log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Row[name: %s,Age: %d]&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span>
		<span class="token comment">// Scan rows to struct</span>
		<span class="token keyword">var</span> user User
		db<span class="token punctuation">.</span><span class="token function">ScanRows</span><span class="token punctuation">(</span>rows<span class="token punctuation">,</span> <span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
		utils<span class="token punctuation">.</span><span class="token function">PrintRecord</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li><code>Row()</code>: get result as <code>*sql.Row</code></li> <li><code>Rows()</code>: get result as <code>*sql.Rows</code></li> <li><code>ScanRows</code>: scan rows into struct</li></ul> <h3 id="_6-6-clauses"><a href="#_6-6-clauses" class="header-anchor">#</a> 6.6 Clauses</h3> <p>GORM uses SQL builder generates SQL internally, for each operation, GORM creates a <code>*gorm.Statement</code> object, all GORM APIs add/change <code>Clause</code> for the <code>Statement</code>, at last, GORM generated SQL based on those clauses</p> <p>For example, when querying with <code>First</code>, it adds the following clauses to the <code>Statement</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>clause<span class="token punctuation">.</span>Select<span class="token punctuation">{</span>Columns<span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">}</span>
clause<span class="token punctuation">.</span>From<span class="token punctuation">{</span>Tables<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>CurrentTable<span class="token punctuation">}</span>
clause<span class="token punctuation">.</span>Limit<span class="token punctuation">{</span>Limit<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
clause<span class="token punctuation">.</span>OrderByColumn<span class="token punctuation">{</span>
  Column<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>Column<span class="token punctuation">{</span>Table<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>CurrentTable<span class="token punctuation">,</span> Name<span class="token punctuation">:</span> clause<span class="token punctuation">.</span>PrimaryKey<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Then GORM build finally querying SQL in the <code>Query</code> callbacks like:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>Statement<span class="token punctuation">.</span><span class="token function">Build</span><span class="token punctuation">(</span><span class="token string">&quot;SELECT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FROM&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;WHERE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP BY&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ORDER BY&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;LIMIT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;FOR&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Which generate SQL:</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">`</span>users<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_6-7-clause-options"><a href="#_6-7-clause-options" class="header-anchor">#</a> 6.7 Clause Options</h3> <p>GORM defined <a href="https://github.com/go-gorm/gorm/tree/master/clause" target="_blank" rel="noopener noreferrer">Many Clauses<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, and some clauses provide advanced options can be used for your application</p> <p>Although most of them are rarely used, if you find GORM public API can’t match your requirements, may be good to check them out, for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Insert<span class="token punctuation">{</span>Modifier<span class="token punctuation">:</span> <span class="token string">&quot;IGNORE&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
<span class="token comment">// INSERT IGNORE INTO users (name,age...) VALUES (&quot;jinzhu&quot;,18...);</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_6-8-statementmodifier"><a href="#_6-8-statementmodifier" class="header-anchor">#</a> 6.8 StatementModifier</h3> <p>GORM provides interface <a href="https://pkg.go.dev/gorm.io/gorm?tab=doc#StatementModifier" target="_blank" rel="noopener noreferrer">StatementModifier<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> allows you modify statement to match your requirements, take <a href="https://gorm.io/docs/hints.html" target="_blank" rel="noopener noreferrer">Hints<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as example</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;gorm.io/hints&quot;</span>

db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>hints<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;hint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * /*+ hint */ FROM `users`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ol><li><a href="%5Bhttps://gorm.io%5D(https://gorm.io/)">gorm</a></li> <li><a href="https://github.com/go-gorm/gorm/issues/4218" target="_blank" rel="noopener noreferrer">What is the difference between <code>Find</code> and <code>Scan</code>， Can I replace <code>Scan</code> with <code>Find</code> ？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> grom issue</li> <li><a href="https://stackoverflow.com/questions/45953553/what-is-the-syntax-for-select-in-statement-for-sqlite" target="_blank" rel="noopener noreferrer">What is the syntax for SELECT IN statement for SQLITE?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> stackoverflow</li> <li><a href="https://www.sqlitetutorial.net/sqlite-full-outer-join/" target="_blank" rel="noopener noreferrer">SQLite FULL OUTER JOIN Emulation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> sqlitetutorial</li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2021/12/20 22:52:58</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/zh/golang/gorm/01.1.html" class="prev">
            Gorm
          </a></span> <span class="next"><a href="/zh/golang/gorm/01.3.html">
            Associations
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_5-crud" class="sidebar-link reco-side-_5-crud" data-v-898d6c54>5. CRUD</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_5-1-create" class="sidebar-link reco-side-_5-1-create" data-v-898d6c54>5.1 Create</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_5-2-read" class="sidebar-link reco-side-_5-2-read" data-v-898d6c54>5.2 Read</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_5-3-update" class="sidebar-link reco-side-_5-3-update" data-v-898d6c54>5.3 Update</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_5-4-delete" class="sidebar-link reco-side-_5-4-delete" data-v-898d6c54>5.4 Delete</a></li><li class="level-2" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-raw-sql-and-sql-builder" class="sidebar-link reco-side-_6-raw-sql-and-sql-builder" data-v-898d6c54>6. Raw SQL and SQL Builder</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-1-raw-sql" class="sidebar-link reco-side-_6-1-raw-sql" data-v-898d6c54>6.1 Raw SQL</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-2-named-argument" class="sidebar-link reco-side-_6-2-named-argument" data-v-898d6c54>6.2 Named Argument</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-3-dryrun-mode" class="sidebar-link reco-side-_6-3-dryrun-mode" data-v-898d6c54>6.3 DryRun Mode</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-4-tosql" class="sidebar-link reco-side-_6-4-tosql" data-v-898d6c54>6.4 ToSQL</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-5-row-and-rows" class="sidebar-link reco-side-_6-5-row-and-rows" data-v-898d6c54>6.5 Row and Rows</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-6-clauses" class="sidebar-link reco-side-_6-6-clauses" data-v-898d6c54>6.6 Clauses</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-7-clause-options" class="sidebar-link reco-side-_6-7-clause-options" data-v-898d6c54>6.7 Clause Options</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#_6-8-statementmodifier" class="sidebar-link reco-side-_6-8-statementmodifier" data-v-898d6c54>6.8 StatementModifier</a></li><li class="level-2" data-v-898d6c54><a href="/zh/golang/gorm/01.2.html#reference" class="sidebar-link reco-side-reference" data-v-898d6c54>Reference</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div id="goTop" class="hide-cat" data-v-bf92849a></div></div></div>
    <script src="/assets/js/app.b38e2a09.js" defer></script><script src="/assets/js/6.fb8c21e5.js" defer></script><script src="/assets/js/1.3bdf79e4.js" defer></script><script src="/assets/js/96.54e50cf2.js" defer></script>
  </body>
</html>
