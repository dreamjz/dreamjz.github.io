<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced Topics | 今朝のブログ</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>
    <link rel="shortcut icon" herf="favicon.ico">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-3RQ3LRSTKM"></script>
    <script>window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
		  
			gtag('config', 'G-3RQ3LRSTKM');</script>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="google-site-verification" content="lHBWOiWCnBWvc1h4REqjllalv9ZpQbXbHDdM8chFuuw">
    
    <link rel="preload" href="/assets/css/0.styles.e8c9bca8.css" as="style"><link rel="preload" href="/assets/js/app.c591e8d8.js" as="script"><link rel="preload" href="/assets/js/5.94f54d66.js" as="script"><link rel="preload" href="/assets/js/1.7ee7f9d3.js" as="script"><link rel="preload" href="/assets/js/52.e414baaa.js" as="script"><link rel="prefetch" href="/assets/js/10.6a4b5ae5.js"><link rel="prefetch" href="/assets/js/11.3f95f62e.js"><link rel="prefetch" href="/assets/js/12.b33964d5.js"><link rel="prefetch" href="/assets/js/13.04db2a80.js"><link rel="prefetch" href="/assets/js/14.bc07bf28.js"><link rel="prefetch" href="/assets/js/15.1656b657.js"><link rel="prefetch" href="/assets/js/16.671fcfb0.js"><link rel="prefetch" href="/assets/js/17.2e3a2370.js"><link rel="prefetch" href="/assets/js/18.12277848.js"><link rel="prefetch" href="/assets/js/19.115759da.js"><link rel="prefetch" href="/assets/js/2.1e48f163.js"><link rel="prefetch" href="/assets/js/20.b693a711.js"><link rel="prefetch" href="/assets/js/21.9642175e.js"><link rel="prefetch" href="/assets/js/22.7cf4df59.js"><link rel="prefetch" href="/assets/js/23.da251313.js"><link rel="prefetch" href="/assets/js/24.c1fab25d.js"><link rel="prefetch" href="/assets/js/25.3865f198.js"><link rel="prefetch" href="/assets/js/26.dea3a207.js"><link rel="prefetch" href="/assets/js/27.f6dff718.js"><link rel="prefetch" href="/assets/js/28.de048bf1.js"><link rel="prefetch" href="/assets/js/29.cb2caa47.js"><link rel="prefetch" href="/assets/js/30.6899767f.js"><link rel="prefetch" href="/assets/js/31.9ac9017a.js"><link rel="prefetch" href="/assets/js/32.8bad742a.js"><link rel="prefetch" href="/assets/js/33.0a73a806.js"><link rel="prefetch" href="/assets/js/34.ed11eea2.js"><link rel="prefetch" href="/assets/js/35.ff8ed27c.js"><link rel="prefetch" href="/assets/js/36.fa43da6e.js"><link rel="prefetch" href="/assets/js/37.bee86749.js"><link rel="prefetch" href="/assets/js/38.e2cea53f.js"><link rel="prefetch" href="/assets/js/39.75049fec.js"><link rel="prefetch" href="/assets/js/40.bcb379b7.js"><link rel="prefetch" href="/assets/js/41.aa409f47.js"><link rel="prefetch" href="/assets/js/42.11f8198a.js"><link rel="prefetch" href="/assets/js/43.271cde75.js"><link rel="prefetch" href="/assets/js/44.133f35aa.js"><link rel="prefetch" href="/assets/js/45.cac78597.js"><link rel="prefetch" href="/assets/js/46.8cfffb45.js"><link rel="prefetch" href="/assets/js/47.5fda3aac.js"><link rel="prefetch" href="/assets/js/48.c8812eea.js"><link rel="prefetch" href="/assets/js/49.16db54b3.js"><link rel="prefetch" href="/assets/js/50.fd197262.js"><link rel="prefetch" href="/assets/js/51.f29f5404.js"><link rel="prefetch" href="/assets/js/53.df179077.js"><link rel="prefetch" href="/assets/js/54.8450abf8.js"><link rel="prefetch" href="/assets/js/55.53430f2c.js"><link rel="prefetch" href="/assets/js/56.b25c3ba0.js"><link rel="prefetch" href="/assets/js/57.6ca54126.js"><link rel="prefetch" href="/assets/js/58.1adb3ee9.js"><link rel="prefetch" href="/assets/js/59.5e2a7e43.js"><link rel="prefetch" href="/assets/js/6.246a2818.js"><link rel="prefetch" href="/assets/js/60.6579bc21.js"><link rel="prefetch" href="/assets/js/61.063f5dd3.js"><link rel="prefetch" href="/assets/js/62.a55a11d4.js"><link rel="prefetch" href="/assets/js/7.50146241.js"><link rel="prefetch" href="/assets/js/8.9afac701.js"><link rel="prefetch" href="/assets/js/9.24fd4584.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.1dd0e98e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e8c9bca8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-0f44a727><div data-v-0f44a727><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-0f44a727 data-v-0f44a727><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-355e03f9 data-v-0f44a727 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>今朝のブログ</h3> <p class="description" data-v-355e03f9 data-v-355e03f9></p> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>今朝</span>
            
          <!---->
          2021
        </a></span></div></div> <div class="hide" data-v-0f44a727><header class="navbar" data-v-0f44a727><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/image/hero.jpg" alt="今朝のブログ" class="logo"> <span class="site-name">今朝のブログ</span></a> <div class="links"><!----> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/golang/one.html" class="nav-link"><i class="undefined"></i>
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/zh/git.html" class="nav-link"><i class="undefined"></i>
  Git
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="https://github.com/dreamjz" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-0f44a727></div> <aside class="sidebar" data-v-0f44a727><div class="personal-info-wrapper" data-v-5aaeb100 data-v-0f44a727><img src="/image/hero.jpg" alt="author-avatar" class="personal-img" data-v-5aaeb100> <h3 class="name" data-v-5aaeb100>
    今朝
  </h3> <div class="num" data-v-5aaeb100><div data-v-5aaeb100><h3 data-v-5aaeb100>41</h3> <h6 data-v-5aaeb100>文章</h6></div> <div data-v-5aaeb100><h3 data-v-5aaeb100>14</h3> <h6 data-v-5aaeb100>标签</h6></div></div> <ul class="social-links" data-v-5aaeb100></ul> <hr data-v-5aaeb100></div> <nav class="nav-links"><div class="nav-item"><a href="/zh/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/zh/golang/one.html" class="nav-link"><i class="undefined"></i>
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/zh/git.html" class="nav-link"><i class="undefined"></i>
  Git
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/tags/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tags
</a></div><div class="nav-item"><a href="https://github.com/dreamjz" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav> <ul class="sidebar-links"><li><a href="/zh/" aria-current="page" class="sidebar-link">Welcome</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Raspberry Pi</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Front End</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-355e03f9 data-v-0f44a727><h3 class="title" data-v-355e03f9 data-v-355e03f9>Advanced Topics</h3> <!----> <label id="box" class="inputBox" data-v-355e03f9 data-v-355e03f9><input type="password" value="" data-v-355e03f9> <span data-v-355e03f9>Konck! Knock!</span> <button data-v-355e03f9>OK</button></label> <div class="footer" data-v-355e03f9 data-v-355e03f9><span data-v-355e03f9><i class="iconfont reco-theme" data-v-355e03f9></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-355e03f9>vuePress-theme-reco</a></span> <span data-v-355e03f9><i class="iconfont reco-copyright" data-v-355e03f9></i> <a data-v-355e03f9><span data-v-355e03f9>今朝</span>
            
          <!---->
          2021
        </a></span></div></div> <div data-v-0f44a727><div id="particles-js" color="#dedede" particleOpacity="0.7" linesColor="#dedede" particlesNumber="80" shapeType="circle" particleSize="4" linesWidth="1" lineLinked="true" lineOpacity="0.4" linesDistance="150" moveSpeed="3" hoverEffect="true" hoverMode="grab" clickEffect="true" clickMode="push" class="bg-particles"></div> <main class="page"><section><div class="page-title"><h1 class="title">Advanced Topics</h1> <div data-v-ff1aa866><i class="iconfont reco-account" data-v-ff1aa866><span data-v-ff1aa866>今朝</span></i> <i class="iconfont reco-date" data-v-ff1aa866><span data-v-ff1aa866>2021/12/3</span></i> <!----> <i class="tags iconfont reco-tag" data-v-ff1aa866><span class="tag-item" data-v-ff1aa866>gorm</span></i></div></div> <div class="theme-reco-content content__default"><h2 id="_9-advanced-topics"><a href="#_9-advanced-topics" class="header-anchor">#</a> 9. Advanced Topics</h2> <h3 id="_9-1-dbresolver"><a href="#_9-1-dbresolver" class="header-anchor">#</a> 9.1 DBResolver</h3> <p>DBResolver adds muliple databases support to GORM, the following features are supported</p> <ul><li><p>Multiple sources, replicas</p></li> <li><p>Read/Write Splitting</p></li> <li><p>Automatic connection switching based on the working table/struct</p></li> <li><p>Manual connection switching</p></li> <li><p>Sources/Replicas load balancing</p></li> <li><p>Works for RAW SQL</p> <p>https://github.com/go-gorm/dbresolver</p></li></ul> <h4 id="_9-1-1-usage"><a href="#_9-1-1-usage" class="header-anchor">#</a> 9.1.1 Usage</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;gorm.io/gorm&quot;</span>
  <span class="token string">&quot;gorm.io/plugin/dbresolver&quot;</span>
  <span class="token string">&quot;gorm.io/driver/mysql&quot;</span>
<span class="token punctuation">)</span>

db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db1_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  <span class="token comment">// use `db2` as sources, `db3`, `db4` as replicas</span>
  Sources<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span>gorm<span class="token punctuation">.</span>Dialector<span class="token punctuation">{</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db2_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  Replicas<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>gorm<span class="token punctuation">.</span>Dialector<span class="token punctuation">{</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db3_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db4_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// sources/replicas load balancing policy</span>
  Policy<span class="token punctuation">:</span> dbresolver<span class="token punctuation">.</span>RandomPolicy<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  <span class="token comment">// use `db1` as sources (DB's default connection), `db5` as replicas for `User`, `Address`</span>
  Replicas<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>gorm<span class="token punctuation">.</span>Dialector<span class="token punctuation">{</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db5_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Address<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  <span class="token comment">// use `db6`, `db7` as sources, `db8` as replicas for `orders`, `Product`</span>
  Sources<span class="token punctuation">:</span>  <span class="token punctuation">[</span><span class="token punctuation">]</span>gorm<span class="token punctuation">.</span>Dialector<span class="token punctuation">{</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db6_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db7_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  Replicas<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>gorm<span class="token punctuation">.</span>Dialector<span class="token punctuation">{</span>mysql<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;db8_dsn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;orders&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Product<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;secondary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_9-1-2-transaction"><a href="#_9-1-2-transaction" class="header-anchor">#</a> 9.1.2 Transaction</h4> <p>when using transaction, DBResolver will use the transaction and won’t switch to sources/replicas</p> <h4 id="_9-2-3-automatic-connection-switching"><a href="#_9-2-3-automatic-connection-switching" class="header-anchor">#</a> 9.2.3 Automatic connection switching</h4> <p>DBResolver will automatically switch connection based on the working table/struct</p> <p>For RAW SQL, DBResolver will extract the table name from the SQL to match the resolver, and will use <code>sources</code> unless the SQL begins with <code>SELECT</code> (excepts <code>SELECT... FOR UPDATE</code>), for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// `User` Resolver Examples</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// replicas `db5`</span>
db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>AdvancedUser<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// replicas `db5`</span>
db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;update users set name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span> <span class="token comment">// sources `db1`</span>
db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;select name from users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>name<span class="token punctuation">)</span> <span class="token comment">// replicas `db5`</span>
db<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span> <span class="token comment">// sources `db1`</span>
db<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span> <span class="token comment">// sources `db1`</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;users&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;jinzhu&quot;</span><span class="token punctuation">)</span> <span class="token comment">// sources `db1`</span>

<span class="token comment">// Global Resolver Examples</span>
db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Pet<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// replicas `db3`/`db4`</span>
db<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Pet<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// sources `db2`</span>

<span class="token comment">// Orders Resolver Examples</span>
db<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Order<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// replicas `db8`</span>
db<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">&quot;orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>Report<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// replicas `db8`</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_9-2-4-read-write-splitting"><a href="#_9-2-4-read-write-splitting" class="header-anchor">#</a> 9.2.4 Read/Write Splitting</h4> <p>Read/Write splitting with DBResolver based on the current used  <a href="https://gorm.io/docs/write_plugins.html" target="_blank" rel="noopener noreferrer">GORM callbacks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>For <code>Query</code>, <code>Row</code> callback, will use <code>replicas</code> unless <code>Write</code> mode specified
For <code>Raw</code> callback, statements are considered read-only and will use <code>replicas</code> if the SQL starts with <code>SELECT</code></p> <h4 id="_9-2-5-manual-connection-switching"><a href="#_9-2-5-manual-connection-switching" class="header-anchor">#</a> 9.2.5 Manual connection switching</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// Use Write Mode: read user from sources `db1`</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// Specify Resolver: read user from `secondary`'s replicas: db8</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token string">&quot;secondary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// Specify Resolver and Write Mode: read user from `secondary`'s sources: db6 or db7</span>
db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span><span class="token string">&quot;secondary&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dbresolver<span class="token punctuation">.</span>Write<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_9-2-6-load-balancing"><a href="#_9-2-6-load-balancing" class="header-anchor">#</a> 9.2.6 Load Balancing</h4> <p>GORM supports load balancing sources/relicas based on policy, the policy should be a struct implements following interface:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Policy <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Resolve</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>gorm<span class="token punctuation">.</span>ConnPool<span class="token punctuation">)</span> gorm<span class="token punctuation">.</span>ConnPool
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Currently only the <code>RandomPolicy</code> implemented and it is the default option if no other policy specified.</p> <h4 id="_9-2-7-connection-pool"><a href="#_9-2-7-connection-pool" class="header-anchor">#</a> 9.2.7 Connection Pool</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>
  dbresolver<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span>dbresolver<span class="token punctuation">.</span>Config<span class="token punctuation">{</span> <span class="token comment">/* xxx */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">SetConnMaxIdleTime</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">SetConnMaxLifetime</span><span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span><span class="token punctuation">.</span>
  <span class="token function">SetMaxIdleConns</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
  <span class="token function">SetMaxOpenConns</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_9-2-prometheus"><a href="#_9-2-prometheus" class="header-anchor">#</a> 9.2 Prometheus</h3> <p>GORM provides Prometheus plugin to collect <a href="https://pkg.go.dev/database/sql?tab=doc#DBStats" target="_blank" rel="noopener noreferrer">DBStats<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or user-defined metrics</p> <p>https://github.com/go-gorm/prometheus</p> <h4 id="_9-2-1-usage"><a href="#_9-2-1-usage" class="header-anchor">#</a> 9.2.1 Usage</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;gorm.io/gorm&quot;</span>
  <span class="token string">&quot;gorm.io/driver/sqlite&quot;</span>
  <span class="token string">&quot;gorm.io/plugin/prometheus&quot;</span>
<span class="token punctuation">)</span>

db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>prometheus<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span>prometheus<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  DBName<span class="token punctuation">:</span>          <span class="token string">&quot;db1&quot;</span><span class="token punctuation">,</span> <span class="token comment">// use `DBName` as metrics label</span>
  RefreshInterval<span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span>    <span class="token comment">// Refresh metrics interval (default 15 seconds)</span>
  PushAddr<span class="token punctuation">:</span>        <span class="token string">&quot;prometheus pusher address&quot;</span><span class="token punctuation">,</span> <span class="token comment">// push metrics if `PushAddr` configured</span>
  StartServer<span class="token punctuation">:</span>     <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// start http server to expose metrics</span>
  HTTPServerPort<span class="token punctuation">:</span>  <span class="token number">8080</span><span class="token punctuation">,</span>  <span class="token comment">// configure http server port, default port 8080 (if you have configured multiple instances, only the first `HTTPServerPort` will be used to start server)</span>
  MetricsCollector<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>prometheus<span class="token punctuation">.</span>MetricsCollector <span class="token punctuation">{</span>
    <span class="token operator">&amp;</span>prometheus<span class="token punctuation">.</span>MySQL<span class="token punctuation">{</span>
      VariableNames<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Threads_running&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// user defined metrics</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_9-2-2-user-defined-metrics"><a href="#_9-2-2-user-defined-metrics" class="header-anchor">#</a> 9.2.2 User-Defined Metrics</h4> <p>You can define your metrics and collect them with GORM Prometheus plugin, which needs to implements <code>MetricsCollector</code> interface</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> MetricsCollector <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Metrics</span><span class="token punctuation">(</span><span class="token operator">*</span>Prometheus<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>prometheus<span class="token punctuation">.</span>Collector
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9-2-3-mysql"><a href="#_9-2-3-mysql" class="header-anchor">#</a> 9.2.3 MySQL</h4> <p>GORM provides an example for how to collect MySQL Status as metrics, check it out <a href="https://github.com/go-gorm/prometheus/blob/master/mysql.go" target="_blank" rel="noopener noreferrer">prometheus.MySQL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token operator">&amp;</span>prometheus<span class="token punctuation">.</span>MySQL<span class="token punctuation">{</span>
  Prefix<span class="token punctuation">:</span> <span class="token string">&quot;gorm_status_&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// Metrics name prefix, default is `gorm_status_`</span>
  <span class="token comment">// For example, Threads_running's metric name is `gorm_status_Threads_running`</span>
  Interval<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
  <span class="token comment">// Fetch interval, default use Prometheus's RefreshInterval</span>
  VariableNames<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;Threads_running&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// Select variables from SHOW STATUS, if not set, uses all status variables</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_9-3-hints"><a href="#_9-3-hints" class="header-anchor">#</a> 9.3 Hints</h3> <p>GORM provides optimizer/index/comment hints support</p> <p>https://github.com/go-gorm/hints</p> <h4 id="_9-3-1-optimizer-hints"><a href="#_9-3-1-optimizer-hints" class="header-anchor">#</a> 9.3.1 Optimizer Hints</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;gorm.io/hints&quot;</span>

db<span class="token punctuation">.</span><span class="token function">Clauses</span><span class="token punctuation">(</span>hints<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;hint&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>User<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// SELECT * /*+ hint */ FROM `users`</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_9-3-2-index-hints"><a href="#_9-3-2-index-hints" class="header-anchor">#</a> 9.3.2 Index Hints</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>import &quot;gorm.io/hints&quot;

db.Clauses(hints.UseIndex(&quot;idx_user_name&quot;)).Find(&amp;User{})
// SELECT * FROM `users` USE INDEX (`idx_user_name`)

db.Clauses(hints.ForceIndex(&quot;idx_user_name&quot;, &quot;idx_user_id&quot;).ForJoin()).Find(&amp;User{})
// SELECT * FROM `users` FORCE INDEX FOR JOIN (`idx_user_name`,`idx_user_id`)&quot;

db.Clauses(
  hints.ForceIndex(&quot;idx_user_name&quot;, &quot;idx_user_id&quot;).ForOrderBy(),
  hints.IgnoreIndex(&quot;idx_user_name&quot;).ForGroupBy(),
).Find(&amp;User{})
// SELECT * FROM `users` FORCE INDEX FOR ORDER BY (`idx_user_name`,`idx_user_id`) IGNORE INDEX FOR GROUP BY (`idx_user_name`)&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_9-3-3-comment-hints"><a href="#_9-3-3-comment-hints" class="header-anchor">#</a> 9.3.3 Comment Hints</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>import &quot;gorm.io/hints&quot;

db.Clauses(hints.Comment(&quot;select&quot;, &quot;master&quot;)).Find(&amp;User{})
// SELECT /*master*/ * FROM `users`;

db.Clauses(hints.CommentBefore(&quot;insert&quot;, &quot;node2&quot;)).Create(&amp;user)
// /*node2*/ INSERT INTO `users` ...;

db.Clauses(hints.CommentAfter(&quot;select&quot;, &quot;node2&quot;)).Create(&amp;user)
// /*node2*/ INSERT INTO `users` ...;

db.Clauses(hints.CommentAfter(&quot;where&quot;, &quot;hint&quot;)).Find(&amp;User{}, &quot;id = ?&quot;, 1)
// SELECT * FROM `users` WHERE id = ? /* hint */
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_9-4-database-indexes"><a href="#_9-4-database-indexes" class="header-anchor">#</a> 9.4 Database Indexes</h3> <p>GORM allows create databases index with tag <code>index</code>,<code>uniqueIndex</code>, those indexes will be created when <a href="https://gorm.io/docs/migration.html" target="_blank" rel="noopener noreferrer">AutoMigrate or CreateTable with GORM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_9-4-1-index-tag"><a href="#_9-4-1-index-tag" class="header-anchor">#</a> 9.4.1 Index Tag</h4> <p>GORM accepts lots of index settings, like <code>class</code>, <code>type</code>, <code>where</code>, <code>comment</code>, <code>expression</code>, <code>sort</code>, <code>collate</code>, <code>option</code></p> <p>Check the following example for how to use it</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name  <span class="token builtin">string</span> <span class="token string">`gorm:&quot;index&quot;`</span>
  Name2 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;index:idx_name,unique&quot;`</span>
  Name3 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;index:,sort:desc,collate:utf8,type:btree,length:10,where:name3 != 'jinzhu'&quot;`</span>
  Name4 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;uniqueIndex&quot;`</span>
  Age   <span class="token builtin">int64</span>  <span class="token string">`gorm:&quot;index:,class:FULLTEXT,comment:hello \\, world,where:age &gt; 10&quot;`</span>
  Age2  <span class="token builtin">int64</span>  <span class="token string">`gorm:&quot;index:,expression:ABS(age)&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// MySQL option</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name <span class="token builtin">string</span> <span class="token string">`gorm:&quot;index:,class:FULLTEXT,option:WITH PARSER ngram INVISIBLE&quot;`</span>
<span class="token punctuation">}</span>

<span class="token comment">// PostgreSQL option</span>
<span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name <span class="token builtin">string</span> <span class="token string">`gorm:&quot;index:,option:CONCURRENTLY&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_9-4-2-uniqueindex"><a href="#_9-4-2-uniqueindex" class="header-anchor">#</a> 9.4.2 uniqueIndex</h4> <p>tag <code>uniqueIndex</code> works similar like <code>index</code>, it equals to <code>index:,unique</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name1 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;uniqueIndex&quot;`</span>
  Name2 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;uniqueIndex:idx_name,sort:desc&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_9-4-3-composite-indexes"><a href="#_9-4-3-composite-indexes" class="header-anchor">#</a> 9.4.3 Composite Indexes</h4> <p>Use same index name for two fields will creates composite indexes, for example:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type User struct {
  Name   string `gorm:&quot;index:idx_member&quot;`
  Number string `gorm:&quot;index:idx_member&quot;`
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_9-4-4-fields-priority"><a href="#_9-4-4-fields-priority" class="header-anchor">#</a> 9.4.4 Fields Priority</h4> <p>The column order of a composite index has an impact on its performance so it must be chosen carefully</p> <p>You can specify the order with the <code>priority</code> option, the default priority value is <code>10</code>, if priority value is the same, the order will be based on model struct’s field index</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type User struct {
  Name   string `gorm:&quot;index:idx_member&quot;`
  Number string `gorm:&quot;index:idx_member&quot;`
}
// column order: name, number

type User struct {
  Name   string `gorm:&quot;index:idx_member,priority:2&quot;`
  Number string `gorm:&quot;index:idx_member,priority:1&quot;`
}
// column order: number, name

type User struct {
  Name   string `gorm:&quot;index:idx_member,priority:12&quot;`
  Number string `gorm:&quot;index:idx_member&quot;`
}
// column order: number, name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_9-4-5-multiple-indexes"><a href="#_9-4-5-multiple-indexes" class="header-anchor">#</a> 9.4.5 Multiple indexes</h4> <p>A field accepts multiple <code>index</code>, <code>uniqueIndex</code> tags that will create multiple indexes on a field</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>type UserIndex struct {
  OID          int64  `gorm:&quot;index:idx_id;index:idx_oid,unique&quot;`
  MemberNumber string `gorm:&quot;index:idx_id&quot;`
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-5-constraints"><a href="#_9-5-constraints" class="header-anchor">#</a> 9.5 Constraints</h3> <p>GORM allows create database constraints with tag, constraints will be created when <a href="https://gorm.io/docs/migration.html" target="_blank" rel="noopener noreferrer">AutoMigrate or CreateTable with GORM<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_9-5-1-check-constraint"><a href="#_9-5-1-check-constraint" class="header-anchor">#</a> 9.5.1 CHECK Constraint</h4> <p>Create CHECK constraints with tag <code>check</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> UserIndex <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Name  <span class="token builtin">string</span> <span class="token string">`gorm:&quot;check:name_checker,name &lt;&gt; 'jinzhu'&quot;`</span>
  Name2 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;check:name &lt;&gt; 'jinzhu'&quot;`</span>
  Name3 <span class="token builtin">string</span> <span class="token string">`gorm:&quot;check:,name &lt;&gt; 'jinzhu'&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_9-5-2-index-constraint"><a href="#_9-5-2-index-constraint" class="header-anchor">#</a> 9.5.2 Index Constraint</h4> <p>Checkout <a href="https://gorm.io/docs/indexes.html" target="_blank" rel="noopener noreferrer">Database Indexes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_9-5-3-foreign-key-constraint"><a href="#_9-5-3-foreign-key-constraint" class="header-anchor">#</a> 9.5.3 Foreign Key Constraint</h4> <p>GORM will creates foreign keys constraints for associations, you can disable this feature during initialization:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  DisableForeignKeyConstraintWhenMigrating<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>GORM allows you setup FOREIGN KEY constraints’s <code>OnDelete</code>, <code>OnUpdate</code> option with tag <code>constraint</code>, for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> User <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  CompanyID  <span class="token builtin">int</span>
  Company    Company    <span class="token string">`gorm:&quot;constraint:OnUpdate:CASCADE,OnDelete:SET NULL;&quot;`</span>
  CreditCard CreditCard <span class="token string">`gorm:&quot;constraint:OnUpdate:CASCADE,OnDelete:SET NULL;&quot;`</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> CreditCard <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  gorm<span class="token punctuation">.</span>Model
  Number <span class="token builtin">string</span>
  UserID <span class="token builtin">uint</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Company <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID   <span class="token builtin">int</span>
  Name <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_9-6-composite-primary-key"><a href="#_9-6-composite-primary-key" class="header-anchor">#</a> 9.6 Composite Primary Key</h3> <p>Set multiple fields as primary key creates composite primary key, for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Product <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  ID           <span class="token builtin">string</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
  LanguageCode <span class="token builtin">string</span> <span class="token string">`gorm:&quot;primaryKey&quot;`</span>
  Code         <span class="token builtin">string</span>
  Name         <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Note</strong></p> <p>integer <code>PrioritizedPrimaryField</code> enables <code>AutoIncrement</code> by default, to disable it, you need to turn off <code>autoIncrement</code> for the int fields:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Product <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  CategoryID <span class="token builtin">uint64</span> <span class="token string">`gorm:&quot;primaryKey;autoIncrement:false&quot;`</span>
  TypeID     <span class="token builtin">uint64</span> <span class="token string">`gorm:&quot;primaryKey;autoIncrement:false&quot;`</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-6-security"><a href="#_9-6-security" class="header-anchor">#</a> 9.6 Security</h3> <p>GORM uses the <code>database/sql</code>‘s argument placeholders to construct the SQL statement, which will automatically escape arguments to avoid SQL injection</p> <p><strong>NOTE</strong></p> <p>The SQL from Logger is not fully escaped like the one executed, be careful when copying and executing it in SQL console</p> <h4 id="_9-6-1-query-condition"><a href="#_9-6-1-query-condition" class="header-anchor">#</a> 9.6.1 Query Condition</h4> <p>User’s input should be only used as an argument, for example:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>userInput <span class="token operator">:=</span> <span class="token string">&quot;jinzhu;drop table users;&quot;</span>

<span class="token comment">// safe, will be escaped</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span><span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> userInput<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

<span class="token comment">// SQL injection</span>
db<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;name = %v&quot;</span><span class="token punctuation">,</span> userInput<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_9-6-2-inline-condition"><a href="#_9-6-2-inline-condition" class="header-anchor">#</a> 9.6.2 Inline Condition</h4> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// will be escaped</span>
db<span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> <span class="token string">&quot;name = ?&quot;</span><span class="token punctuation">,</span> userInput<span class="token punctuation">)</span>

<span class="token comment">// SQL injection</span>
db<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;name = %v&quot;</span><span class="token punctuation">,</span> userInput<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_9-6-3-sql-injection-methods"><a href="#_9-6-3-sql-injection-methods" class="header-anchor">#</a> 9.6.3 SQL injection Methods</h4> <p>To support some features, some inputs are not escaped, be careful when using user’s input with those methods</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;name; drop table users;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token string">&quot;name; drop table users;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Pluck</span><span class="token punctuation">(</span><span class="token string">&quot;name; drop table users;&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>names<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;name; drop table users;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Group</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Having</span><span class="token punctuation">(</span><span class="token string">&quot;1 = 1;drop table users;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Raw</span><span class="token punctuation">(</span><span class="token string">&quot;select name from users; drop table users;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Exec</span><span class="token punctuation">(</span><span class="token string">&quot;select name from users; drop table users;&quot;</span><span class="token punctuation">)</span>

db<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">&quot;name; drop table users;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">First</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>user<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>The general rule to avoid SQL injection is don’t trust user-submitted data, you can perform whitelist validation to test user input against an existing set of known, approved, and defined input, and when using user’s input, only use them as an argument.</p> <h3 id="_9-7-gorm-config"><a href="#_9-7-gorm-config" class="header-anchor">#</a> 9.7 Gorm Config</h3> <p>GORM provides Config can be used during initialization</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  SkipDefaultTransaction   <span class="token builtin">bool</span>
  NamingStrategy           schema<span class="token punctuation">.</span>Namer
  Logger                   logger<span class="token punctuation">.</span>Interface
  NowFunc                  <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time
  DryRun                   <span class="token builtin">bool</span>
  PrepareStmt              <span class="token builtin">bool</span>
  DisableNestedTransaction <span class="token builtin">bool</span>
  AllowGlobalUpdate        <span class="token builtin">bool</span>
  DisableAutomaticPing     <span class="token builtin">bool</span>
  DisableForeignKeyConstraintWhenMigrating <span class="token builtin">bool</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_9-7-1-skipdefaulttransaction"><a href="#_9-7-1-skipdefaulttransaction" class="header-anchor">#</a> 9.7.1 SkipDefaultTransaction</h4> <p>GORM perform write (create/update/delete) operations run inside a transaction to ensure data consistency, you can disable it during initialization if it is not required</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  SkipDefaultTransaction<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9-7-2-namingstrategy"><a href="#_9-7-2-namingstrategy" class="header-anchor">#</a> 9.7.2 NamingStrategy</h4> <p>GORM allows users to change the naming conventions by overriding the default <code>NamingStrategy</code> which need to implements interface <code>Namer</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Namer <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">TableName</span><span class="token punctuation">(</span>table <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">SchemaName</span><span class="token punctuation">(</span>table <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">ColumnName</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> column <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">JoinTableName</span><span class="token punctuation">(</span>table <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">RelationshipFKName</span><span class="token punctuation">(</span>Relationship<span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">CheckerName</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> column <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">IndexName</span><span class="token punctuation">(</span>table<span class="token punctuation">,</span> column <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>The default <code>NamingStrategy</code> also provides few options, like:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  NamingStrategy<span class="token punctuation">:</span> schema<span class="token punctuation">.</span>NamingStrategy<span class="token punctuation">{</span>
    TablePrefix<span class="token punctuation">:</span> <span class="token string">&quot;t_&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// table name prefix, table for `User` would be `t_users`</span>
    SingularTable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// use singular table name, table for `User` would be `user` with this option enabled</span>
    NameReplacer<span class="token punctuation">:</span> strings<span class="token punctuation">.</span><span class="token function">NewReplacer</span><span class="token punctuation">(</span><span class="token string">&quot;CID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Cid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// use name replacer to change struct/field name before convert it to db name</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_9-7-3-logger"><a href="#_9-7-3-logger" class="header-anchor">#</a> 9.7.3  Logger</h4> <p>Allow to change GORM’s default logger by overriding this option, refer <a href="https://gorm.io/docs/logger.html" target="_blank" rel="noopener noreferrer">Logger<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more details</p> <h4 id="_9-7-4-nowfunc"><a href="#_9-7-4-nowfunc" class="header-anchor">#</a> 9.7.4  NowFunc</h4> <p>Change the function to be used when creating a new timestamp</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  NowFunc<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">{</span>
    <span class="token keyword">return</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Local</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_9-7-5-dryrun"><a href="#_9-7-5-dryrun" class="header-anchor">#</a> 9.7.5  DryRun</h4> <p>Generate <code>SQL</code> without executing, can be used to prepare or test generated SQL, refer <a href="https://gorm.io/docs/session.html" target="_blank" rel="noopener noreferrer">Session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  DryRun<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9-7-6-preparestmt"><a href="#_9-7-6-preparestmt" class="header-anchor">#</a> 9.7.6  PrepareStmt</h4> <p><code>PreparedStmt</code> creates a prepared statement when executing any SQL and caches them to speed up future calls, refer <a href="https://gorm.io/docs/session.html" target="_blank" rel="noopener noreferrer">Session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  PrepareStmt<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9-7-7-disablenestedtransaction"><a href="#_9-7-7-disablenestedtransaction" class="header-anchor">#</a> 9.7.7  DisableNestedTransaction</h4> <p>When using <code>Transaction</code> method inside a db transaction, GORM will use <code>SavePoint(savedPointName)</code>, <code>RollbackTo(savedPointName)</code> to give you the nested transaction support, you could disable it by using the <code>DisableNestedTransaction</code> option, refer <a href="https://gorm.io/docs/session.html" target="_blank" rel="noopener noreferrer">Session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details</p> <h4 id="_9-7-8-allowglobalupdate"><a href="#_9-7-8-allowglobalupdate" class="header-anchor">#</a> 9.7.8  AllowGlobalUpdate</h4> <p>Enable global update/delete, refer <a href="https://gorm.io/docs/session.html" target="_blank" rel="noopener noreferrer">Session<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details</p> <h4 id="_9-7-9-disableautomaticping"><a href="#_9-7-9-disableautomaticping" class="header-anchor">#</a> 9.7.9  DisableAutomaticPing</h4> <p>GORM automatically ping database after initialized to check database availability, disable it by setting it to <code>true</code></p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  DisableAutomaticPing<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9-7-10-disableforeignkeyconstraintwhenmigrating"><a href="#_9-7-10-disableforeignkeyconstraintwhenmigrating" class="header-anchor">#</a> 9.7.10  DisableForeignKeyConstraintWhenMigrating</h4> <p>GORM creates database foreign key constraints automatically when <code>AutoMigrate</code> or <code>CreateTable</code>, disable this by setting it to <code>true</code>, refer <a href="https://gorm.io/docs/migration.html" target="_blank" rel="noopener noreferrer">Migration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>sqlite<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;gorm.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gorm<span class="token punctuation">.</span>Config<span class="token punctuation">{</span>
  DisableForeignKeyConstraintWhenMigrating<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_9-8-write-plugins"><a href="#_9-8-write-plugins" class="header-anchor">#</a> 9.8 Write Plugins</h3> <h4 id="_9-8-1-callbacks"><a href="#_9-8-1-callbacks" class="header-anchor">#</a> 9.8.1 Callbacks</h4> <p>GORM itself is powered by <code>Callbacks</code>, it has callbacks for <code>Create</code>, <code>Query</code>, <code>Update</code>, <code>Delete</code>, <code>Row</code>, <code>Raw</code>, you could fully customize GORM with them as you want</p> <p>Callbacks are registered into the global <code>*gorm.DB</code>, not the session-level, if you require <code>*gorm.DB</code> with different callbacks, you need to initialize another <code>*gorm.DB</code></p> <h4 id="_9-8-2-register-callback"><a href="#_9-8-2-register-callback" class="header-anchor">#</a> 9.8.2  Register Callback</h4> <p>Register a callback into callbacks</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">cropImage</span><span class="token punctuation">(</span>db <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token comment">// crop image fields and upload them to CDN, dummy code</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> field <span class="token operator">:=</span> <span class="token keyword">range</span> db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Fields <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>ReflectValue<span class="token punctuation">.</span><span class="token function">Kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> reflect<span class="token punctuation">.</span>Slice<span class="token punctuation">,</span> reflect<span class="token punctuation">.</span>Array<span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>ReflectValue<span class="token punctuation">.</span><span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
          <span class="token comment">// Get value from field</span>
          <span class="token keyword">if</span> fieldValue<span class="token punctuation">,</span> isZero <span class="token operator">:=</span> field<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>ReflectValue<span class="token punctuation">.</span><span class="token function">Index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>isZero <span class="token punctuation">{</span>
            <span class="token keyword">if</span> crop<span class="token punctuation">,</span> ok <span class="token operator">:=</span> fieldValue<span class="token punctuation">.</span><span class="token punctuation">(</span>CropInterface<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
              crop<span class="token punctuation">.</span><span class="token function">Crop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token keyword">case</span> reflect<span class="token punctuation">.</span>Struct<span class="token punctuation">:</span>
        <span class="token comment">// Get value from field</span>
        <span class="token keyword">if</span> fieldValue<span class="token punctuation">,</span> isZero <span class="token operator">:=</span> field<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>ReflectValue<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>isZero <span class="token punctuation">{</span>
          <span class="token keyword">if</span> crop<span class="token punctuation">,</span> ok <span class="token operator">:=</span> fieldValue<span class="token punctuation">.</span><span class="token punctuation">(</span>CropInterface<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">{</span>
            crop<span class="token punctuation">.</span><span class="token function">Crop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Set value to field</span>
        err <span class="token operator">:=</span> field<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>ReflectValue<span class="token punctuation">,</span> <span class="token string">&quot;newValue&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// All fields for current model</span>
    db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Fields

    <span class="token comment">// All primary key fields for current model</span>
    db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>PrimaryFields

    <span class="token comment">// Prioritized primary key field: field with DB name `id` or the first defined primary key</span>
    db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>PrioritizedPrimaryField

    <span class="token comment">// All relationships for current model</span>
    db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Relationships

    <span class="token comment">// Find field with field name or db name</span>
    field <span class="token operator">:=</span> db<span class="token punctuation">.</span>Statement<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span><span class="token function">LookUpField</span><span class="token punctuation">(</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// processing</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;crop_image&quot;</span><span class="token punctuation">,</span> cropImage<span class="token punctuation">)</span>
<span class="token comment">// register a callback for Create process</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h4 id="_9-8-1-delete-callback"><a href="#_9-8-1-delete-callback" class="header-anchor">#</a> 9.8.1  Delete Callback</h4> <p>Delete a callback from callbacks</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:create&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// delete callback `gorm:create` from Create callbacks</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_9-8-3-replace-callback"><a href="#_9-8-3-replace-callback" class="header-anchor">#</a> 9.8.3  Replace Callback</h4> <p>Replace a callback having the same name with the new one</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:create&quot;</span><span class="token punctuation">,</span> newCreateFunction<span class="token punctuation">)</span>
<span class="token comment">// replace callback `gorm:create` with new function `newCreateFunction` for Create process</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_9-8-4-register-callback-with-orders"><a href="#_9-8-4-register-callback-with-orders" class="header-anchor">#</a> 9.8.4  Register Callback with orders</h4> <p>Register callbacks with orders</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// before gorm:create</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;update_created_at&quot;</span><span class="token punctuation">,</span> updateCreated<span class="token punctuation">)</span>

<span class="token comment">// after gorm:create</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;update_created_at&quot;</span><span class="token punctuation">,</span> updateCreated<span class="token punctuation">)</span>

<span class="token comment">// after gorm:query</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:query&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;my_plugin:after_query&quot;</span><span class="token punctuation">,</span> afterQuery<span class="token punctuation">)</span>

<span class="token comment">// after gorm:delete</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:delete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;my_plugin:after_delete&quot;</span><span class="token punctuation">,</span> afterDelete<span class="token punctuation">)</span>

<span class="token comment">// before gorm:update</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:update&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;my_plugin:before_update&quot;</span><span class="token punctuation">,</span> beforeUpdate<span class="token punctuation">)</span>

<span class="token comment">// before gorm:create and after gorm:before_create</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token string">&quot;gorm:before_create&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;my_plugin:before_create&quot;</span><span class="token punctuation">,</span> beforeCreate<span class="token punctuation">)</span>

<span class="token comment">// before any other callbacks</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;update_created_at&quot;</span><span class="token punctuation">,</span> updateCreated<span class="token punctuation">)</span>

<span class="token comment">// after any other callbacks</span>
db<span class="token punctuation">.</span><span class="token function">Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span><span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">&quot;update_created_at&quot;</span><span class="token punctuation">,</span> updateCreated<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_9-8-5-defined-callbacks"><a href="#_9-8-5-defined-callbacks" class="header-anchor">#</a> 9.8.5  Defined Callbacks</h4> <p>GORM has defined <a href="https://github.com/go-gorm/gorm/blob/master/callbacks/callbacks.go" target="_blank" rel="noopener noreferrer">some callbacks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to power current GORM features, check them out before starting your plugins</p> <h4 id="_9-8-6-plugin"><a href="#_9-8-6-plugin" class="header-anchor">#</a> 9.8.6  Plugin</h4> <p>GORM provides a <code>Use</code> method to register plugins, the plugin needs to implement the <code>Plugin</code> interface</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Plugin <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>The <code>Initialize</code> method will be invoked when registering the plugin into GORM first time, and GORM will save the registered plugins, access them like:</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span>Config<span class="token punctuation">.</span>Plugins<span class="token punctuation">[</span>pluginName<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Checkout <a href="https://gorm.io/docs/prometheus.html" target="_blank" rel="noopener noreferrer">Prometheus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as example</p> <h3 id="_9-9-write-driver"><a href="#_9-9-write-driver" class="header-anchor">#</a> 9.9 Write Driver</h3> <h4 id="_9-9-1-write-new-driver"><a href="#_9-9-1-write-new-driver" class="header-anchor">#</a> 9.9.1 Write new driver</h4> <p>GORM provides official support for <code>sqlite</code>, <code>mysql</code>, <code>postgres</code>, <code>sqlserver</code>.</p> <p>Some databases may be compatible with the <code>mysql</code> or <code>postgres</code> dialect, in which case you could just use the dialect for those databases.</p> <p>For others, you can create a new driver, it needs to implement <a href="https://pkg.go.dev/gorm.io/gorm?tab=doc#Dialector" target="_blank" rel="noopener noreferrer">the dialect interface<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> Dialector <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token operator">*</span>DB<span class="token punctuation">)</span> <span class="token builtin">error</span>
  <span class="token function">Migrator</span><span class="token punctuation">(</span>db <span class="token operator">*</span>DB<span class="token punctuation">)</span> Migrator
  <span class="token function">DataTypeOf</span><span class="token punctuation">(</span><span class="token operator">*</span>schema<span class="token punctuation">.</span>Field<span class="token punctuation">)</span> <span class="token builtin">string</span>
  <span class="token function">DefaultValueOf</span><span class="token punctuation">(</span><span class="token operator">*</span>schema<span class="token punctuation">.</span>Field<span class="token punctuation">)</span> clause<span class="token punctuation">.</span>Expression
  <span class="token function">BindVarTo</span><span class="token punctuation">(</span>writer clause<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> stmt <span class="token operator">*</span>Statement<span class="token punctuation">,</span> v <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">QuoteTo</span><span class="token punctuation">(</span>clause<span class="token punctuation">.</span>Writer<span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">)</span>
  <span class="token function">Explain</span><span class="token punctuation">(</span>sql <span class="token builtin">string</span><span class="token punctuation">,</span> vars <span class="token operator">...</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Checkout the <a href="https://github.com/go-gorm/mysql" target="_blank" rel="noopener noreferrer">MySQL Driver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> as example</p> <h2 id="reference"><a href="#reference" class="header-anchor">#</a> Reference</h2> <ol><li><a href="%5Bhttps://gorm.io%5D(https://gorm.io/)">gorm</a></li> <li><a href="https://github.com/go-gorm/gorm/issues/4218" target="_blank" rel="noopener noreferrer">What is the difference between <code>Find</code> and <code>Scan</code>， Can I replace <code>Scan</code> with <code>Find</code> ？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> grom issue</li> <li><a href="https://stackoverflow.com/questions/45953553/what-is-the-syntax-for-select-in-statement-for-sqlite" target="_blank" rel="noopener noreferrer">What is the syntax for SELECT IN statement for SQLITE?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> stackoverflow</li> <li><a href="https://www.sqlitetutorial.net/sqlite-full-outer-join/" target="_blank" rel="noopener noreferrer">SQLite FULL OUTER JOIN Emulation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> sqlitetutorial</li></ol></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2021/12/20 22:52:58</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/zh/golang/gorm/01.4.html" class="prev">
            Tutorials
          </a></span> <span class="next"><a href="/zh/golang/gorm/gorm.html">
            Total
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-898d6c54><li class="level-2" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-advanced-topics" class="sidebar-link reco-side-_9-advanced-topics" data-v-898d6c54>9. Advanced Topics</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-1-dbresolver" class="sidebar-link reco-side-_9-1-dbresolver" data-v-898d6c54>9.1 DBResolver</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-2-prometheus" class="sidebar-link reco-side-_9-2-prometheus" data-v-898d6c54>9.2 Prometheus</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-3-hints" class="sidebar-link reco-side-_9-3-hints" data-v-898d6c54>9.3 Hints</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-4-database-indexes" class="sidebar-link reco-side-_9-4-database-indexes" data-v-898d6c54>9.4 Database Indexes</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-5-constraints" class="sidebar-link reco-side-_9-5-constraints" data-v-898d6c54>9.5 Constraints</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-6-composite-primary-key" class="sidebar-link reco-side-_9-6-composite-primary-key" data-v-898d6c54>9.6 Composite Primary Key</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-6-security" class="sidebar-link reco-side-_9-6-security" data-v-898d6c54>9.6 Security</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-7-gorm-config" class="sidebar-link reco-side-_9-7-gorm-config" data-v-898d6c54>9.7 Gorm Config</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-8-write-plugins" class="sidebar-link reco-side-_9-8-write-plugins" data-v-898d6c54>9.8 Write Plugins</a></li><li class="level-3" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#_9-9-write-driver" class="sidebar-link reco-side-_9-9-write-driver" data-v-898d6c54>9.9 Write Driver</a></li><li class="level-2" data-v-898d6c54><a href="/zh/golang/gorm/01.5.html#reference" class="sidebar-link reco-side-reference" data-v-898d6c54>Reference</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div id="goTop" class="hide-cat" data-v-bf92849a></div><canvas id="vuepress-canvas-ribbon"></canvas></div></div>
    <script src="/assets/js/app.c591e8d8.js" defer></script><script src="/assets/js/5.94f54d66.js" defer></script><script src="/assets/js/1.7ee7f9d3.js" defer></script><script src="/assets/js/52.e414baaa.js" defer></script>
  </body>
</html>
