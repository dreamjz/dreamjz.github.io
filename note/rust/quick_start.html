<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta name="google-site-verification" content="lHBWOiWCnBWvc1h4REqjllalv9ZpQbXbHDdM8chFuuw"><script src="/js/live2d.js"></script><title>Quick Start | 今朝のブログ</title><meta name="description" content="今朝のブログ">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-4844dc7c.css" as="style"><link rel="stylesheet" href="/assets/style-4844dc7c.css">
    <link rel="modulepreload" href="/assets/app-0294952b.js"><link rel="modulepreload" href="/assets/framework-dee406ed.js"><link rel="modulepreload" href="/assets/quick_start.html-9a68b11f.js"><link rel="modulepreload" href="/assets/quick_start.html-ca0b026f.js"><link rel="prefetch" href="/assets/index.html-547f6f2a.js" as="script"><link rel="prefetch" href="/assets/about-me.html-5bf4ef9d.js" as="script"><link rel="prefetch" href="/assets/index.html-4a47ff73.js" as="script"><link rel="prefetch" href="/assets/index.html-91333fd0.js" as="script"><link rel="prefetch" href="/assets/ebiten_breakout.html-75c5f961.js" as="script"><link rel="prefetch" href="/assets/index.html-30770b2e.js" as="script"><link rel="prefetch" href="/assets/index.html-200077e0.js" as="script"><link rel="prefetch" href="/assets/index.html-95fbb3ff.js" as="script"><link rel="prefetch" href="/assets/index.html-8d47d1ad.js" as="script"><link rel="prefetch" href="/assets/des.html-7df58b24.js" as="script"><link rel="prefetch" href="/assets/index.html-77bf7d35.js" as="script"><link rel="prefetch" href="/assets/index.html-48858767.js" as="script"><link rel="prefetch" href="/assets/index.html-3615eb8e.js" as="script"><link rel="prefetch" href="/assets/index.html-a02ba6b6.js" as="script"><link rel="prefetch" href="/assets/index.html-a72d5a5b.js" as="script"><link rel="prefetch" href="/assets/1.twoSum.html-cc83f288.js" as="script"><link rel="prefetch" href="/assets/102.binary_tree_level_order_traversal.html-b9e58501.js" as="script"><link rel="prefetch" href="/assets/103.binary_tree_zigzag_level_order_traversal.html-6b027b76.js" as="script"><link rel="prefetch" href="/assets/121.122.123.188.309.714.stock_series.html-c53c9918.js" as="script"><link rel="prefetch" href="/assets/141.142.linked_list_cycle.html-a5d609d8.js" as="script"><link rel="prefetch" href="/assets/146.LRU_cache.html-6cc73a1a.js" as="script"><link rel="prefetch" href="/assets/15.three_sum.html-726c64af.js" as="script"><link rel="prefetch" href="/assets/20.valid_parentheses.html-a54f2f4a.js" as="script"><link rel="prefetch" href="/assets/200.number_of_islands.html-4ac96aee.js" as="script"><link rel="prefetch" href="/assets/206.reverse_linked_list.html-776d16ff.js" as="script"><link rel="prefetch" href="/assets/21.merge_two_sorted_lists.html-401957a3.js" as="script"><link rel="prefetch" href="/assets/215.kth_ele_in_arr.html-69f05bed.js" as="script"><link rel="prefetch" href="/assets/25.reverse_nodes_in_k_group.html-2c9bda34.js" as="script"><link rel="prefetch" href="/assets/3.longest_substring_without_repeating_characters.html-38d9514c.js" as="script"><link rel="prefetch" href="/assets/33.search_in_rotated_sorted_array.html-ba2f3f9c.js" as="script"><link rel="prefetch" href="/assets/46.permutations.html-ebe1bb77.js" as="script"><link rel="prefetch" href="/assets/5.longest_palindromic_substring.html-7f2bbeaa.js" as="script"><link rel="prefetch" href="/assets/53.maximum_subarray.html-70b61a88.js" as="script"><link rel="prefetch" href="/assets/88.merge_sorted_array.html-29be6639.js" as="script"><link rel="prefetch" href="/assets/index.html-afd6136a.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-e78e20be.js" as="script"><link rel="prefetch" href="/assets/endless.html-906536a2.js" as="script"><link rel="prefetch" href="/assets/gin.html-08080041.js" as="script"><link rel="prefetch" href="/assets/go-jwt.html-b1177594.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-b08c8610.js" as="script"><link rel="prefetch" href="/assets/nginx.html-0dfcbe8c.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-2f78d6b9.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-54486baf.js" as="script"><link rel="prefetch" href="/assets/index.html-0ae657e7.js" as="script"><link rel="prefetch" href="/assets/index.html-0beb0e8b.js" as="script"><link rel="prefetch" href="/assets/index.html-c15a496c.js" as="script"><link rel="prefetch" href="/assets/index.html-6f8c582d.js" as="script"><link rel="prefetch" href="/assets/bytes_to_string_quickly.html-f5708576.js" as="script"><link rel="prefetch" href="/assets/natural_sort.html-37c45d0b.js" as="script"><link rel="prefetch" href="/assets/set_default_cmd_charset.html-536c84fc.js" as="script"><link rel="prefetch" href="/assets/clash-linux.html-dd58d911.js" as="script"><link rel="prefetch" href="/assets/pi-docker-blog.html-3ffe5a90.js" as="script"><link rel="prefetch" href="/assets/pi-go.html-4da9d59c.js" as="script"><link rel="prefetch" href="/assets/pi-nginx.html-add6155b.js" as="script"><link rel="prefetch" href="/assets/ghaction.html-dbc9f525.js" as="script"><link rel="prefetch" href="/assets/live2d_widget.html-b2e57ace.js" as="script"><link rel="prefetch" href="/assets/migrate_to_v2.html-ba454ea8.js" as="script"><link rel="prefetch" href="/assets/moe-counter.html-934c159c.js" as="script"><link rel="prefetch" href="/assets/ssl.html-90697b49.js" as="script"><link rel="prefetch" href="/assets/gpg_key.html-d4ca82db.js" as="script"><link rel="prefetch" href="/assets/arch_installation.html-0965fa14.js" as="script"><link rel="prefetch" href="/assets/01.1.html-79101a1a.js" as="script"><link rel="prefetch" href="/assets/01.2.html-1f6bfb72.js" as="script"><link rel="prefetch" href="/assets/01.3.html-2d6901b8.js" as="script"><link rel="prefetch" href="/assets/Preface.html-96b94b9d.js" as="script"><link rel="prefetch" href="/assets/preface.html-f4074a0e.js" as="script"><link rel="prefetch" href="/assets/docker-nginx.html-adf724c7.js" as="script"><link rel="prefetch" href="/assets/get-started.html-0b41fc08.js" as="script"><link rel="prefetch" href="/assets/GMPModel.html-a2b62698.js" as="script"><link rel="prefetch" href="/assets/cast.html-1f4dcf57.js" as="script"><link rel="prefetch" href="/assets/cobra.html-05a800b1.js" as="script"><link rel="prefetch" href="/assets/email.html-9915e50a.js" as="script"><link rel="prefetch" href="/assets/flag.html-59b6a4cc.js" as="script"><link rel="prefetch" href="/assets/fsnotify.html-08b38c3a.js" as="script"><link rel="prefetch" href="/assets/go-flags.html-74d2f119.js" as="script"><link rel="prefetch" href="/assets/go-homedir.html-d485c1f2.js" as="script"><link rel="prefetch" href="/assets/go-ini.html-60e12991.js" as="script"><link rel="prefetch" href="/assets/godotenv.html-113183fa.js" as="script"><link rel="prefetch" href="/assets/log.html-8ec77906.js" as="script"><link rel="prefetch" href="/assets/logrus.html-c6ed8074.js" as="script"><link rel="prefetch" href="/assets/preface.html-07714dd5.js" as="script"><link rel="prefetch" href="/assets/uniplace-carbon.html-fcff9d46.js" as="script"><link rel="prefetch" href="/assets/viper.html-b1b00afa.js" as="script"><link rel="prefetch" href="/assets/01.1.html-f22ec99d.js" as="script"><link rel="prefetch" href="/assets/01.2.html-5bd86bd5.js" as="script"><link rel="prefetch" href="/assets/01.3.html-07f3dc7c.js" as="script"><link rel="prefetch" href="/assets/01.4.html-5cf1b232.js" as="script"><link rel="prefetch" href="/assets/01.5.html-46d4cf72.js" as="script"><link rel="prefetch" href="/assets/gorm.html-d0e4ebb0.js" as="script"><link rel="prefetch" href="/assets/01.1.html-6fb08b75.js" as="script"><link rel="prefetch" href="/assets/0.basics.html-a4d9b1b9.js" as="script"><link rel="prefetch" href="/assets/1.questions-syntax.html-6a73fc82.js" as="script"><link rel="prefetch" href="/assets/2.questions-underlying.html-6fb74ade.js" as="script"><link rel="prefetch" href="/assets/3.questions-concurrency.html-787c22e8.js" as="script"><link rel="prefetch" href="/assets/1.basics.html-a54a6bf1.js" as="script"><link rel="prefetch" href="/assets/2.index.html-3d3de0d9.js" as="script"><link rel="prefetch" href="/assets/3.transaction.html-165d0ef3.js" as="script"><link rel="prefetch" href="/assets/4.lock.html-73c7d1d5.js" as="script"><link rel="prefetch" href="/assets/5.log.html-d32a17ad.js" as="script"><link rel="prefetch" href="/assets/6.mem.html-a7fa4fbf.js" as="script"><link rel="prefetch" href="/assets/qa_1.html-79fe0792.js" as="script"><link rel="prefetch" href="/assets/1.basics.html-c4a569e0.js" as="script"><link rel="prefetch" href="/assets/2.http.html-171b240c.js" as="script"><link rel="prefetch" href="/assets/3.tcp.html-27a26699.js" as="script"><link rel="prefetch" href="/assets/4.ip.html-f9907c25.js" as="script"><link rel="prefetch" href="/assets/01.qas.html-6a607b16.js" as="script"><link rel="prefetch" href="/assets/02.ds.html-0c35fc67.js" as="script"><link rel="prefetch" href="/assets/03.data_storage.html-cea1973c.js" as="script"><link rel="prefetch" href="/assets/04.mem.html-8a72d87c.js" as="script"><link rel="prefetch" href="/assets/05.cluster.html-273e9fa9.js" as="script"><link rel="prefetch" href="/assets/06.cache.html-91156530.js" as="script"><link rel="prefetch" href="/assets/00_preface.html-0baf039e.js" as="script"><link rel="prefetch" href="/assets/spf13-vim-plugin.html-7bb88624.js" as="script"><link rel="prefetch" href="/assets/atls.html-a34945fb.js" as="script"><link rel="prefetch" href="/assets/basic_tutorial.html-d24a9509.js" as="script"><link rel="prefetch" href="/assets/generated_code.html-a17dde71.js" as="script"><link rel="prefetch" href="/assets/introduction.html-5b4d6e36.js" as="script"><link rel="prefetch" href="/assets/preface.html-db1e1a96.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-5d08f334.js" as="script"><link rel="prefetch" href="/assets/basics-go.html-55aa7b04.js" as="script"><link rel="prefetch" href="/assets/language-guide-proto3.html-6ac2e327.js" as="script"><link rel="prefetch" href="/assets/preface.html-efef9358.js" as="script"><link rel="prefetch" href="/assets/00_preface.html-a7650d0a.js" as="script"><link rel="prefetch" href="/assets/vue-cli.html-74187533.js" as="script"><link rel="prefetch" href="/assets/vue-router.html-1fc1c7dd.js" as="script"><link rel="prefetch" href="/assets/vuex.html-546b6c16.js" as="script"><link rel="prefetch" href="/assets/01.dp_sc_optimization_summary.html-f32813c0.js" as="script"><link rel="prefetch" href="/assets/02.general_solution_of_stock_series_problem.html-1dd86ea1.js" as="script"><link rel="prefetch" href="/assets/01.QuickSort.html-f4630b8f.js" as="script"><link rel="prefetch" href="/assets/02.MergeSort.html-2f241c3a.js" as="script"><link rel="prefetch" href="/assets/03.HeapSort.html-42cde61b.js" as="script"><link rel="prefetch" href="/assets/0.00.html-7a08e8a4.js" as="script"><link rel="prefetch" href="/assets/01.1.html-ff9cb3e8.js" as="script"><link rel="prefetch" href="/assets/01.2.html-586cedec.js" as="script"><link rel="prefetch" href="/assets/01.3.html-ebb61bd8.js" as="script"><link rel="prefetch" href="/assets/1.impl_of_heap.html-3ea34bbb.js" as="script"><link rel="prefetch" href="/assets/2.map_underlying.html-0599e0d7.js" as="script"><link rel="prefetch" href="/assets/3.channel_underlying.html-1683fdfd.js" as="script"><link rel="prefetch" href="/assets/4.synchronization_primitives.html-2ceaea80.js" as="script"><link rel="prefetch" href="/assets/5.defer.html-63052ab9.js" as="script"><link rel="prefetch" href="/assets/6.panic.html-0839fa39.js" as="script"><link rel="prefetch" href="/assets/slice_equal.html-b95fd598.js" as="script"><link rel="prefetch" href="/assets/01.1.why_is_this_slicegrow_formula.html-1ce66230.js" as="script"><link rel="prefetch" href="/assets/01.2.why_hmap_overflowthreshold_loadfactory.html-ad257dff.js" as="script"><link rel="prefetch" href="/assets/3.why_cannot_value_using_pointerinterfacemethods.html-9c22939b.js" as="script"><link rel="prefetch" href="/assets/4.why_iterate_map_randomly.html-329cffe9.js" as="script"><link rel="prefetch" href="/assets/04.1.html-3a76d127.js" as="script"><link rel="prefetch" href="/assets/04.2.html-8ca8113d.js" as="script"><link rel="prefetch" href="/assets/04.3.html-8033365f.js" as="script"><link rel="prefetch" href="/assets/04.4.html-8fd45941.js" as="script"><link rel="prefetch" href="/assets/Preface.html-ef31daa7.js" as="script"><link rel="prefetch" href="/assets/14-q-syntax.html-6150e473.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-462ffb0e.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-d5ac75d8.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-419c0aea.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-ec04e208.js" as="script"><link rel="prefetch" href="/assets/01.overview.html-d297538e.js" as="script"><link rel="prefetch" href="/assets/03.sync.html-ee1e30df.js" as="script"><link rel="prefetch" href="/assets/04.pattern.html-fa53c137.js" as="script"><link rel="prefetch" href="/assets/05.massive_concurrency.html-340938b4.js" as="script"><link rel="prefetch" href="/assets/01.1.html-19a46eda.js" as="script"><link rel="prefetch" href="/assets/01.2.html-62517c4c.js" as="script"><link rel="prefetch" href="/assets/01.3.html-3699df55.js" as="script"><link rel="prefetch" href="/assets/01.html-31bfd44c.js" as="script"><link rel="prefetch" href="/assets/preface.html-ba91be7c.js" as="script"><link rel="prefetch" href="/assets/Gee.html-6f1fdb0b.js" as="script"><link rel="prefetch" href="/assets/GeeCache.html-d27d8e1b.js" as="script"><link rel="prefetch" href="/assets/GeeORM.html-133552bd.js" as="script"><link rel="prefetch" href="/assets/GeeRPC.html-7a46c46b.js" as="script"><link rel="prefetch" href="/assets/04.1.html-2ee9d6a5.js" as="script"><link rel="prefetch" href="/assets/04.2.html-4e7e9cab.js" as="script"><link rel="prefetch" href="/assets/04.3.html-4b238004.js" as="script"><link rel="prefetch" href="/assets/04.4.html-964b87e3.js" as="script"><link rel="prefetch" href="/assets/04.5.html-1eaa4d07.js" as="script"><link rel="prefetch" href="/assets/04.6.html-b16215d2.js" as="script"><link rel="prefetch" href="/assets/04.7.html-2520217f.js" as="script"><link rel="prefetch" href="/assets/04.8.html-955c85eb.js" as="script"><link rel="prefetch" href="/assets/04.9.html-74886b28.js" as="script"><link rel="prefetch" href="/assets/05.0.html-0d98121a.js" as="script"><link rel="prefetch" href="/assets/05.1.html-b7156ca7.js" as="script"><link rel="prefetch" href="/assets/05.2.html-536bf0d4.js" as="script"><link rel="prefetch" href="/assets/05.3.html-409147ac.js" as="script"><link rel="prefetch" href="/assets/05.4.html-20e4b73a.js" as="script"><link rel="prefetch" href="/assets/05.5.html-2924e9e0.js" as="script"><link rel="prefetch" href="/assets/05.6.html-8ba3246f.js" as="script"><link rel="prefetch" href="/assets/06.1.html-3bded71b.js" as="script"><link rel="prefetch" href="/assets/06.10.html-bd44f1db.js" as="script"><link rel="prefetch" href="/assets/06.12.html-b781c2b6.js" as="script"><link rel="prefetch" href="/assets/06.2.html-a1575b72.js" as="script"><link rel="prefetch" href="/assets/06.3.html-e253a0d5.js" as="script"><link rel="prefetch" href="/assets/06.4.html-881ef3ba.js" as="script"><link rel="prefetch" href="/assets/06.5.html-86ef4f94.js" as="script"><link rel="prefetch" href="/assets/06.6.html-ad19d1b4.js" as="script"><link rel="prefetch" href="/assets/06.7.html-050b62f9.js" as="script"><link rel="prefetch" href="/assets/06.8.html-fd69f6e8.js" as="script"><link rel="prefetch" href="/assets/06.9.html-b5f9e578.js" as="script"><link rel="prefetch" href="/assets/6.11.html-53b993ce.js" as="script"><link rel="prefetch" href="/assets/07.1.html-77e40c0f.js" as="script"><link rel="prefetch" href="/assets/07.2.html-907cb0ee.js" as="script"><link rel="prefetch" href="/assets/07.3.html-deb3aabc.js" as="script"><link rel="prefetch" href="/assets/07.4.html-988b06c3.js" as="script"><link rel="prefetch" href="/assets/07.5.html-d5ff273e.js" as="script"><link rel="prefetch" href="/assets/07.6.html-b3c5bbee.js" as="script"><link rel="prefetch" href="/assets/08.0.html-46cfec29.js" as="script"><link rel="prefetch" href="/assets/08.1.html-3ddd88a9.js" as="script"><link rel="prefetch" href="/assets/08.2.html-a2cbc986.js" as="script"><link rel="prefetch" href="/assets/08.3.html-7ec943a3.js" as="script"><link rel="prefetch" href="/assets/08.4.html-cf41cbb2.js" as="script"><link rel="prefetch" href="/assets/08.5.html-52fc78ea.js" as="script"><link rel="prefetch" href="/assets/08.6.html-846e1f8a.js" as="script"><link rel="prefetch" href="/assets/09.0.html-7a51225e.js" as="script"><link rel="prefetch" href="/assets/09.1.html-d395a13e.js" as="script"><link rel="prefetch" href="/assets/10.0.html-22f1ad79.js" as="script"><link rel="prefetch" href="/assets/10.1.html-24af4b79.js" as="script"><link rel="prefetch" href="/assets/10.2.html-2d3f07c0.js" as="script"><link rel="prefetch" href="/assets/10.3.html-5fb9ea5a.js" as="script"><link rel="prefetch" href="/assets/10.4.html-bbc73232.js" as="script"><link rel="prefetch" href="/assets/10.5.html-9d178bd3.js" as="script"><link rel="prefetch" href="/assets/10.6.html-c6f5abb1.js" as="script"><link rel="prefetch" href="/assets/11.0.html-cb40a887.js" as="script"><link rel="prefetch" href="/assets/11.1.html-f8d0c120.js" as="script"><link rel="prefetch" href="/assets/11.2.html-f5bb35eb.js" as="script"><link rel="prefetch" href="/assets/11.3.html-d99cd958.js" as="script"><link rel="prefetch" href="/assets/11.4.html-aa845578.js" as="script"><link rel="prefetch" href="/assets/11.5.html-6ff88157.js" as="script"><link rel="prefetch" href="/assets/11.6.html-e13b7456.js" as="script"><link rel="prefetch" href="/assets/11.9.html-871418dc.js" as="script"><link rel="prefetch" href="/assets/13.1.html-519b3b31.js" as="script"><link rel="prefetch" href="/assets/13.2.html-c0649ec2.js" as="script"><link rel="prefetch" href="/assets/13.3.html-a0423ccb.js" as="script"><link rel="prefetch" href="/assets/13.4.html-19d9e14a.js" as="script"><link rel="prefetch" href="/assets/13.5.html-741841bb.js" as="script"><link rel="prefetch" href="/assets/13.6.html-26efb498.js" as="script"><link rel="prefetch" href="/assets/13.7.html-51cc102f.js" as="script"><link rel="prefetch" href="/assets/14.1.html-2f35d850.js" as="script"><link rel="prefetch" href="/assets/14.12.html-21924d59.js" as="script"><link rel="prefetch" href="/assets/14.13.html-cdfe2cf0.js" as="script"><link rel="prefetch" href="/assets/14.14.html-079d2ed3.js" as="script"><link rel="prefetch" href="/assets/14.16.html-36599d66.js" as="script"><link rel="prefetch" href="/assets/14.17.html-74a37ec1.js" as="script"><link rel="prefetch" href="/assets/14.2.html-6608c8bf.js" as="script"><link rel="prefetch" href="/assets/14.3.html-ffadea4b.js" as="script"><link rel="prefetch" href="/assets/14.4.html-9fe4e31e.js" as="script"><link rel="prefetch" href="/assets/14.5.html-33d13f75.js" as="script"><link rel="prefetch" href="/assets/14.6.html-af152852.js" as="script"><link rel="prefetch" href="/assets/14.7.html-7037a708.js" as="script"><link rel="prefetch" href="/assets/14.8.html-1e0d241c.js" as="script"><link rel="prefetch" href="/assets/14.9.html-39a277aa.js" as="script"><link rel="prefetch" href="/assets/00.start.html-7f623ac4.js" as="script"><link rel="prefetch" href="/assets/01.1.create_app.html-440f6ae9.js" as="script"><link rel="prefetch" href="/assets/01.10.lifecycle_hooks.html-1131a7fd.js" as="script"><link rel="prefetch" href="/assets/01.11.watchers.html-ce42d79f.js" as="script"><link rel="prefetch" href="/assets/01.12.template_refs.html-2bfac9d8.js" as="script"><link rel="prefetch" href="/assets/01.13.component_basics.html-b20c5c2f.js" as="script"><link rel="prefetch" href="/assets/01.2.template_syntax.html-0d2c8754.js" as="script"><link rel="prefetch" href="/assets/01.3.reactivity_fundamental.html-ac99ea9c.js" as="script"><link rel="prefetch" href="/assets/01.4.computed_props.html-1f6b7fd0.js" as="script"><link rel="prefetch" href="/assets/01.5.class_style_binding.html-494aab84.js" as="script"><link rel="prefetch" href="/assets/01.6.conditional_rendering.html-ee5f33d3.js" as="script"><link rel="prefetch" href="/assets/01.7.list_rendering.html-c0a1f1a5.js" as="script"><link rel="prefetch" href="/assets/01.8.event_handling.html-adce7b9c.js" as="script"><link rel="prefetch" href="/assets/01.9.form_input_binding.html-348dcf9f.js" as="script"><link rel="prefetch" href="/assets/02.1.registration.html-07f7a086.js" as="script"><link rel="prefetch" href="/assets/02.2.props.html-49558ded.js" as="script"><link rel="prefetch" href="/assets/02.3.events.html-f5646fca.js" as="script"><link rel="prefetch" href="/assets/02.4.v_model.html-a058f5cc.js" as="script"><link rel="prefetch" href="/assets/02.5.fallthrough_attributes.html-b148e9f9.js" as="script"><link rel="prefetch" href="/assets/02.6.slots.html-feaec111.js" as="script"><link rel="prefetch" href="/assets/02.7.provide_inject.html-0c2fca1c.js" as="script"><link rel="prefetch" href="/assets/02.8.async_component.html-3c4ccf1a.js" as="script"><link rel="prefetch" href="/assets/01.0.html-302a896f.js" as="script"><link rel="prefetch" href="/assets/01.1.html-e131d21d.js" as="script"><link rel="prefetch" href="/assets/03.0.html-8ed5ddd8.js" as="script"><link rel="prefetch" href="/assets/03.1.html-28327bf4.js" as="script"><link rel="prefetch" href="/assets/03.2.html-7d920e16.js" as="script"><link rel="prefetch" href="/assets/03.3.html-bcb60aad.js" as="script"><link rel="prefetch" href="/assets/03.4.html-014ba10b.js" as="script"><link rel="prefetch" href="/assets/03.5.html-78fcb765.js" as="script"><link rel="prefetch" href="/assets/03.6.html-1cb983fe.js" as="script"><link rel="prefetch" href="/assets/03.7.html-b8fff8f3.js" as="script"><link rel="prefetch" href="/assets/03.html-be7f6bf7.js" as="script"><link rel="prefetch" href="/assets/00.0.preface.html-70d6947d.js" as="script"><link rel="prefetch" href="/assets/01.1.http_basic.html-ade73fdd.js" as="script"><link rel="prefetch" href="/assets/01.2.context.html-35005330.js" as="script"><link rel="prefetch" href="/assets/01.3.trie_router.html-8b169b09.js" as="script"><link rel="prefetch" href="/assets/01.4.group.html-21e9cf4a.js" as="script"><link rel="prefetch" href="/assets/01.5.middleware.html-07275896.js" as="script"><link rel="prefetch" href="/assets/01.6.html_template.html-1d235780.js" as="script"><link rel="prefetch" href="/assets/01.7.recover.html-fbb4d46d.js" as="script"><link rel="prefetch" href="/assets/02.0.preface.html-a19fa7b6.js" as="script"><link rel="prefetch" href="/assets/02.1.lru.html-2ac9b600.js" as="script"><link rel="prefetch" href="/assets/02.2.concurrency.html-4a4af3dc.js" as="script"><link rel="prefetch" href="/assets/02.3.http_server.html-6c43fd6e.js" as="script"><link rel="prefetch" href="/assets/02.4.consistent_hash.html-1f9f1c0e.js" as="script"><link rel="prefetch" href="/assets/02.5.distributed_nodes.html-3d1d3f4b.js" as="script"><link rel="prefetch" href="/assets/02.6.single_flight.html-6e9a209c.js" as="script"><link rel="prefetch" href="/assets/02.7.protobuf.html-e246497e.js" as="script"><link rel="prefetch" href="/assets/03.0.preface.html-2adcc11a.js" as="script"><link rel="prefetch" href="/assets/03.1.sql.html-0006c9a4.js" as="script"><link rel="prefetch" href="/assets/03.2.orm.html-5d348942.js" as="script"><link rel="prefetch" href="/assets/03.3.insert-query.html-014c0715.js" as="script"><link rel="prefetch" href="/assets/03.4.chain.html-9d7c3250.js" as="script"><link rel="prefetch" href="/assets/03.5.hook.html-0300bb6f.js" as="script"><link rel="prefetch" href="/assets/03.6.trasaction.html-3d98c266.js" as="script"><link rel="prefetch" href="/assets/03.7.migrate.html-549ed39d.js" as="script"><link rel="prefetch" href="/assets/04.0.preface.html-409a97c5.js" as="script"><link rel="prefetch" href="/assets/04.1.codec.html-0467cd83.js" as="script"><link rel="prefetch" href="/assets/04.2.client.html-a4d25896.js" as="script"><link rel="prefetch" href="/assets/04.3.service.html-9972f844.js" as="script"><link rel="prefetch" href="/assets/04.4.timeout.html-b23a8eee.js" as="script"><link rel="prefetch" href="/assets/04.5.http.html-2e263a7c.js" as="script"><link rel="prefetch" href="/assets/04.6.load_balance.html-c64b52ef.js" as="script"><link rel="prefetch" href="/assets/04.7.service_discovery.html-293430dc.js" as="script"><link rel="prefetch" href="/assets/01.1.benchmark.html-df62f887.js" as="script"><link rel="prefetch" href="/assets/01.2.pprof.html-6380506b.js" as="script"><link rel="prefetch" href="/assets/02.1.string_concat.html-f807403a.js" as="script"><link rel="prefetch" href="/assets/02.2.slice.html-adfb6f7f.js" as="script"><link rel="prefetch" href="/assets/02.3.for-range.html-1fcaf934.js" as="script"><link rel="prefetch" href="/assets/02.4.reflect.html-1046956c.js" as="script"><link rel="prefetch" href="/assets/02.5.empty_struct.html-bbea0b29.js" as="script"><link rel="prefetch" href="/assets/02.6.mem_alignment.html-30010d41.js" as="script"><link rel="prefetch" href="/assets/03.1.mutex.html-817a0637.js" as="script"><link rel="prefetch" href="/assets/03.2.once.html-5afe6db0.js" as="script"><link rel="prefetch" href="/assets/04.1.reduce_exe_size.html-1ac4a6b7.js" as="script"><link rel="prefetch" href="/assets/04.2.mem_escape.html-18fad927.js" as="script"><link rel="prefetch" href="/assets/04.3.deadcode.html-f99b1471.js" as="script"><link rel="prefetch" href="/assets/01.0.html-894df5cd.js" as="script"><link rel="prefetch" href="/assets/01.1.html-ddd0647b.js" as="script"><link rel="prefetch" href="/assets/01.2.html-a63d1e4d.js" as="script"><link rel="prefetch" href="/assets/02.1.html-4ec8fde8.js" as="script"><link rel="prefetch" href="/assets/02.2.html-89c7a7ee.js" as="script"><link rel="prefetch" href="/assets/02.3.html-bac27220.js" as="script"><link rel="prefetch" href="/assets/03.1.html-1255654c.js" as="script"><link rel="prefetch" href="/assets/03.2.html-dbc3e1c8.js" as="script"><link rel="prefetch" href="/assets/03.3.html-665c9fb9.js" as="script"><link rel="prefetch" href="/assets/04.1.html-e0add764.js" as="script"><link rel="prefetch" href="/assets/04.2.html-2b6231de.js" as="script"><link rel="prefetch" href="/assets/04.3.html-953e3297.js" as="script"><link rel="prefetch" href="/assets/04.4.html-119ea8f7.js" as="script"><link rel="prefetch" href="/assets/04.5.html-e5b31497.js" as="script"><link rel="prefetch" href="/assets/05.1.html-5813230d.js" as="script"><link rel="prefetch" href="/assets/05.2.html-864bf966.js" as="script"><link rel="prefetch" href="/assets/05.3.html-002567bc.js" as="script"><link rel="prefetch" href="/assets/06.1.html-b271a625.js" as="script"><link rel="prefetch" href="/assets/06.2.html-2ea55bb1.js" as="script"><link rel="prefetch" href="/assets/07.1.html-dd65989b.js" as="script"><link rel="prefetch" href="/assets/07.2.html-1ad360ee.js" as="script"><link rel="prefetch" href="/assets/07.3.html-b4a24230.js" as="script"><link rel="prefetch" href="/assets/08.1.html-05fd233e.js" as="script"><link rel="prefetch" href="/assets/08.2.html-996db7d7.js" as="script"><link rel="prefetch" href="/assets/08.3.html-ebc29749.js" as="script"><link rel="prefetch" href="/assets/08.4.html-d2656a3c.js" as="script"><link rel="prefetch" href="/assets/09.1.html-7223d93c.js" as="script"><link rel="prefetch" href="/assets/09.2.html-a72780a3.js" as="script"><link rel="prefetch" href="/assets/10.1.html-bb58babf.js" as="script"><link rel="prefetch" href="/assets/10.2.html-1a59c741.js" as="script"><link rel="prefetch" href="/assets/11.1.html-283e8834.js" as="script"><link rel="prefetch" href="/assets/11.2.html-2aa1ea28.js" as="script"><link rel="prefetch" href="/assets/11.3.html-c9699ce9.js" as="script"><link rel="prefetch" href="/assets/12.1.html-471bba45.js" as="script"><link rel="prefetch" href="/assets/12.2.html-49a59ff3.js" as="script"><link rel="prefetch" href="/assets/12.3.html-3ab48691.js" as="script"><link rel="prefetch" href="/assets/12.4.html-3cb003d9.js" as="script"><link rel="prefetch" href="/assets/13.1.html-87704d66.js" as="script"><link rel="prefetch" href="/assets/13.2.html-07879e5c.js" as="script"><link rel="prefetch" href="/assets/13.3.html-d04472d7.js" as="script"><link rel="prefetch" href="/assets/14.1.html-07004d57.js" as="script"><link rel="prefetch" href="/assets/14.2.html-4408e382.js" as="script"><link rel="prefetch" href="/assets/14.3.html-6707560b.js" as="script"><link rel="prefetch" href="/assets/14.4.html-43be13c9.js" as="script"><link rel="prefetch" href="/assets/14.5.html-4c897eff.js" as="script"><link rel="prefetch" href="/assets/15.1.html-597e98fa.js" as="script"><link rel="prefetch" href="/assets/15.2.html-8e07132d.js" as="script"><link rel="prefetch" href="/assets/15.3.html-7bb6bc87.js" as="script"><link rel="prefetch" href="/assets/15.4.html-a061d563.js" as="script"><link rel="prefetch" href="/assets/03.0.chpater_summary.html-61d6cc73.js" as="script"><link rel="prefetch" href="/assets/03.1.array.html-a02237ec.js" as="script"><link rel="prefetch" href="/assets/03.2.slice.html-1e4989e2.js" as="script"><link rel="prefetch" href="/assets/03.3.hashmap.html-b3b9300f.js" as="script"><link rel="prefetch" href="/assets/03.4.string.html-2d3a7d5e.js" as="script"><link rel="prefetch" href="/assets/04.0.chapter_summary.html-e221b8dc.js" as="script"><link rel="prefetch" href="/assets/04.1.function.html-c71f7b01.js" as="script"><link rel="prefetch" href="/assets/04.2.interface.html-d3d0db9b.js" as="script"><link rel="prefetch" href="/assets/04.3.reflect.html-8a45f53e.js" as="script"><link rel="prefetch" href="/assets/05.0.chapter_summary.html-4f1cadf6.js" as="script"><link rel="prefetch" href="/assets/05.1.for_range.html-1be3d229.js" as="script"><link rel="prefetch" href="/assets/05.2.select.html-9b59e62f.js" as="script"><link rel="prefetch" href="/assets/05.3.defer.html-cfbc3bf5.js" as="script"><link rel="prefetch" href="/assets/05.4.panic_recover.html-6ed002a1.js" as="script"><link rel="prefetch" href="/assets/05.5.make_new.html-1d373cdf.js" as="script"><link rel="prefetch" href="/assets/06.1.context.html-138144db.js" as="script"><link rel="prefetch" href="/assets/06.2.sync-primitives.html-c3c88a36.js" as="script"><link rel="prefetch" href="/assets/06.3.timer.html-e3ded067.js" as="script"><link rel="prefetch" href="/assets/06.4.channel.html-63764cb2.js" as="script"><link rel="prefetch" href="/assets/06.5.goroutine.html-8d470102.js" as="script"><link rel="prefetch" href="/assets/06.6.netpoll.html-6d5ffd26.js" as="script"><link rel="prefetch" href="/assets/06.7.sysmon.html-d0bc7dab.js" as="script"><link rel="prefetch" href="/assets/07.1.malloc.html-0bd4e261.js" as="script"><link rel="prefetch" href="/assets/07.2.gc.html-8c8628b4.js" as="script"><link rel="prefetch" href="/assets/07.3.stackmem.html-b1fe0fdc.js" as="script"><link rel="prefetch" href="/assets/404.html-f04ced3e.js" as="script"><link rel="prefetch" href="/assets/index.html-ceb8952b.js" as="script"><link rel="prefetch" href="/assets/index.html-130e56fb.js" as="script"><link rel="prefetch" href="/assets/index.html-85fcd94e.js" as="script"><link rel="prefetch" href="/assets/index.html-87d7c325.js" as="script"><link rel="prefetch" href="/assets/index.html-420f8193.js" as="script"><link rel="prefetch" href="/assets/index.html-c444dfaa.js" as="script"><link rel="prefetch" href="/assets/index.html-f5658cdf.js" as="script"><link rel="prefetch" href="/assets/index.html-bf8208f5.js" as="script"><link rel="prefetch" href="/assets/index.html-482d6031.js" as="script"><link rel="prefetch" href="/assets/index.html-e757d955.js" as="script"><link rel="prefetch" href="/assets/index.html-043fc132.js" as="script"><link rel="prefetch" href="/assets/index.html-fa152a3a.js" as="script"><link rel="prefetch" href="/assets/index.html-6504c17d.js" as="script"><link rel="prefetch" href="/assets/index.html-41e606a0.js" as="script"><link rel="prefetch" href="/assets/index.html-6153bd5d.js" as="script"><link rel="prefetch" href="/assets/index.html-a5d8eaa9.js" as="script"><link rel="prefetch" href="/assets/index.html-54e3c8ab.js" as="script"><link rel="prefetch" href="/assets/index.html-ddc918cf.js" as="script"><link rel="prefetch" href="/assets/index.html-444d0179.js" as="script"><link rel="prefetch" href="/assets/index.html-777f4534.js" as="script"><link rel="prefetch" href="/assets/index.html-3280460b.js" as="script"><link rel="prefetch" href="/assets/index.html-a7f34e79.js" as="script"><link rel="prefetch" href="/assets/index.html-dafcf5d6.js" as="script"><link rel="prefetch" href="/assets/index.html-34cacf21.js" as="script"><link rel="prefetch" href="/assets/index.html-fe118143.js" as="script"><link rel="prefetch" href="/assets/index.html-09795e3f.js" as="script"><link rel="prefetch" href="/assets/index.html-23788c48.js" as="script"><link rel="prefetch" href="/assets/index.html-1b11cc7f.js" as="script"><link rel="prefetch" href="/assets/index.html-f2dbf44d.js" as="script"><link rel="prefetch" href="/assets/index.html-414c73df.js" as="script"><link rel="prefetch" href="/assets/index.html-24c006f2.js" as="script"><link rel="prefetch" href="/assets/index.html-0b09b364.js" as="script"><link rel="prefetch" href="/assets/index.html-c94e2918.js" as="script"><link rel="prefetch" href="/assets/index.html-54fb76d4.js" as="script"><link rel="prefetch" href="/assets/index.html-dc4bcdb7.js" as="script"><link rel="prefetch" href="/assets/index.html-63f22239.js" as="script"><link rel="prefetch" href="/assets/index.html-04be57d4.js" as="script"><link rel="prefetch" href="/assets/index.html-2e93365c.js" as="script"><link rel="prefetch" href="/assets/index.html-247ffb7d.js" as="script"><link rel="prefetch" href="/assets/index.html-1a120d38.js" as="script"><link rel="prefetch" href="/assets/index.html-7bc2d8de.js" as="script"><link rel="prefetch" href="/assets/index.html-2cf7afb8.js" as="script"><link rel="prefetch" href="/assets/index.html-ac0c491a.js" as="script"><link rel="prefetch" href="/assets/index.html-6d8be451.js" as="script"><link rel="prefetch" href="/assets/index.html-9e230aee.js" as="script"><link rel="prefetch" href="/assets/index.html-7533e8ff.js" as="script"><link rel="prefetch" href="/assets/index.html-6362a217.js" as="script"><link rel="prefetch" href="/assets/index.html-629e49ff.js" as="script"><link rel="prefetch" href="/assets/index.html-ae897ed8.js" as="script"><link rel="prefetch" href="/assets/index.html-332170c1.js" as="script"><link rel="prefetch" href="/assets/index.html-f816ee22.js" as="script"><link rel="prefetch" href="/assets/index.html-c2136884.js" as="script"><link rel="prefetch" href="/assets/index.html-379a3cf1.js" as="script"><link rel="prefetch" href="/assets/index.html-3efed9f9.js" as="script"><link rel="prefetch" href="/assets/index.html-38baf16d.js" as="script"><link rel="prefetch" href="/assets/index.html-08cb3857.js" as="script"><link rel="prefetch" href="/assets/index.html-dc443edb.js" as="script"><link rel="prefetch" href="/assets/index.html-f537b587.js" as="script"><link rel="prefetch" href="/assets/index.html-b9b9f623.js" as="script"><link rel="prefetch" href="/assets/index.html-da277cee.js" as="script"><link rel="prefetch" href="/assets/index.html-91690dac.js" as="script"><link rel="prefetch" href="/assets/index.html-1013f67b.js" as="script"><link rel="prefetch" href="/assets/index.html-3fe25ac9.js" as="script"><link rel="prefetch" href="/assets/index.html-3cb70739.js" as="script"><link rel="prefetch" href="/assets/index.html-e63ca108.js" as="script"><link rel="prefetch" href="/assets/index.html-0c5f835f.js" as="script"><link rel="prefetch" href="/assets/index.html-8781e9ed.js" as="script"><link rel="prefetch" href="/assets/index.html-0b21c429.js" as="script"><link rel="prefetch" href="/assets/index.html-0b0ed0dd.js" as="script"><link rel="prefetch" href="/assets/index.html-de823f62.js" as="script"><link rel="prefetch" href="/assets/index.html-9853cc3e.js" as="script"><link rel="prefetch" href="/assets/index.html-2c4bfe49.js" as="script"><link rel="prefetch" href="/assets/index.html-2d5e8db4.js" as="script"><link rel="prefetch" href="/assets/index.html-ff389cc2.js" as="script"><link rel="prefetch" href="/assets/index.html-afbbef21.js" as="script"><link rel="prefetch" href="/assets/index.html-c32f94dd.js" as="script"><link rel="prefetch" href="/assets/index.html-ca70afdc.js" as="script"><link rel="prefetch" href="/assets/index.html-86008285.js" as="script"><link rel="prefetch" href="/assets/index.html-c11fec70.js" as="script"><link rel="prefetch" href="/assets/index.html-2f236546.js" as="script"><link rel="prefetch" href="/assets/index.html-b6503f92.js" as="script"><link rel="prefetch" href="/assets/index.html-b31974c8.js" as="script"><link rel="prefetch" href="/assets/index.html-6268ef81.js" as="script"><link rel="prefetch" href="/assets/index.html-9b424d43.js" as="script"><link rel="prefetch" href="/assets/index.html-54e1463c.js" as="script"><link rel="prefetch" href="/assets/index.html-801204ba.js" as="script"><link rel="prefetch" href="/assets/index.html-a71abe8b.js" as="script"><link rel="prefetch" href="/assets/index.html-318b66ab.js" as="script"><link rel="prefetch" href="/assets/index.html-717b6fe4.js" as="script"><link rel="prefetch" href="/assets/index.html-f3806308.js" as="script"><link rel="prefetch" href="/assets/index.html-cd69b172.js" as="script"><link rel="prefetch" href="/assets/index.html-73184534.js" as="script"><link rel="prefetch" href="/assets/index.html-f423a624.js" as="script"><link rel="prefetch" href="/assets/index.html-bc7bea8f.js" as="script"><link rel="prefetch" href="/assets/index.html-acfc2ec4.js" as="script"><link rel="prefetch" href="/assets/index.html-d8b61d9f.js" as="script"><link rel="prefetch" href="/assets/index.html-29d3e4b2.js" as="script"><link rel="prefetch" href="/assets/index.html-798226c2.js" as="script"><link rel="prefetch" href="/assets/index.html-7c2f0d46.js" as="script"><link rel="prefetch" href="/assets/index.html-42e3783f.js" as="script"><link rel="prefetch" href="/assets/index.html-9a55e93c.js" as="script"><link rel="prefetch" href="/assets/index.html-03451239.js" as="script"><link rel="prefetch" href="/assets/index.html-21c27cc1.js" as="script"><link rel="prefetch" href="/assets/index.html-fb83cbd2.js" as="script"><link rel="prefetch" href="/assets/index.html-a350957e.js" as="script"><link rel="prefetch" href="/assets/index.html-32126228.js" as="script"><link rel="prefetch" href="/assets/index.html-94f27bf6.js" as="script"><link rel="prefetch" href="/assets/index.html-1ce5c1da.js" as="script"><link rel="prefetch" href="/assets/index.html-98ae0170.js" as="script"><link rel="prefetch" href="/assets/index.html-0599e99a.js" as="script"><link rel="prefetch" href="/assets/index.html-592082f9.js" as="script"><link rel="prefetch" href="/assets/index.html-38d448dd.js" as="script"><link rel="prefetch" href="/assets/index.html-ec46c3a6.js" as="script"><link rel="prefetch" href="/assets/index.html-e609b71c.js" as="script"><link rel="prefetch" href="/assets/index.html-04a11369.js" as="script"><link rel="prefetch" href="/assets/index.html-d1922e1a.js" as="script"><link rel="prefetch" href="/assets/index.html-c43655ce.js" as="script"><link rel="prefetch" href="/assets/index.html-b67245ca.js" as="script"><link rel="prefetch" href="/assets/index.html-f027bd21.js" as="script"><link rel="prefetch" href="/assets/index.html-d2d2dac9.js" as="script"><link rel="prefetch" href="/assets/index.html-da3a00f6.js" as="script"><link rel="prefetch" href="/assets/index.html-413b84f4.js" as="script"><link rel="prefetch" href="/assets/index.html-61991dfb.js" as="script"><link rel="prefetch" href="/assets/index.html-c45a46d0.js" as="script"><link rel="prefetch" href="/assets/index.html-868e7f40.js" as="script"><link rel="prefetch" href="/assets/index.html-d3340ab4.js" as="script"><link rel="prefetch" href="/assets/index.html-d3097db7.js" as="script"><link rel="prefetch" href="/assets/index.html-2add9de8.js" as="script"><link rel="prefetch" href="/assets/index.html-44b0b900.js" as="script"><link rel="prefetch" href="/assets/index.html-abf762fe.js" as="script"><link rel="prefetch" href="/assets/index.html-91332698.js" as="script"><link rel="prefetch" href="/assets/index.html-f8a63582.js" as="script"><link rel="prefetch" href="/assets/index.html-b56c085b.js" as="script"><link rel="prefetch" href="/assets/index.html-f4695ce0.js" as="script"><link rel="prefetch" href="/assets/index.html-1190d7a6.js" as="script"><link rel="prefetch" href="/assets/index.html-c12bf4cd.js" as="script"><link rel="prefetch" href="/assets/index.html-fef56eda.js" as="script"><link rel="prefetch" href="/assets/index.html-3915144b.js" as="script"><link rel="prefetch" href="/assets/index.html-e5852f95.js" as="script"><link rel="prefetch" href="/assets/index.html-f02261a6.js" as="script"><link rel="prefetch" href="/assets/about-me.html-3267e626.js" as="script"><link rel="prefetch" href="/assets/index.html-98071b78.js" as="script"><link rel="prefetch" href="/assets/index.html-cd6a5e7a.js" as="script"><link rel="prefetch" href="/assets/ebiten_breakout.html-210011d0.js" as="script"><link rel="prefetch" href="/assets/index.html-61000569.js" as="script"><link rel="prefetch" href="/assets/index.html-df66bcd0.js" as="script"><link rel="prefetch" href="/assets/index.html-2131e87e.js" as="script"><link rel="prefetch" href="/assets/index.html-99b25466.js" as="script"><link rel="prefetch" href="/assets/des.html-0f3bc69c.js" as="script"><link rel="prefetch" href="/assets/index.html-9500e490.js" as="script"><link rel="prefetch" href="/assets/index.html-5276dca2.js" as="script"><link rel="prefetch" href="/assets/index.html-cb67ed78.js" as="script"><link rel="prefetch" href="/assets/index.html-e536c77b.js" as="script"><link rel="prefetch" href="/assets/index.html-b7b86631.js" as="script"><link rel="prefetch" href="/assets/1.twoSum.html-f6e5b2db.js" as="script"><link rel="prefetch" href="/assets/102.binary_tree_level_order_traversal.html-6bfbcd80.js" as="script"><link rel="prefetch" href="/assets/103.binary_tree_zigzag_level_order_traversal.html-59691693.js" as="script"><link rel="prefetch" href="/assets/121.122.123.188.309.714.stock_series.html-432a5b43.js" as="script"><link rel="prefetch" href="/assets/141.142.linked_list_cycle.html-2ad85ddb.js" as="script"><link rel="prefetch" href="/assets/146.LRU_cache.html-90769030.js" as="script"><link rel="prefetch" href="/assets/15.three_sum.html-7a09ca63.js" as="script"><link rel="prefetch" href="/assets/20.valid_parentheses.html-7930ebb4.js" as="script"><link rel="prefetch" href="/assets/200.number_of_islands.html-bd266258.js" as="script"><link rel="prefetch" href="/assets/206.reverse_linked_list.html-4025d523.js" as="script"><link rel="prefetch" href="/assets/21.merge_two_sorted_lists.html-db2f7836.js" as="script"><link rel="prefetch" href="/assets/215.kth_ele_in_arr.html-f4ebb5c7.js" as="script"><link rel="prefetch" href="/assets/25.reverse_nodes_in_k_group.html-a585bc47.js" as="script"><link rel="prefetch" href="/assets/3.longest_substring_without_repeating_characters.html-6b5881be.js" as="script"><link rel="prefetch" href="/assets/33.search_in_rotated_sorted_array.html-6e6a4317.js" as="script"><link rel="prefetch" href="/assets/46.permutations.html-d3af9b31.js" as="script"><link rel="prefetch" href="/assets/5.longest_palindromic_substring.html-646a135c.js" as="script"><link rel="prefetch" href="/assets/53.maximum_subarray.html-15f7d9ea.js" as="script"><link rel="prefetch" href="/assets/88.merge_sorted_array.html-5d8c6481.js" as="script"><link rel="prefetch" href="/assets/index.html-4a5bbc46.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-a14d6711.js" as="script"><link rel="prefetch" href="/assets/endless.html-3bb6348d.js" as="script"><link rel="prefetch" href="/assets/gin.html-3c7df5ea.js" as="script"><link rel="prefetch" href="/assets/go-jwt.html-a4e559fd.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-86769bc5.js" as="script"><link rel="prefetch" href="/assets/nginx.html-416f8259.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-79c40c0d.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-8aee35aa.js" as="script"><link rel="prefetch" href="/assets/index.html-b96184d3.js" as="script"><link rel="prefetch" href="/assets/index.html-1fae1ea4.js" as="script"><link rel="prefetch" href="/assets/index.html-a0d9388d.js" as="script"><link rel="prefetch" href="/assets/index.html-26e250b5.js" as="script"><link rel="prefetch" href="/assets/bytes_to_string_quickly.html-6d31f631.js" as="script"><link rel="prefetch" href="/assets/natural_sort.html-f84e1d4f.js" as="script"><link rel="prefetch" href="/assets/set_default_cmd_charset.html-a0772958.js" as="script"><link rel="prefetch" href="/assets/clash-linux.html-42a820bb.js" as="script"><link rel="prefetch" href="/assets/pi-docker-blog.html-34742762.js" as="script"><link rel="prefetch" href="/assets/pi-go.html-ea8d168d.js" as="script"><link rel="prefetch" href="/assets/pi-nginx.html-7055e82d.js" as="script"><link rel="prefetch" href="/assets/ghaction.html-795fd8cc.js" as="script"><link rel="prefetch" href="/assets/live2d_widget.html-5f280724.js" as="script"><link rel="prefetch" href="/assets/migrate_to_v2.html-35eefcae.js" as="script"><link rel="prefetch" href="/assets/moe-counter.html-cb0eab67.js" as="script"><link rel="prefetch" href="/assets/ssl.html-097cfff3.js" as="script"><link rel="prefetch" href="/assets/gpg_key.html-8a462f11.js" as="script"><link rel="prefetch" href="/assets/arch_installation.html-179f8ce2.js" as="script"><link rel="prefetch" href="/assets/01.1.html-d3d23c4f.js" as="script"><link rel="prefetch" href="/assets/01.2.html-0ac52517.js" as="script"><link rel="prefetch" href="/assets/01.3.html-2c37ba41.js" as="script"><link rel="prefetch" href="/assets/Preface.html-93fffca3.js" as="script"><link rel="prefetch" href="/assets/preface.html-14021dbd.js" as="script"><link rel="prefetch" href="/assets/docker-nginx.html-0da88693.js" as="script"><link rel="prefetch" href="/assets/get-started.html-5349e7a0.js" as="script"><link rel="prefetch" href="/assets/GMPModel.html-eae906e8.js" as="script"><link rel="prefetch" href="/assets/cast.html-3e87bb1b.js" as="script"><link rel="prefetch" href="/assets/cobra.html-27c4b3ad.js" as="script"><link rel="prefetch" href="/assets/email.html-000a7f2f.js" as="script"><link rel="prefetch" href="/assets/flag.html-8b8c2c49.js" as="script"><link rel="prefetch" href="/assets/fsnotify.html-6be6b992.js" as="script"><link rel="prefetch" href="/assets/go-flags.html-9aceca49.js" as="script"><link rel="prefetch" href="/assets/go-homedir.html-3de591fe.js" as="script"><link rel="prefetch" href="/assets/go-ini.html-7b3c2b9c.js" as="script"><link rel="prefetch" href="/assets/godotenv.html-78489f2b.js" as="script"><link rel="prefetch" href="/assets/log.html-acb6fd6b.js" as="script"><link rel="prefetch" href="/assets/logrus.html-0fadc563.js" as="script"><link rel="prefetch" href="/assets/preface.html-58598a7e.js" as="script"><link rel="prefetch" href="/assets/uniplace-carbon.html-4025c9ee.js" as="script"><link rel="prefetch" href="/assets/viper.html-055c10f4.js" as="script"><link rel="prefetch" href="/assets/01.1.html-d7920d92.js" as="script"><link rel="prefetch" href="/assets/01.2.html-6306f2a1.js" as="script"><link rel="prefetch" href="/assets/01.3.html-ef3e1039.js" as="script"><link rel="prefetch" href="/assets/01.4.html-92eff9e1.js" as="script"><link rel="prefetch" href="/assets/01.5.html-50aa66ab.js" as="script"><link rel="prefetch" href="/assets/gorm.html-99337628.js" as="script"><link rel="prefetch" href="/assets/01.1.html-267a95f0.js" as="script"><link rel="prefetch" href="/assets/0.basics.html-49c37e21.js" as="script"><link rel="prefetch" href="/assets/1.questions-syntax.html-b156fb1b.js" as="script"><link rel="prefetch" href="/assets/2.questions-underlying.html-037b6980.js" as="script"><link rel="prefetch" href="/assets/3.questions-concurrency.html-66361d83.js" as="script"><link rel="prefetch" href="/assets/1.basics.html-1a1759ad.js" as="script"><link rel="prefetch" href="/assets/2.index.html-00e45924.js" as="script"><link rel="prefetch" href="/assets/3.transaction.html-f69a75cb.js" as="script"><link rel="prefetch" href="/assets/4.lock.html-8e7f2a07.js" as="script"><link rel="prefetch" href="/assets/5.log.html-45906884.js" as="script"><link rel="prefetch" href="/assets/6.mem.html-60b6ec0a.js" as="script"><link rel="prefetch" href="/assets/qa_1.html-64829da8.js" as="script"><link rel="prefetch" href="/assets/1.basics.html-55413e75.js" as="script"><link rel="prefetch" href="/assets/2.http.html-9c039b25.js" as="script"><link rel="prefetch" href="/assets/3.tcp.html-dfef0ee8.js" as="script"><link rel="prefetch" href="/assets/4.ip.html-7c710eaf.js" as="script"><link rel="prefetch" href="/assets/01.qas.html-b80bf396.js" as="script"><link rel="prefetch" href="/assets/02.ds.html-17c16e2d.js" as="script"><link rel="prefetch" href="/assets/03.data_storage.html-a4e8a082.js" as="script"><link rel="prefetch" href="/assets/04.mem.html-edb548d7.js" as="script"><link rel="prefetch" href="/assets/05.cluster.html-4e51ff2b.js" as="script"><link rel="prefetch" href="/assets/06.cache.html-0d0461de.js" as="script"><link rel="prefetch" href="/assets/00_preface.html-3b63140e.js" as="script"><link rel="prefetch" href="/assets/spf13-vim-plugin.html-ae384c9a.js" as="script"><link rel="prefetch" href="/assets/atls.html-e3c3a8f7.js" as="script"><link rel="prefetch" href="/assets/basic_tutorial.html-2fff9289.js" as="script"><link rel="prefetch" href="/assets/generated_code.html-84942110.js" as="script"><link rel="prefetch" href="/assets/introduction.html-66621508.js" as="script"><link rel="prefetch" href="/assets/preface.html-5c715c94.js" as="script"><link rel="prefetch" href="/assets/quick_start.html-c1bcb1fa.js" as="script"><link rel="prefetch" href="/assets/basics-go.html-0aa8edf4.js" as="script"><link rel="prefetch" href="/assets/language-guide-proto3.html-4a8292af.js" as="script"><link rel="prefetch" href="/assets/preface.html-422348f3.js" as="script"><link rel="prefetch" href="/assets/00_preface.html-9a278777.js" as="script"><link rel="prefetch" href="/assets/vue-cli.html-20743db3.js" as="script"><link rel="prefetch" href="/assets/vue-router.html-5481617a.js" as="script"><link rel="prefetch" href="/assets/vuex.html-96593038.js" as="script"><link rel="prefetch" href="/assets/01.dp_sc_optimization_summary.html-f48ff56b.js" as="script"><link rel="prefetch" href="/assets/02.general_solution_of_stock_series_problem.html-ebf3a7fc.js" as="script"><link rel="prefetch" href="/assets/01.QuickSort.html-3571f3fb.js" as="script"><link rel="prefetch" href="/assets/02.MergeSort.html-e29b907d.js" as="script"><link rel="prefetch" href="/assets/03.HeapSort.html-aabbe863.js" as="script"><link rel="prefetch" href="/assets/0.00.html-476b40fa.js" as="script"><link rel="prefetch" href="/assets/01.1.html-d7affb77.js" as="script"><link rel="prefetch" href="/assets/01.2.html-c4b26aa4.js" as="script"><link rel="prefetch" href="/assets/01.3.html-48012e80.js" as="script"><link rel="prefetch" href="/assets/1.impl_of_heap.html-a1493dbc.js" as="script"><link rel="prefetch" href="/assets/2.map_underlying.html-c926a9af.js" as="script"><link rel="prefetch" href="/assets/3.channel_underlying.html-2114d8fb.js" as="script"><link rel="prefetch" href="/assets/4.synchronization_primitives.html-8c04690b.js" as="script"><link rel="prefetch" href="/assets/5.defer.html-be644f3a.js" as="script"><link rel="prefetch" href="/assets/6.panic.html-fd7e3a96.js" as="script"><link rel="prefetch" href="/assets/slice_equal.html-510f73e6.js" as="script"><link rel="prefetch" href="/assets/01.1.why_is_this_slicegrow_formula.html-7d045030.js" as="script"><link rel="prefetch" href="/assets/01.2.why_hmap_overflowthreshold_loadfactory.html-d12994fa.js" as="script"><link rel="prefetch" href="/assets/3.why_cannot_value_using_pointerinterfacemethods.html-b99fe95a.js" as="script"><link rel="prefetch" href="/assets/4.why_iterate_map_randomly.html-a7f61c67.js" as="script"><link rel="prefetch" href="/assets/04.1.html-3ce77c6f.js" as="script"><link rel="prefetch" href="/assets/04.2.html-35f4eca9.js" as="script"><link rel="prefetch" href="/assets/04.3.html-c17dff84.js" as="script"><link rel="prefetch" href="/assets/04.4.html-7a731264.js" as="script"><link rel="prefetch" href="/assets/Preface.html-3e8d387c.js" as="script"><link rel="prefetch" href="/assets/14-q-syntax.html-9980fc94.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-fc50f60c.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-8ccb7a5e.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-5d1bbc3f.js" as="script"><link rel="prefetch" href="/assets/1.qa.html-88beb1f1.js" as="script"><link rel="prefetch" href="/assets/01.overview.html-de8ca515.js" as="script"><link rel="prefetch" href="/assets/03.sync.html-e0905358.js" as="script"><link rel="prefetch" href="/assets/04.pattern.html-3a7916fd.js" as="script"><link rel="prefetch" href="/assets/05.massive_concurrency.html-33ac6006.js" as="script"><link rel="prefetch" href="/assets/01.1.html-2dda47c5.js" as="script"><link rel="prefetch" href="/assets/01.2.html-ad3e13b8.js" as="script"><link rel="prefetch" href="/assets/01.3.html-cf10b10f.js" as="script"><link rel="prefetch" href="/assets/01.html-4e41fa46.js" as="script"><link rel="prefetch" href="/assets/preface.html-82286844.js" as="script"><link rel="prefetch" href="/assets/Gee.html-f175ee01.js" as="script"><link rel="prefetch" href="/assets/GeeCache.html-b9ec0d5f.js" as="script"><link rel="prefetch" href="/assets/GeeORM.html-0e3b48f6.js" as="script"><link rel="prefetch" href="/assets/GeeRPC.html-6b2121ba.js" as="script"><link rel="prefetch" href="/assets/04.1.html-e2d6beb3.js" as="script"><link rel="prefetch" href="/assets/04.2.html-dba5e93d.js" as="script"><link rel="prefetch" href="/assets/04.3.html-265672af.js" as="script"><link rel="prefetch" href="/assets/04.4.html-eab03042.js" as="script"><link rel="prefetch" href="/assets/04.5.html-13b4d6e2.js" as="script"><link rel="prefetch" href="/assets/04.6.html-d74e6e19.js" as="script"><link rel="prefetch" href="/assets/04.7.html-28cb9549.js" as="script"><link rel="prefetch" href="/assets/04.8.html-b444d332.js" as="script"><link rel="prefetch" href="/assets/04.9.html-ffeaf38b.js" as="script"><link rel="prefetch" href="/assets/05.0.html-21eb536c.js" as="script"><link rel="prefetch" href="/assets/05.1.html-d2d4cc2c.js" as="script"><link rel="prefetch" href="/assets/05.2.html-6f59ac81.js" as="script"><link rel="prefetch" href="/assets/05.3.html-4aef9494.js" as="script"><link rel="prefetch" href="/assets/05.4.html-07150e3f.js" as="script"><link rel="prefetch" href="/assets/05.5.html-e4b6afb2.js" as="script"><link rel="prefetch" href="/assets/05.6.html-9039c0b6.js" as="script"><link rel="prefetch" href="/assets/06.1.html-ccc83aae.js" as="script"><link rel="prefetch" href="/assets/06.10.html-4f0bbacb.js" as="script"><link rel="prefetch" href="/assets/06.12.html-5caf49bb.js" as="script"><link rel="prefetch" href="/assets/06.2.html-2e3a6586.js" as="script"><link rel="prefetch" href="/assets/06.3.html-eef7ea67.js" as="script"><link rel="prefetch" href="/assets/06.4.html-a86bfffd.js" as="script"><link rel="prefetch" href="/assets/06.5.html-81404353.js" as="script"><link rel="prefetch" href="/assets/06.6.html-cf59c3f6.js" as="script"><link rel="prefetch" href="/assets/06.7.html-8f50b99e.js" as="script"><link rel="prefetch" href="/assets/06.8.html-d404d269.js" as="script"><link rel="prefetch" href="/assets/06.9.html-32d6dcc8.js" as="script"><link rel="prefetch" href="/assets/6.11.html-45efd2fb.js" as="script"><link rel="prefetch" href="/assets/07.1.html-84bb39a2.js" as="script"><link rel="prefetch" href="/assets/07.2.html-6f77e1fb.js" as="script"><link rel="prefetch" href="/assets/07.3.html-2f84f860.js" as="script"><link rel="prefetch" href="/assets/07.4.html-63151079.js" as="script"><link rel="prefetch" href="/assets/07.5.html-09d77ecb.js" as="script"><link rel="prefetch" href="/assets/07.6.html-8824b16c.js" as="script"><link rel="prefetch" href="/assets/08.0.html-bf8761cc.js" as="script"><link rel="prefetch" href="/assets/08.1.html-365b2528.js" as="script"><link rel="prefetch" href="/assets/08.2.html-6a745a73.js" as="script"><link rel="prefetch" href="/assets/08.3.html-39124434.js" as="script"><link rel="prefetch" href="/assets/08.4.html-384d97be.js" as="script"><link rel="prefetch" href="/assets/08.5.html-5d09750f.js" as="script"><link rel="prefetch" href="/assets/08.6.html-bd703e05.js" as="script"><link rel="prefetch" href="/assets/09.0.html-2c9682dd.js" as="script"><link rel="prefetch" href="/assets/09.1.html-d0b95d3c.js" as="script"><link rel="prefetch" href="/assets/10.0.html-6a83dee9.js" as="script"><link rel="prefetch" href="/assets/10.1.html-0c56fed6.js" as="script"><link rel="prefetch" href="/assets/10.2.html-705745ea.js" as="script"><link rel="prefetch" href="/assets/10.3.html-ec4fd394.js" as="script"><link rel="prefetch" href="/assets/10.4.html-c7ca5984.js" as="script"><link rel="prefetch" href="/assets/10.5.html-ccd473a1.js" as="script"><link rel="prefetch" href="/assets/10.6.html-350e479c.js" as="script"><link rel="prefetch" href="/assets/11.0.html-de865019.js" as="script"><link rel="prefetch" href="/assets/11.1.html-7f1ddff1.js" as="script"><link rel="prefetch" href="/assets/11.2.html-07892ff7.js" as="script"><link rel="prefetch" href="/assets/11.3.html-76cf933b.js" as="script"><link rel="prefetch" href="/assets/11.4.html-ee78abcb.js" as="script"><link rel="prefetch" href="/assets/11.5.html-9b629be5.js" as="script"><link rel="prefetch" href="/assets/11.6.html-5a509bc0.js" as="script"><link rel="prefetch" href="/assets/11.9.html-29e83e18.js" as="script"><link rel="prefetch" href="/assets/13.1.html-36308485.js" as="script"><link rel="prefetch" href="/assets/13.2.html-da542180.js" as="script"><link rel="prefetch" href="/assets/13.3.html-2ae7483c.js" as="script"><link rel="prefetch" href="/assets/13.4.html-334f06bd.js" as="script"><link rel="prefetch" href="/assets/13.5.html-6b0383e6.js" as="script"><link rel="prefetch" href="/assets/13.6.html-955103ae.js" as="script"><link rel="prefetch" href="/assets/13.7.html-f3dfac13.js" as="script"><link rel="prefetch" href="/assets/14.1.html-8c9ae1fd.js" as="script"><link rel="prefetch" href="/assets/14.12.html-6e128f62.js" as="script"><link rel="prefetch" href="/assets/14.13.html-f27aafe7.js" as="script"><link rel="prefetch" href="/assets/14.14.html-02ebe5ae.js" as="script"><link rel="prefetch" href="/assets/14.16.html-076c10ad.js" as="script"><link rel="prefetch" href="/assets/14.17.html-701287f7.js" as="script"><link rel="prefetch" href="/assets/14.2.html-6e9379ad.js" as="script"><link rel="prefetch" href="/assets/14.3.html-f7baa16e.js" as="script"><link rel="prefetch" href="/assets/14.4.html-83eac939.js" as="script"><link rel="prefetch" href="/assets/14.5.html-1e26e3ff.js" as="script"><link rel="prefetch" href="/assets/14.6.html-f1fefb27.js" as="script"><link rel="prefetch" href="/assets/14.7.html-cb78c792.js" as="script"><link rel="prefetch" href="/assets/14.8.html-5790baf5.js" as="script"><link rel="prefetch" href="/assets/14.9.html-4d014c93.js" as="script"><link rel="prefetch" href="/assets/00.start.html-b7991e57.js" as="script"><link rel="prefetch" href="/assets/01.1.create_app.html-144a5e74.js" as="script"><link rel="prefetch" href="/assets/01.10.lifecycle_hooks.html-be70fba6.js" as="script"><link rel="prefetch" href="/assets/01.11.watchers.html-8c87fd4f.js" as="script"><link rel="prefetch" href="/assets/01.12.template_refs.html-d53aba80.js" as="script"><link rel="prefetch" href="/assets/01.13.component_basics.html-a08213b0.js" as="script"><link rel="prefetch" href="/assets/01.2.template_syntax.html-181a1652.js" as="script"><link rel="prefetch" href="/assets/01.3.reactivity_fundamental.html-a554b16f.js" as="script"><link rel="prefetch" href="/assets/01.4.computed_props.html-b772591b.js" as="script"><link rel="prefetch" href="/assets/01.5.class_style_binding.html-fdc141b1.js" as="script"><link rel="prefetch" href="/assets/01.6.conditional_rendering.html-4d9bd599.js" as="script"><link rel="prefetch" href="/assets/01.7.list_rendering.html-386b8eec.js" as="script"><link rel="prefetch" href="/assets/01.8.event_handling.html-fca98003.js" as="script"><link rel="prefetch" href="/assets/01.9.form_input_binding.html-98155b79.js" as="script"><link rel="prefetch" href="/assets/02.1.registration.html-0a4fa7f2.js" as="script"><link rel="prefetch" href="/assets/02.2.props.html-c6abd0fa.js" as="script"><link rel="prefetch" href="/assets/02.3.events.html-0a56397f.js" as="script"><link rel="prefetch" href="/assets/02.4.v_model.html-ae463be1.js" as="script"><link rel="prefetch" href="/assets/02.5.fallthrough_attributes.html-a30ddb55.js" as="script"><link rel="prefetch" href="/assets/02.6.slots.html-1692f60a.js" as="script"><link rel="prefetch" href="/assets/02.7.provide_inject.html-d6139f64.js" as="script"><link rel="prefetch" href="/assets/02.8.async_component.html-22729176.js" as="script"><link rel="prefetch" href="/assets/01.0.html-7ed25ef5.js" as="script"><link rel="prefetch" href="/assets/01.1.html-b5dc528b.js" as="script"><link rel="prefetch" href="/assets/03.0.html-032e6e36.js" as="script"><link rel="prefetch" href="/assets/03.1.html-800a28da.js" as="script"><link rel="prefetch" href="/assets/03.2.html-dd68c738.js" as="script"><link rel="prefetch" href="/assets/03.3.html-f0d2cf2d.js" as="script"><link rel="prefetch" href="/assets/03.4.html-e6801459.js" as="script"><link rel="prefetch" href="/assets/03.5.html-3ab13ee6.js" as="script"><link rel="prefetch" href="/assets/03.6.html-d9707204.js" as="script"><link rel="prefetch" href="/assets/03.7.html-cee5bcc2.js" as="script"><link rel="prefetch" href="/assets/03.html-d0ca3d4b.js" as="script"><link rel="prefetch" href="/assets/00.0.preface.html-a9c26cfe.js" as="script"><link rel="prefetch" href="/assets/01.1.http_basic.html-138fe2c5.js" as="script"><link rel="prefetch" href="/assets/01.2.context.html-6d665d9d.js" as="script"><link rel="prefetch" href="/assets/01.3.trie_router.html-40288eda.js" as="script"><link rel="prefetch" href="/assets/01.4.group.html-4d6e9a8b.js" as="script"><link rel="prefetch" href="/assets/01.5.middleware.html-05c9d0a4.js" as="script"><link rel="prefetch" href="/assets/01.6.html_template.html-fccb4480.js" as="script"><link rel="prefetch" href="/assets/01.7.recover.html-9f5b1c01.js" as="script"><link rel="prefetch" href="/assets/02.0.preface.html-d7af9a45.js" as="script"><link rel="prefetch" href="/assets/02.1.lru.html-2a5fe3d6.js" as="script"><link rel="prefetch" href="/assets/02.2.concurrency.html-8421757b.js" as="script"><link rel="prefetch" href="/assets/02.3.http_server.html-00cdc1ca.js" as="script"><link rel="prefetch" href="/assets/02.4.consistent_hash.html-56268575.js" as="script"><link rel="prefetch" href="/assets/02.5.distributed_nodes.html-90c6cd29.js" as="script"><link rel="prefetch" href="/assets/02.6.single_flight.html-1137f1d9.js" as="script"><link rel="prefetch" href="/assets/02.7.protobuf.html-84df68d3.js" as="script"><link rel="prefetch" href="/assets/03.0.preface.html-cba3c617.js" as="script"><link rel="prefetch" href="/assets/03.1.sql.html-ebc1ce3c.js" as="script"><link rel="prefetch" href="/assets/03.2.orm.html-5a08ae8b.js" as="script"><link rel="prefetch" href="/assets/03.3.insert-query.html-b0fd3e06.js" as="script"><link rel="prefetch" href="/assets/03.4.chain.html-f8e0a86c.js" as="script"><link rel="prefetch" href="/assets/03.5.hook.html-de067779.js" as="script"><link rel="prefetch" href="/assets/03.6.trasaction.html-5f59d9b6.js" as="script"><link rel="prefetch" href="/assets/03.7.migrate.html-dafbaf8b.js" as="script"><link rel="prefetch" href="/assets/04.0.preface.html-d1c84cad.js" as="script"><link rel="prefetch" href="/assets/04.1.codec.html-d1f6f06d.js" as="script"><link rel="prefetch" href="/assets/04.2.client.html-79654523.js" as="script"><link rel="prefetch" href="/assets/04.3.service.html-6cf0b0ba.js" as="script"><link rel="prefetch" href="/assets/04.4.timeout.html-462d1f9e.js" as="script"><link rel="prefetch" href="/assets/04.5.http.html-4f0fce7d.js" as="script"><link rel="prefetch" href="/assets/04.6.load_balance.html-eee8eb01.js" as="script"><link rel="prefetch" href="/assets/04.7.service_discovery.html-f740b3fe.js" as="script"><link rel="prefetch" href="/assets/01.1.benchmark.html-cd41cba0.js" as="script"><link rel="prefetch" href="/assets/01.2.pprof.html-f13f10c9.js" as="script"><link rel="prefetch" href="/assets/02.1.string_concat.html-0adf0e27.js" as="script"><link rel="prefetch" href="/assets/02.2.slice.html-318f9d14.js" as="script"><link rel="prefetch" href="/assets/02.3.for-range.html-257f5e33.js" as="script"><link rel="prefetch" href="/assets/02.4.reflect.html-0621b5d0.js" as="script"><link rel="prefetch" href="/assets/02.5.empty_struct.html-28030525.js" as="script"><link rel="prefetch" href="/assets/02.6.mem_alignment.html-f8048e73.js" as="script"><link rel="prefetch" href="/assets/03.1.mutex.html-56a2eabd.js" as="script"><link rel="prefetch" href="/assets/03.2.once.html-cc7ca7c2.js" as="script"><link rel="prefetch" href="/assets/04.1.reduce_exe_size.html-7373ac08.js" as="script"><link rel="prefetch" href="/assets/04.2.mem_escape.html-71b1fced.js" as="script"><link rel="prefetch" href="/assets/04.3.deadcode.html-a51903d6.js" as="script"><link rel="prefetch" href="/assets/01.0.html-2b8c8964.js" as="script"><link rel="prefetch" href="/assets/01.1.html-4cc6b68f.js" as="script"><link rel="prefetch" href="/assets/01.2.html-6f447c8c.js" as="script"><link rel="prefetch" href="/assets/02.1.html-b59590ff.js" as="script"><link rel="prefetch" href="/assets/02.2.html-b1ee660e.js" as="script"><link rel="prefetch" href="/assets/02.3.html-7a93c7ed.js" as="script"><link rel="prefetch" href="/assets/03.1.html-59b3d038.js" as="script"><link rel="prefetch" href="/assets/03.2.html-8b3557c9.js" as="script"><link rel="prefetch" href="/assets/03.3.html-0565b010.js" as="script"><link rel="prefetch" href="/assets/04.1.html-cfa4092b.js" as="script"><link rel="prefetch" href="/assets/04.2.html-90a1e4d9.js" as="script"><link rel="prefetch" href="/assets/04.3.html-9d2b22de.js" as="script"><link rel="prefetch" href="/assets/04.4.html-c6a585b7.js" as="script"><link rel="prefetch" href="/assets/04.5.html-253bd73c.js" as="script"><link rel="prefetch" href="/assets/05.1.html-0fb228dc.js" as="script"><link rel="prefetch" href="/assets/05.2.html-16482434.js" as="script"><link rel="prefetch" href="/assets/05.3.html-f40104d1.js" as="script"><link rel="prefetch" href="/assets/06.1.html-f2eb1151.js" as="script"><link rel="prefetch" href="/assets/06.2.html-940a8d2a.js" as="script"><link rel="prefetch" href="/assets/07.1.html-22097ba8.js" as="script"><link rel="prefetch" href="/assets/07.2.html-342ce6cb.js" as="script"><link rel="prefetch" href="/assets/07.3.html-7f0146d2.js" as="script"><link rel="prefetch" href="/assets/08.1.html-791e8a5f.js" as="script"><link rel="prefetch" href="/assets/08.2.html-ddf3c79f.js" as="script"><link rel="prefetch" href="/assets/08.3.html-8ffac733.js" as="script"><link rel="prefetch" href="/assets/08.4.html-c0a0bb23.js" as="script"><link rel="prefetch" href="/assets/09.1.html-05a6a2f4.js" as="script"><link rel="prefetch" href="/assets/09.2.html-6a03521c.js" as="script"><link rel="prefetch" href="/assets/10.1.html-b99e0558.js" as="script"><link rel="prefetch" href="/assets/10.2.html-97bae334.js" as="script"><link rel="prefetch" href="/assets/11.1.html-acb84c13.js" as="script"><link rel="prefetch" href="/assets/11.2.html-7e9de362.js" as="script"><link rel="prefetch" href="/assets/11.3.html-30b1b46b.js" as="script"><link rel="prefetch" href="/assets/12.1.html-92c09557.js" as="script"><link rel="prefetch" href="/assets/12.2.html-bd48e538.js" as="script"><link rel="prefetch" href="/assets/12.3.html-ee879799.js" as="script"><link rel="prefetch" href="/assets/12.4.html-abc82400.js" as="script"><link rel="prefetch" href="/assets/13.1.html-235c4a01.js" as="script"><link rel="prefetch" href="/assets/13.2.html-dc61b081.js" as="script"><link rel="prefetch" href="/assets/13.3.html-906d15b6.js" as="script"><link rel="prefetch" href="/assets/14.1.html-d62a4925.js" as="script"><link rel="prefetch" href="/assets/14.2.html-7253d5d3.js" as="script"><link rel="prefetch" href="/assets/14.3.html-f4680e1a.js" as="script"><link rel="prefetch" href="/assets/14.4.html-e1d6fb2b.js" as="script"><link rel="prefetch" href="/assets/14.5.html-65a8dd09.js" as="script"><link rel="prefetch" href="/assets/15.1.html-a86c4e21.js" as="script"><link rel="prefetch" href="/assets/15.2.html-c7918af4.js" as="script"><link rel="prefetch" href="/assets/15.3.html-d9f90bdb.js" as="script"><link rel="prefetch" href="/assets/15.4.html-a08405c9.js" as="script"><link rel="prefetch" href="/assets/03.0.chpater_summary.html-5d468483.js" as="script"><link rel="prefetch" href="/assets/03.1.array.html-9fa44c07.js" as="script"><link rel="prefetch" href="/assets/03.2.slice.html-471d5c73.js" as="script"><link rel="prefetch" href="/assets/03.3.hashmap.html-ea996a11.js" as="script"><link rel="prefetch" href="/assets/03.4.string.html-ff3d63eb.js" as="script"><link rel="prefetch" href="/assets/04.0.chapter_summary.html-857e172f.js" as="script"><link rel="prefetch" href="/assets/04.1.function.html-b5e36dec.js" as="script"><link rel="prefetch" href="/assets/04.2.interface.html-b000824b.js" as="script"><link rel="prefetch" href="/assets/04.3.reflect.html-432aae4f.js" as="script"><link rel="prefetch" href="/assets/05.0.chapter_summary.html-28474f75.js" as="script"><link rel="prefetch" href="/assets/05.1.for_range.html-fdcadfe1.js" as="script"><link rel="prefetch" href="/assets/05.2.select.html-c487d485.js" as="script"><link rel="prefetch" href="/assets/05.3.defer.html-d6cf3596.js" as="script"><link rel="prefetch" href="/assets/05.4.panic_recover.html-ca68d3c2.js" as="script"><link rel="prefetch" href="/assets/05.5.make_new.html-58238f02.js" as="script"><link rel="prefetch" href="/assets/06.1.context.html-49cee893.js" as="script"><link rel="prefetch" href="/assets/06.2.sync-primitives.html-92f03071.js" as="script"><link rel="prefetch" href="/assets/06.3.timer.html-af8ff677.js" as="script"><link rel="prefetch" href="/assets/06.4.channel.html-678bf124.js" as="script"><link rel="prefetch" href="/assets/06.5.goroutine.html-3d32ecb5.js" as="script"><link rel="prefetch" href="/assets/06.6.netpoll.html-470e5366.js" as="script"><link rel="prefetch" href="/assets/06.7.sysmon.html-3ca94187.js" as="script"><link rel="prefetch" href="/assets/07.1.malloc.html-1dfdc96f.js" as="script"><link rel="prefetch" href="/assets/07.2.gc.html-cbf655bf.js" as="script"><link rel="prefetch" href="/assets/07.3.stackmem.html-a66199cb.js" as="script"><link rel="prefetch" href="/assets/404.html-10f4a139.js" as="script"><link rel="prefetch" href="/assets/index.html-d6937741.js" as="script"><link rel="prefetch" href="/assets/index.html-ebfe8e70.js" as="script"><link rel="prefetch" href="/assets/index.html-efb90239.js" as="script"><link rel="prefetch" href="/assets/index.html-61e05bcf.js" as="script"><link rel="prefetch" href="/assets/index.html-df896830.js" as="script"><link rel="prefetch" href="/assets/index.html-0d398a00.js" as="script"><link rel="prefetch" href="/assets/index.html-150f8c2d.js" as="script"><link rel="prefetch" href="/assets/index.html-01e24b31.js" as="script"><link rel="prefetch" href="/assets/index.html-7874e186.js" as="script"><link rel="prefetch" href="/assets/index.html-7dbe4dab.js" as="script"><link rel="prefetch" href="/assets/index.html-a10012d1.js" as="script"><link rel="prefetch" href="/assets/index.html-8440f8a1.js" as="script"><link rel="prefetch" href="/assets/index.html-4fc6fb1c.js" as="script"><link rel="prefetch" href="/assets/index.html-a1072623.js" as="script"><link rel="prefetch" href="/assets/index.html-d3a3efdf.js" as="script"><link rel="prefetch" href="/assets/index.html-d260e5af.js" as="script"><link rel="prefetch" href="/assets/index.html-8859080c.js" as="script"><link rel="prefetch" href="/assets/index.html-ba4355bd.js" as="script"><link rel="prefetch" href="/assets/index.html-f2cc22e2.js" as="script"><link rel="prefetch" href="/assets/index.html-c782a6b5.js" as="script"><link rel="prefetch" href="/assets/index.html-6c7df616.js" as="script"><link rel="prefetch" href="/assets/index.html-adfac578.js" as="script"><link rel="prefetch" href="/assets/index.html-7b181c19.js" as="script"><link rel="prefetch" href="/assets/index.html-716edfc6.js" as="script"><link rel="prefetch" href="/assets/index.html-92dac647.js" as="script"><link rel="prefetch" href="/assets/index.html-58a5246d.js" as="script"><link rel="prefetch" href="/assets/index.html-e591585a.js" as="script"><link rel="prefetch" href="/assets/index.html-690395a7.js" as="script"><link rel="prefetch" href="/assets/index.html-148290d2.js" as="script"><link rel="prefetch" href="/assets/index.html-b2a552df.js" as="script"><link rel="prefetch" href="/assets/index.html-180c02b5.js" as="script"><link rel="prefetch" href="/assets/index.html-eb73610b.js" as="script"><link rel="prefetch" href="/assets/index.html-201cdec3.js" as="script"><link rel="prefetch" href="/assets/index.html-17abad86.js" as="script"><link rel="prefetch" href="/assets/index.html-b382abd5.js" as="script"><link rel="prefetch" href="/assets/index.html-b5b645d5.js" as="script"><link rel="prefetch" href="/assets/index.html-42bb9ee1.js" as="script"><link rel="prefetch" href="/assets/index.html-babb7218.js" as="script"><link rel="prefetch" href="/assets/index.html-f77d2271.js" as="script"><link rel="prefetch" href="/assets/index.html-822f2c8b.js" as="script"><link rel="prefetch" href="/assets/index.html-9b06df38.js" as="script"><link rel="prefetch" href="/assets/index.html-28b3b02b.js" as="script"><link rel="prefetch" href="/assets/index.html-ff8f4c2a.js" as="script"><link rel="prefetch" href="/assets/index.html-1cc8c50e.js" as="script"><link rel="prefetch" href="/assets/index.html-53c6814a.js" as="script"><link rel="prefetch" href="/assets/index.html-0a79e318.js" as="script"><link rel="prefetch" href="/assets/index.html-5c58f6fd.js" as="script"><link rel="prefetch" href="/assets/index.html-e2403d8c.js" as="script"><link rel="prefetch" href="/assets/index.html-14dcbfd4.js" as="script"><link rel="prefetch" href="/assets/index.html-a50991ec.js" as="script"><link rel="prefetch" href="/assets/index.html-b25edad3.js" as="script"><link rel="prefetch" href="/assets/index.html-086a2e52.js" as="script"><link rel="prefetch" href="/assets/index.html-f674e8d8.js" as="script"><link rel="prefetch" href="/assets/index.html-5fe3e1ae.js" as="script"><link rel="prefetch" href="/assets/index.html-673d3451.js" as="script"><link rel="prefetch" href="/assets/index.html-a1e27919.js" as="script"><link rel="prefetch" href="/assets/index.html-009b4048.js" as="script"><link rel="prefetch" href="/assets/index.html-fefcf9c5.js" as="script"><link rel="prefetch" href="/assets/index.html-63eaf2f8.js" as="script"><link rel="prefetch" href="/assets/index.html-d3bbdafa.js" as="script"><link rel="prefetch" href="/assets/index.html-d1fd1ea1.js" as="script"><link rel="prefetch" href="/assets/index.html-61daae31.js" as="script"><link rel="prefetch" href="/assets/index.html-826a3e06.js" as="script"><link rel="prefetch" href="/assets/index.html-369d0545.js" as="script"><link rel="prefetch" href="/assets/index.html-c19c356c.js" as="script"><link rel="prefetch" href="/assets/index.html-385c3dc5.js" as="script"><link rel="prefetch" href="/assets/index.html-7840353b.js" as="script"><link rel="prefetch" href="/assets/index.html-514ef6a1.js" as="script"><link rel="prefetch" href="/assets/index.html-b45cdc47.js" as="script"><link rel="prefetch" href="/assets/index.html-fca33bdc.js" as="script"><link rel="prefetch" href="/assets/index.html-04b237ce.js" as="script"><link rel="prefetch" href="/assets/index.html-c9f92809.js" as="script"><link rel="prefetch" href="/assets/index.html-e8165cd6.js" as="script"><link rel="prefetch" href="/assets/index.html-214e0d09.js" as="script"><link rel="prefetch" href="/assets/index.html-b3ceaa7a.js" as="script"><link rel="prefetch" href="/assets/index.html-ef7d4ba8.js" as="script"><link rel="prefetch" href="/assets/index.html-2962ed11.js" as="script"><link rel="prefetch" href="/assets/index.html-2f326f1c.js" as="script"><link rel="prefetch" href="/assets/index.html-8fa190d3.js" as="script"><link rel="prefetch" href="/assets/index.html-f0c66776.js" as="script"><link rel="prefetch" href="/assets/index.html-a3ca6d17.js" as="script"><link rel="prefetch" href="/assets/index.html-83a2d44f.js" as="script"><link rel="prefetch" href="/assets/index.html-d03e73dc.js" as="script"><link rel="prefetch" href="/assets/index.html-660aa900.js" as="script"><link rel="prefetch" href="/assets/index.html-398602d0.js" as="script"><link rel="prefetch" href="/assets/index.html-b5233759.js" as="script"><link rel="prefetch" href="/assets/index.html-36ee407e.js" as="script"><link rel="prefetch" href="/assets/index.html-f1a54535.js" as="script"><link rel="prefetch" href="/assets/index.html-35d82bad.js" as="script"><link rel="prefetch" href="/assets/index.html-3e04a77c.js" as="script"><link rel="prefetch" href="/assets/index.html-39d23519.js" as="script"><link rel="prefetch" href="/assets/index.html-e3778a99.js" as="script"><link rel="prefetch" href="/assets/index.html-6e8005af.js" as="script"><link rel="prefetch" href="/assets/index.html-c0a75dd0.js" as="script"><link rel="prefetch" href="/assets/index.html-e3d56194.js" as="script"><link rel="prefetch" href="/assets/index.html-9fcabed2.js" as="script"><link rel="prefetch" href="/assets/index.html-26bb011b.js" as="script"><link rel="prefetch" href="/assets/index.html-4b8a3122.js" as="script"><link rel="prefetch" href="/assets/index.html-b9f7c866.js" as="script"><link rel="prefetch" href="/assets/index.html-7d33699e.js" as="script"><link rel="prefetch" href="/assets/index.html-50b24d64.js" as="script"><link rel="prefetch" href="/assets/index.html-2e8950dd.js" as="script"><link rel="prefetch" href="/assets/index.html-1ab6bdea.js" as="script"><link rel="prefetch" href="/assets/index.html-8a051e99.js" as="script"><link rel="prefetch" href="/assets/index.html-6d73b358.js" as="script"><link rel="prefetch" href="/assets/index.html-503f321b.js" as="script"><link rel="prefetch" href="/assets/index.html-a7603dbd.js" as="script"><link rel="prefetch" href="/assets/index.html-f63dd37b.js" as="script"><link rel="prefetch" href="/assets/index.html-32170fec.js" as="script"><link rel="prefetch" href="/assets/index.html-2516d590.js" as="script"><link rel="prefetch" href="/assets/index.html-c9b20e72.js" as="script"><link rel="prefetch" href="/assets/index.html-f1f795b2.js" as="script"><link rel="prefetch" href="/assets/index.html-55d522d7.js" as="script"><link rel="prefetch" href="/assets/index.html-494289e3.js" as="script"><link rel="prefetch" href="/assets/index.html-d1ed5875.js" as="script"><link rel="prefetch" href="/assets/index.html-a600609c.js" as="script"><link rel="prefetch" href="/assets/index.html-1c58863c.js" as="script"><link rel="prefetch" href="/assets/index.html-9bb4bd1d.js" as="script"><link rel="prefetch" href="/assets/index.html-9d1bb97b.js" as="script"><link rel="prefetch" href="/assets/index.html-38d6f8df.js" as="script"><link rel="prefetch" href="/assets/index.html-1f622183.js" as="script"><link rel="prefetch" href="/assets/index.html-d8804b82.js" as="script"><link rel="prefetch" href="/assets/index.html-194b3819.js" as="script"><link rel="prefetch" href="/assets/index.html-c4bd34d3.js" as="script"><link rel="prefetch" href="/assets/index.html-9b9b4030.js" as="script"><link rel="prefetch" href="/assets/index.html-5f161396.js" as="script"><link rel="prefetch" href="/assets/index.html-e07cf623.js" as="script"><link rel="prefetch" href="/assets/index.html-24d0dabe.js" as="script"><link rel="prefetch" href="/assets/index.html-ed4e6830.js" as="script"><link rel="prefetch" href="/assets/index.html-0e95b3e8.js" as="script"><link rel="prefetch" href="/assets/index.html-8f1ead98.js" as="script"><link rel="prefetch" href="/assets/index.html-faa8f741.js" as="script"><link rel="prefetch" href="/assets/index.html-17d7fc72.js" as="script"><link rel="prefetch" href="/assets/index.html-845477e2.js" as="script"><link rel="prefetch" href="/assets/index.html-76e73153.js" as="script"><link rel="prefetch" href="/assets/index.html-a55fdefa.js" as="script"><link rel="prefetch" href="/assets/index.html-fe96d66a.js" as="script"><link rel="prefetch" href="/assets/index.html-761b58d9.js" as="script"><link rel="prefetch" href="/assets/index.html-1a6dac8e.js" as="script"><link rel="prefetch" href="/assets/plyr.min-65d8b78a.js" as="script"><link rel="prefetch" href="/assets/plyr.min-65d8b78a.js" as="script"><link rel="prefetch" href="/assets/waline-meta-56fbc549.js" as="script"><link rel="prefetch" href="/assets/component-8a028776.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/assets/flowchart-8b576787.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-457a87fa.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ab04f0b1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-731b728e.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-36cd6c3c.js" as="script"><link rel="prefetch" href="/assets/pageview-d5e1619c.js" as="script"><link rel="prefetch" href="/assets/style-e9220a04.js" as="script"><link rel="prefetch" href="/assets/docsearch-1d421ddb.js" as="script"><link rel="prefetch" href="/assets/index-b98b895d.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/assets/images/hero.jpg" alt="今朝のブログ"><!----><span class="site-name hide-in-pad">今朝のブログ</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/note/" class="nav-link active" aria-label="Notes"><span class="font-icon icon iconfont icon-article" style=""></span>Notes<!----></a></div><div class="nav-item hide-in-mobile"><a href="/blog/" class="nav-link" aria-label="Blog"><span class="font-icon icon iconfont icon-blog" style=""></span>Blog<!----></a></div><div class="nav-item hide-in-mobile"><a href="/leetcode/" class="nav-link" aria-label="Leet Code"><span class="font-icon icon iconfont icon-code" style=""></span>Leet Code<!----></a></div><div class="nav-item hide-in-mobile"><a href="/reading/" class="nav-link" aria-label="Reading Notes"><span class="font-icon icon iconfont icon-file" style=""></span>Reading Notes<!----></a></div><div class="nav-item hide-in-mobile"><a href="/lang/" class="nav-link" aria-label="Language Notes"><span class="font-icon icon iconfont icon-language" style=""></span>Language Notes<!----></a></div><div class="nav-item hide-in-mobile"><a href="/todo/" class="nav-link" aria-label="To Do"><span class="font-icon icon iconfont icon-enum" style=""></span>To Do<!----></a></div><div class="nav-item hide-in-mobile"><a href="/games/ebiten_breakout.html" class="nav-link" aria-label="Games"><span class="font-icon icon iconfont icon-computer" style=""></span>Games<!----></a></div><div class="nav-item hide-in-mobile"><a href="/gallery/" class="nav-link" aria-label="Gallery"><span class="font-icon icon iconfont icon-pic" style=""></span>Gallery<!----></a></div><div class="nav-item hide-in-mobile"><a href="/about-me.html" class="nav-link" aria-label="About"><span class="font-icon icon iconfont icon-info" style=""></span>About<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/dreamjz" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--[--><div id="docsearch-container" style="display:none;"></div><div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"><svg width="15" height="15" class="DocSearch-Control-Key-Icon"><path d="M4.505 4.496h2M5.505 5.496v5M8.216 4.496l.055 5.993M10 7.5c.333.333.5.667.5 1v2M12.326 4.5v5.996M8.384 4.496c1.674 0 2.116 0 2.116 1.5s-.442 1.5-2.116 1.5M3.205 9.303c-.09.448-.277 1.21-1.241 1.203C1 10.5.5 9.513.5 8V7c0-1.57.5-2.5 1.464-2.494.964.006 1.134.598 1.24 1.342M12.553 10.5h1.953" stroke-width="1.2" stroke="currentColor" fill="none" stroke-linecap="square"></path></svg></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/note/" class="nav-link sidebar-link sidebar-page" aria-label="Index"><!---->Index<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">C Sharp</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Docker</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Golang</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Interview</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Javascript</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Linux</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Nginx</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Python</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Rpc</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">Rust</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a aria-current="page" href="/note/rust/quick_start.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Quick Start"><!---->Quick Start<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#types-and-values" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Types and Values"><!---->Types and Values<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#variables" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Variables"><!---->Variables<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#values" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Values"><!---->Values<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#arithmetic" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Arithmetic"><!---->Arithmetic<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#strings" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Strings"><!---->Strings<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#type-inference" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Type Inference"><!---->Type Inference<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#control-flow" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Control Flow"><!---->Control Flow<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#if" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="if"><!---->if<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#loops" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Loops"><!---->Loops<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#blocks-and-scopes" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Blocks and Scopes"><!---->Blocks and Scopes<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#functions" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Functions"><!---->Functions<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#macros" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Macros"><!---->Macros<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#tuples-and-arrays" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Tuples and Arrays"><!---->Tuples and Arrays<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#array-iteration" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Array Iteration"><!---->Array Iteration<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#pattern-matching" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Pattern Matching"><!---->Pattern Matching<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#destructing" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Destructing"><!---->Destructing<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#references" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="References"><!---->References<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#shared-references" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Shared References"><!---->Shared References<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#exclusive-references" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Exclusive References"><!---->Exclusive References<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#user-defined-types" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="User Defined Types"><!---->User Defined Types<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#tuple-structs" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Tuple Structs"><!---->Tuple Structs<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#enums" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Enums"><!---->Enums<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#static-and-const" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Static and Const"><!---->Static and Const<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#type-aliases" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Type Aliases"><!---->Type Aliases<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#pattern-matching-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Pattern Matching"><!---->Pattern Matching<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#let-control-flow" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Let Control Flow"><!---->Let Control Flow<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#let-if-expression" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="let if expression"><!---->let if expression<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#methods-and-traits" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Methods and Traits"><!---->Methods and Traits<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#methods" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Methods"><!---->Methods<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#traits" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Traits"><!---->Traits<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#deriving" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Deriving"><!---->Deriving<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#trait-objects" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Trait Objects"><!---->Trait Objects<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#generics" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Generics"><!---->Generics<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#generic-functions" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Generic functions"><!---->Generic functions<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#generic-data-types" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Generic Data Types"><!---->Generic Data Types<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#trait-bounds" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Trait Bounds"><!---->Trait Bounds<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#impl-trait" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="impl Trait"><!---->impl Trait<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#standard-library-types" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Standard Library Types"><!---->Standard Library Types<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#documentation" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Documentation"><!---->Documentation<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#option" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Option"><!---->Option<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#result" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Result"><!---->Result<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#string" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="String"><!---->String<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#vec" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Vec"><!---->Vec<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#hashmap" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="HashMap"><!---->HashMap<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#memory-management" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Memory Management"><!---->Memory Management<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#program-memory" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Program Memory"><!---->Program Memory<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#approaches-to-memory-management" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Approaches to Memory Management"><!---->Approaches to Memory Management<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#ownership" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Ownership"><!---->Ownership<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#move-semantics" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Move Semantics"><!---->Move Semantics<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#clone" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Clone"><!---->Clone<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#copy-types" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Copy Types"><!---->Copy Types<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#the-drop-trait" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="The Drop Trait"><!---->The Drop Trait<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#smart-pointers" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Smart Pointers"><!---->Smart Pointers<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#box" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Box"><!---->Box<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#rc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Rc"><!---->Rc<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#borrowing-value" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Borrowing Value"><!---->Borrowing Value<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#borrow-checking" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Borrow Checking"><!---->Borrow Checking<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#interior-mutability" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Interior Mutability"><!---->Interior Mutability<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#slices" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Slices"><!---->Slices<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#string-reference" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="String Reference"><!---->String Reference<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#lifetime-annotations" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Lifetime Annotations"><!---->Lifetime Annotations<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#lifetimes-in-function-calls" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Lifetimes in Function Calls"><!---->Lifetimes in Function Calls<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#lifetimes-in-data-structures" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Lifetimes in Data Structures"><!---->Lifetimes in Data Structures<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#iterators" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Iterators"><!---->Iterators<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#iterator" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Iterator"><!---->Iterator<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#intoiterator" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="IntoIterator"><!---->IntoIterator<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#fromiterator" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="FromIterator"><!---->FromIterator<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#modules" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Modules"><!---->Modules<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#filesystem-hierarchy" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Filesystem Hierarchy"><!---->Filesystem Hierarchy<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#visibility" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Visibility"><!---->Visibility<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#use-super-self" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="use, super, self"><!---->use, super, self<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#paths" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Paths"><!---->Paths<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#tests" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Tests"><!---->Tests<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#unit-test" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Unit Test"><!---->Unit Test<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#integration-tests" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Integration Tests"><!---->Integration Tests<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#documentation-tests" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Documentation Tests"><!---->Documentation Tests<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#mock" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mock"><!---->Mock<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#error-handling" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Error Handling"><!---->Error Handling<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#try-operator" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Try Operator"><!---->Try Operator<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#try-conversions" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Try Conversions"><!---->Try Conversions<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#dynamic-error-types" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Dynamic Error Types"><!---->Dynamic Error Types<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#thiserror-and-anyhow" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="thiserror and anyhow"><!---->thiserror and anyhow<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#concurrency" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Concurrency"><!---->Concurrency<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#scoped-threads" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Scoped Threads"><!---->Scoped Threads<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#channels" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Channels"><!---->Channels<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#unbounded-channels" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Unbounded Channels"><!---->Unbounded Channels<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#bounded-channels" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Bounded Channels"><!---->Bounded Channels<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#send-and-sync" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Send and Sync"><!---->Send and Sync<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#shared-state" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Shared State"><!---->Shared State<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#arc" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Arc"><!---->Arc<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#mutex" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Mutex"><!---->Mutex<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#async" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Async"><!---->Async<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#futures" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Futures"><!---->Futures<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#runtimes" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Runtimes"><!---->Runtimes<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#tasks" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Tasks"><!---->Tasks<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#async-channels" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Async Channels"><!---->Async Channels<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#futures-control-flow" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Futures Control Flow"><!---->Futures Control Flow<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#pitfalls-of-async-await" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Pitfalls of async/await"><!---->Pitfalls of async/await<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#blocking-the-executor" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Blocking the executor"><!---->Blocking the executor<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#pin" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Pin"><!---->Pin<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#async-traits" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Async Traits"><!---->Async Traits<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#cancellation" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Cancellation"><!---->Cancellation<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/note/rust/quick_start.html#reference" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Reference"><!---->Reference<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Typescript</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Vue</span><span class="arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Quick Start</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">Kesa</span></span><span property="author" content="Kesa"></span></span><!----><!----><span class="page-pageview-info" aria-label="访问量🔢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span class="waline-pageview-count" id="ArtalkPV" data-path="/note/rust/quick_start.html">...</span></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 48 分钟</span><meta property="timeRequired" content="PT48M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#types-and-values" class="router-link-active router-link-exact-active toc-link level2">Types and Values</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#variables" class="router-link-active router-link-exact-active toc-link level3">Variables</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#values" class="router-link-active router-link-exact-active toc-link level3">Values</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#arithmetic" class="router-link-active router-link-exact-active toc-link level3">Arithmetic</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#strings" class="router-link-active router-link-exact-active toc-link level3">Strings</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#type-inference" class="router-link-active router-link-exact-active toc-link level3">Type Inference</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#control-flow" class="router-link-active router-link-exact-active toc-link level2">Control Flow</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#if" class="router-link-active router-link-exact-active toc-link level3">if</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#loops" class="router-link-active router-link-exact-active toc-link level3">Loops</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#blocks-and-scopes" class="router-link-active router-link-exact-active toc-link level3">Blocks and Scopes</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#functions" class="router-link-active router-link-exact-active toc-link level3">Functions</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#macros" class="router-link-active router-link-exact-active toc-link level3">Macros</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#tuples-and-arrays" class="router-link-active router-link-exact-active toc-link level2">Tuples and Arrays</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#array-iteration" class="router-link-active router-link-exact-active toc-link level3">Array Iteration</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#pattern-matching" class="router-link-active router-link-exact-active toc-link level3">Pattern Matching</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#destructing" class="router-link-active router-link-exact-active toc-link level3">Destructing</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#references" class="router-link-active router-link-exact-active toc-link level2">References</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#shared-references" class="router-link-active router-link-exact-active toc-link level3">Shared References</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#exclusive-references" class="router-link-active router-link-exact-active toc-link level3">Exclusive References</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#user-defined-types" class="router-link-active router-link-exact-active toc-link level2">User Defined Types</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#tuple-structs" class="router-link-active router-link-exact-active toc-link level3">Tuple Structs</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#enums" class="router-link-active router-link-exact-active toc-link level3">Enums</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#static-and-const" class="router-link-active router-link-exact-active toc-link level3">Static and Const</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#type-aliases" class="router-link-active router-link-exact-active toc-link level3">Type Aliases</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#pattern-matching-1" class="router-link-active router-link-exact-active toc-link level2">Pattern Matching</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#let-control-flow" class="router-link-active router-link-exact-active toc-link level3">Let Control Flow</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#let-if-expression" class="router-link-active router-link-exact-active toc-link level3">let if expression</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#methods-and-traits" class="router-link-active router-link-exact-active toc-link level2">Methods and Traits</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#methods" class="router-link-active router-link-exact-active toc-link level3">Methods</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#traits" class="router-link-active router-link-exact-active toc-link level3">Traits</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#deriving" class="router-link-active router-link-exact-active toc-link level3">Deriving</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#trait-objects" class="router-link-active router-link-exact-active toc-link level3">Trait Objects</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#generics" class="router-link-active router-link-exact-active toc-link level2">Generics</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#generic-functions" class="router-link-active router-link-exact-active toc-link level3">Generic functions</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#generic-data-types" class="router-link-active router-link-exact-active toc-link level3">Generic Data Types</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#trait-bounds" class="router-link-active router-link-exact-active toc-link level3">Trait Bounds</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#impl-trait" class="router-link-active router-link-exact-active toc-link level3">impl Trait</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#standard-library-types" class="router-link-active router-link-exact-active toc-link level2">Standard Library Types</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#documentation" class="router-link-active router-link-exact-active toc-link level3">Documentation</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#option" class="router-link-active router-link-exact-active toc-link level3">Option</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#result" class="router-link-active router-link-exact-active toc-link level3">Result</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#string" class="router-link-active router-link-exact-active toc-link level3">String</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#vec" class="router-link-active router-link-exact-active toc-link level3">Vec</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#hashmap" class="router-link-active router-link-exact-active toc-link level3">HashMap</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#memory-management" class="router-link-active router-link-exact-active toc-link level2">Memory Management</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#program-memory" class="router-link-active router-link-exact-active toc-link level3">Program Memory</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#approaches-to-memory-management" class="router-link-active router-link-exact-active toc-link level3">Approaches to Memory Management</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#ownership" class="router-link-active router-link-exact-active toc-link level3">Ownership</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#move-semantics" class="router-link-active router-link-exact-active toc-link level3">Move Semantics</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#clone" class="router-link-active router-link-exact-active toc-link level3">Clone</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#copy-types" class="router-link-active router-link-exact-active toc-link level3">Copy Types</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#the-drop-trait" class="router-link-active router-link-exact-active toc-link level3">The Drop Trait</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#smart-pointers" class="router-link-active router-link-exact-active toc-link level2">Smart Pointers</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#box" class="router-link-active router-link-exact-active toc-link level3">Box</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#rc" class="router-link-active router-link-exact-active toc-link level3">Rc</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#borrowing-value" class="router-link-active router-link-exact-active toc-link level2">Borrowing Value</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#borrow-checking" class="router-link-active router-link-exact-active toc-link level3">Borrow Checking</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#interior-mutability" class="router-link-active router-link-exact-active toc-link level3">Interior Mutability</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#slices" class="router-link-active router-link-exact-active toc-link level2">Slices</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#string-reference" class="router-link-active router-link-exact-active toc-link level3">String Reference</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#lifetime-annotations" class="router-link-active router-link-exact-active toc-link level3">Lifetime Annotations</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#lifetimes-in-function-calls" class="router-link-active router-link-exact-active toc-link level3">Lifetimes in Function Calls</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#lifetimes-in-data-structures" class="router-link-active router-link-exact-active toc-link level3">Lifetimes in Data Structures</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#iterators" class="router-link-active router-link-exact-active toc-link level2">Iterators</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#iterator" class="router-link-active router-link-exact-active toc-link level3">Iterator</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#intoiterator" class="router-link-active router-link-exact-active toc-link level3">IntoIterator</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#fromiterator" class="router-link-active router-link-exact-active toc-link level3">FromIterator</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#modules" class="router-link-active router-link-exact-active toc-link level2">Modules</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#filesystem-hierarchy" class="router-link-active router-link-exact-active toc-link level3">Filesystem Hierarchy</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#visibility" class="router-link-active router-link-exact-active toc-link level3">Visibility</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#use-super-self" class="router-link-active router-link-exact-active toc-link level3">use, super, self</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#paths" class="router-link-active router-link-exact-active toc-link level3">Paths</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#tests" class="router-link-active router-link-exact-active toc-link level2">Tests</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#unit-test" class="router-link-active router-link-exact-active toc-link level3">Unit Test</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#integration-tests" class="router-link-active router-link-exact-active toc-link level3">Integration Tests</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#documentation-tests" class="router-link-active router-link-exact-active toc-link level3">Documentation Tests</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#mock" class="router-link-active router-link-exact-active toc-link level3">Mock</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#error-handling" class="router-link-active router-link-exact-active toc-link level2">Error Handling</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#try-operator" class="router-link-active router-link-exact-active toc-link level3">Try Operator</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#try-conversions" class="router-link-active router-link-exact-active toc-link level3">Try Conversions</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#dynamic-error-types" class="router-link-active router-link-exact-active toc-link level3">Dynamic Error Types</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#thiserror-and-anyhow" class="router-link-active router-link-exact-active toc-link level3">thiserror and anyhow</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#concurrency" class="router-link-active router-link-exact-active toc-link level2">Concurrency</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#scoped-threads" class="router-link-active router-link-exact-active toc-link level3">Scoped Threads</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#channels" class="router-link-active router-link-exact-active toc-link level3">Channels</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#unbounded-channels" class="router-link-active router-link-exact-active toc-link level3">Unbounded Channels</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#bounded-channels" class="router-link-active router-link-exact-active toc-link level3">Bounded Channels</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#send-and-sync" class="router-link-active router-link-exact-active toc-link level3">Send and Sync</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#shared-state" class="router-link-active router-link-exact-active toc-link level2">Shared State</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#arc" class="router-link-active router-link-exact-active toc-link level3">Arc</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#mutex" class="router-link-active router-link-exact-active toc-link level3">Mutex</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#async" class="router-link-active router-link-exact-active toc-link level2">Async</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#futures" class="router-link-active router-link-exact-active toc-link level3">Futures</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#runtimes" class="router-link-active router-link-exact-active toc-link level3">Runtimes</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#tasks" class="router-link-active router-link-exact-active toc-link level3">Tasks</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#async-channels" class="router-link-active router-link-exact-active toc-link level3">Async Channels</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#futures-control-flow" class="router-link-active router-link-exact-active toc-link level3">Futures Control Flow</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#pitfalls-of-async-await" class="router-link-active router-link-exact-active toc-link level2">Pitfalls of async/await</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#blocking-the-executor" class="router-link-active router-link-exact-active toc-link level3">Blocking the executor</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#pin" class="router-link-active router-link-exact-active toc-link level3">Pin</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#async-traits" class="router-link-active router-link-exact-active toc-link level3">Async Traits</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#cancellation" class="router-link-active router-link-exact-active toc-link level3">Cancellation</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/note/rust/quick_start.html#reference" class="router-link-active router-link-exact-active toc-link level3">Reference</a></li><!----><!--]--></ul></li><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h2 id="types-and-values" tabindex="-1"><a class="header-anchor" href="#types-and-values" aria-hidden="true">#</a> Types and Values</h2><h3 id="variables" tabindex="-1"><a class="header-anchor" href="#variables" aria-hidden="true">#</a> Variables</h3><p>Variables are immutable by default. Use <code>mut</code> keyword to allow changes.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x<span class="token punctuation">:</span><span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// error[E0384]: cannot assign twice to immutable variable `x`</span>
    <span class="token comment">// x = 20;</span>
    <span class="token comment">// println!(&quot;x: {x}&quot;);</span>

    <span class="token comment">// use mut keyword to allow changes</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> y<span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;y: {y}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    y <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;y: {y}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="values" tabindex="-1"><a class="header-anchor" href="#values" aria-hidden="true">#</a> Values</h3><table><thead><tr><th></th><th>Types</th><th>Literals</th></tr></thead><tbody><tr><td>Signed integers</td><td><code>i8</code>, <code>i16</code>, <code>i32</code>, <code>i64</code>, <code>i128</code>, <code>isize</code></td><td><code>-10</code>, <code>0</code>, <code>1_000</code>, <code>123_i64</code></td></tr><tr><td>Unsigned integers</td><td><code>u8</code>, <code>u16</code>, <code>u32</code>, <code>u64</code>, <code>u128</code>, <code>usize</code></td><td><code>0</code>, <code>123</code>, <code>10_u16</code></td></tr><tr><td>Floating point numbers</td><td><code>f32</code>, <code>f64</code></td><td><code>3.14</code>, <code>-10.0e20</code>, <code>2_f32</code></td></tr><tr><td>Unicode scalar values</td><td><code>char</code></td><td><code>&#39;a&#39;</code>, <code>&#39;α&#39;</code>, <code>&#39;∞&#39;</code></td></tr><tr><td>Booleans</td><td><code>bool</code></td><td><code>true</code>, <code>false</code></td></tr></tbody></table><p>The types have width as follows:</p><ul><li><code>iN</code>,<code>uN</code>, and <code>fN</code> are <em>N</em> bits wide.</li><li><code>isize</code> and <code>usize</code> are the width of a pointer,</li><li><code>char</code> is 32 bits wide,</li><li><code>bool</code> is 8 bits wide.</li></ul><p>All underscores in numbers can be left out, they are for legibility only. So <code>1_000</code> can be written as <code>1000</code> (or <code>10_00</code>), and <code>123_i64</code> can be written as <code>123i64</code>.</p><h3 id="arithmetic" tabindex="-1"><a class="header-anchor" href="#arithmetic" aria-hidden="true">#</a> Arithmetic</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">interproduct</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> c<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">*</span> b <span class="token operator">+</span> b <span class="token operator">*</span> c <span class="token operator">+</span> c <span class="token operator">*</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;result: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">interproduct</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">248</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Change the <code>i32</code>’s to <code>i16</code> to see an integer overflow, which panics (checked) in a debug build and wraps in a release build. There are other options, such as overflowing, saturating, and carrying. These are accessed with method syntax, e.g., <code>(a * b).saturating_add(b * c).saturating_add(c * a)</code>.</p><p>In fact, the compiler will detect overflow of constant expressions, which is why the example requires a separate function.</p><h3 id="strings" tabindex="-1"><a class="header-anchor" href="#strings" aria-hidden="true">#</a> Strings</h3><p>Rust has two types to represent strings:</p><ul><li><code>String</code> - a modifiable, owned string</li><li><code>&amp;str</code> - a read-only string. String literals have this type.</li></ul><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> greeting<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;Greetings&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> planet<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;🪐&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> sentence <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sentence<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sentence<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sentence<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>planet<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;final sentence: {}&quot;</span><span class="token punctuation">,</span> sentence<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>sentence<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// println!(&quot;{:?}&quot;, &amp;sentence[12..13]);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="type-inference" tabindex="-1"><a class="header-anchor" href="#type-inference" aria-hidden="true">#</a> Type Inference</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">takes_u32</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;u32: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">takes_i8</span><span class="token punctuation">(</span>y<span class="token punctuation">:</span> <span class="token keyword">i8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;i8: {y}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token function">takes_u32</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">takes_i8</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// error[E0308]: mismatched types expected `u32`, found `i8`</span>
    <span class="token comment">// takes_u32(y);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>When nothing constrains the type of an integer literal, Rust defaults to <code>i32</code>. This sometimes appears as <code>{integer}</code> in error messages. Similarly, floating-point literals default to <code>f64</code>.</p><h2 id="control-flow" tabindex="-1"><a class="header-anchor" href="#control-flow" aria-hidden="true">#</a> Control Flow</h2><h3 id="if" tabindex="-1"><a class="header-anchor" href="#if" aria-hidden="true">#</a> if</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;small&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">100</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;biggish&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;huge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// use if as an expression</span>
    <span class="token keyword">let</span> size <span class="token operator">=</span> <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">20</span> <span class="token punctuation">{</span> <span class="token string">&quot;small&quot;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> <span class="token string">&quot;large&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;number size: {}&quot;</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In addition, you can use <code>if</code> as an expression. The last expression of each block becomes the value of the <code>if</code> expression.</p><p>Because <code>if</code> is an expression and must have a particular type, both of its branch blocks must have the same type. Show what happens if you add <code>;</code> after <code>&quot;small&quot;</code> in the second example.</p><p>When <code>if</code> is used in an expression, the expression must have a <code>;</code> to separate it from the next statement. Remove the <code>;</code> before <code>println!</code> to see the compiler error.</p><h3 id="loops" tabindex="-1"><a class="header-anchor" href="#loops" aria-hidden="true">#</a> Loops</h3><h4 id="while" tabindex="-1"><a class="header-anchor" href="#while" aria-hidden="true">#</a> while</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> x <span class="token operator">&gt;=</span> <span class="token number">10</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> x <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Final x: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="for" tabindex="-1"><a class="header-anchor" href="#for" aria-hidden="true">#</a> for</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="loop" tabindex="-1"><a class="header-anchor" href="#loop" aria-hidden="true">#</a> loop</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
        i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">100</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Use the label to break out of nested loops:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token lifetime-annotation symbol">&#39;outer</span><span class="token punctuation">:</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> i <span class="token operator">&lt;</span> x <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {x}, i: {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">&#39;outer</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="blocks-and-scopes" tabindex="-1"><a class="header-anchor" href="#blocks-and-scopes" aria-hidden="true">#</a> Blocks and Scopes</h3><h4 id="blocks" tabindex="-1"><a class="header-anchor" href="#blocks" aria-hidden="true">#</a> Blocks</h4><p>A block in Rust contains a sequence of expressions. Each block has a value and a type, which are those of the last expression of the block:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> z <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;y: {y}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        z <span class="token operator">-</span> y
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="scopes-and-shadowing" tabindex="-1"><a class="header-anchor" href="#scopes-and-shadowing" aria-hidden="true">#</a> Scopes and Shadowing</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;before: {a}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;inner scope: {a}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;shadowed in inner scope: {a}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;after: {a}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="functions" tabindex="-1"><a class="header-anchor" href="#functions" aria-hidden="true">#</a> Functions</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> b<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> b <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token function">gcd</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> a <span class="token operator">%</span> b<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        a
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;gcd: {}&quot;</span><span class="token punctuation">,</span> <span class="token function">gcd</span><span class="token punctuation">(</span><span class="token number">143</span><span class="token punctuation">,</span> <span class="token number">52</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Declaration parameters are followed by a type, then a return type</li><li>The last expression in a function body (or any block) becomes the return value. Simply omit the <code>;</code> at the end of the expression. The <code>return</code> keyword can be used for early return, but the “bare value” form is idiomatic at the end of a function (refactor <code>gcd</code> to use a <code>return</code>).</li><li>Overloading is not supported – each function has a single implementation. <ul><li>Always takes a fixed number of parameters. Default arguments are not supported. Macros can be used to support variadic functions.</li><li>Always takes a single set of parameter types. These types can be generic, which will be covered later.</li></ul></li></ul><h3 id="macros" tabindex="-1"><a class="header-anchor" href="#macros" aria-hidden="true">#</a> Macros</h3><p>Macros are expanded into Rust code during compilation, and can take a variable number of arguments. They are distinguished by a <code>!</code> at the end. The Rust standard library includes an assortment of useful macros:</p><ul><li><code>println!(format, ..)</code> prints a line to standard output</li><li><code>format!(format, ..)</code> works just like <code>println!</code> but returns the result as a string.</li><li><code>dbg!(expression)</code> logs the value of the expression and returns it.</li><li><code>todo!()</code> marks a bit of code as not-yet-implemented. If executed, it will panic.</li><li><code>unreachable!()</code> marks a bit of code as unreachable. If executed, it will panic.</li></ul><h2 id="tuples-and-arrays" tabindex="-1"><a class="header-anchor" href="#tuples-and-arrays" aria-hidden="true">#</a> Tuples and Arrays</h2><table><thead><tr><th></th><th>Types</th><th>Literals</th></tr></thead><tbody><tr><td>Arrays</td><td><code>[T; N]</code></td><td><code>[20, 30, 40]</code>, <code>[0; 3]</code></td></tr><tr><td>Tuples</td><td><code>()</code>, <code>(T,)</code>, <code>(T1, T2)</code>, …</td><td><code>()</code>, <code>(&#39;x&#39;,)</code>, <code>(&#39;x&#39;, 1.2)</code>, …</td></tr></tbody></table><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// array assignment and access</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i8</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">;</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    a<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;a: {a:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;a: {a:#?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// tuple assignment and access</span>
    <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i8</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;t.0: {}&quot;</span><span class="token punctuation">,</span> t<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;t.1: {}&quot;</span><span class="token punctuation">,</span> t<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Arrays: <ul><li>A value of the array type <code>[T; N]</code> holds <code>N</code> (a compile-time constant) elements of the same type <code>T</code>. Note that the length of the array is <em>part of its type</em>, which means that <code>[u8; 3]</code> and <code>[u8; 4]</code> are considered two different types.</li><li>Try accessing an out-of-bounds array element. Array accesses are checked at runtime. Rust can usually optimize these checks away, and they can be avoided using unsafe Rust.</li><li>We can use literals to assign values to arrays.</li><li>The <code>println!</code> macro asks for the debug implementation with the <code>?</code> format parameter: <code>{}</code> gives the default output, <code>{:?}</code> gives the debug output. Types such as integers and strings implement the default output, but <strong>arrays</strong> only implement the <strong>debug</strong> output. This means that we must use debug output here.</li><li>Adding <code>#</code>, eg <code>{a:#?}</code>, invokes a “pretty printing” format, which can be easier to read.</li></ul></li><li>Tuples: <ul><li>Have a fixed length.</li><li>Tuples group together values of different types into a compound type.</li><li>Fields of a tuple can be accessed by the period and the index of the value, e.g. <code>t.0</code>, <code>t.1</code>.</li><li>The empty tuple <code>()</code> is also known as the “unit type”. It is both a type, and the only valid value of that type — that is to say both the type and its value are expressed as <code>()</code>. It is used to indicate, for example, that a function or expression has no return value. You can think of it as <code>void</code> that can be familiar to you from other programming languages.</li></ul></li></ul><h3 id="array-iteration" tabindex="-1"><a class="header-anchor" href="#array-iteration" aria-hidden="true">#</a> Array Iteration</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> primes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> prime <span class="token keyword">in</span> primes <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">2</span><span class="token punctuation">..</span>prime <span class="token punctuation">{</span>
            <span class="token macro property">assert_ne!</span><span class="token punctuation">(</span>prime <span class="token operator">%</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>assert_ne!</code> macro is new here. There are also <code>assert_eq!</code> and <code>assert!</code> macros. These are always checked while, debug-only variants like <code>debug_assert!</code> compile to nothing in release builds.</p><h3 id="pattern-matching" tabindex="-1"><a class="header-anchor" href="#pattern-matching" aria-hidden="true">#</a> Pattern Matching</h3><p>The <code>match</code> keyword lets you match a value against one or more <em>patterns</em>. The comparisons are done from top to bottom and the first match wins.</p><p>The patterns can be simple values, similarly to <code>switch</code> in C and C++:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token char">&#39;x&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> input <span class="token punctuation">{</span>
        <span class="token char">&#39;q&#39;</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Quitting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token char">&#39;a&#39;</span> <span class="token operator">|</span> <span class="token char">&#39;s&#39;</span> <span class="token operator">|</span> <span class="token char">&#39;w&#39;</span> <span class="token operator">|</span> <span class="token char">&#39;d&#39;</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Moving around&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token char">&#39;0&#39;</span><span class="token punctuation">..=</span><span class="token char">&#39;9&#39;</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Number input&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        key <span class="token keyword">if</span> key<span class="token punctuation">.</span><span class="token function">is_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Lowercase: {key}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Something else&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>_</code> pattern is a wildcard pattern which matches any value.</p><p>A variable in the pattern (<code>key</code> in this example) will create a binding that can be used within the match arm.</p><p>Some specific characters are being used when in a pattern</p><ul><li><code>|</code> as an <code>or</code></li><li><code>..</code> can expand as much as it needs to be</li><li><code>1..=5</code> represents an inclusive range</li><li><code>_</code> is a wild card</li></ul><h3 id="destructing" tabindex="-1"><a class="header-anchor" href="#destructing" aria-hidden="true">#</a> Destructing</h3><p>Destructuring is a way of extracting data from a data structure by writing a pattern that is matched up to the data structure, binding variables to subcomponents of the data structure.</p><p>You can destructure tuples and arrays by matching on their elements:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// tuple</span>
    <span class="token function">describe_point</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// array</span>
    <span class="token function">match_triple</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// destruct tuple</span>
<span class="token keyword">fn</span> <span class="token function-definition function">describe_point</span><span class="token punctuation">(</span>point<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> point <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;on Y axis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;on X axis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>x<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;left of Y axis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span>_<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">if</span> y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;below X axis&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;first quadrant&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// destruct array</span>
<span class="token keyword">fn</span> <span class="token function-definition function">match_triple</span><span class="token punctuation">(</span>triple<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Tell me about {triple:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> triple <span class="token punctuation">{</span>
        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;First is 0, y = {y}, and z = {z}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token punctuation">]</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;First is 1 and the rest were ignored&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;All elements were ignored&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="references" tabindex="-1"><a class="header-anchor" href="#references" aria-hidden="true">#</a> References</h2><h3 id="shared-references" tabindex="-1"><a class="header-anchor" href="#shared-references" aria-hidden="true">#</a> Shared References</h3><p>Shared references are read-only, and the referenced data cannot change.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token char">&#39;A&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token char">&#39;B&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> r<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">char</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;r: {}&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>

    r <span class="token operator">=</span> <span class="token operator">&amp;</span>b<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;r: {}&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A shared reference to a type <code>T</code> has type <code>&amp;T</code>. A reference value is made with the <code>&amp;</code> operator. The <code>*</code> operator “dereferences” a reference, yielding its value.</p><p>Rust will statically forbid dangling references:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">x_axis</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> point <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>point<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="exclusive-references" tabindex="-1"><a class="header-anchor" href="#exclusive-references" aria-hidden="true">#</a> Exclusive References</h3><p>Exclusive references, also known as mutable references, allow changing the value they refer to. They have type <code>&amp;mut T</code>.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> point <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> x_coord <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> point<span class="token number">.0</span><span class="token punctuation">;</span>

    <span class="token operator">*</span>x_coord <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Point: {point:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>“Exclusive” means that only this reference can be used to access the value. No other references (shared or exclusive) can exist at the same time, and the referenced value cannot be accessed while the exclusive reference exists.</p><h2 id="user-defined-types" tabindex="-1"><a class="header-anchor" href="#user-defined-types" aria-hidden="true">#</a> User Defined Types</h2><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">describe</span><span class="token punctuation">(</span>person<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} is {} years old&quot;</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>name<span class="token punctuation">,</span> person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> peter <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Peter&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token number">27</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>peter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    peter<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">28</span><span class="token punctuation">;</span>
    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>peter<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Avery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">39</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> avery <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> age <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>avery<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> jackie <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Jackie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">..</span>avery
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">describe</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>jackie<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Zero-sized structs (e.g. <code>struct Foo;</code>) might be used when implementing a trait on some type but don’t have any data that you want to store in the value itself.</li><li>The syntax <code>..avery</code> allows us to copy the majority of the fields from the old struct without having to explicitly type it all out. It must always be the last element.</li></ul><h3 id="tuple-structs" tabindex="-1"><a class="header-anchor" href="#tuple-structs" aria-hidden="true">#</a> Tuple Structs</h3><p>If the field name are unimportant, you can use a tuple struct:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}, {}&quot;</span><span class="token punctuation">,</span> p<span class="token number">.0</span><span class="token punctuation">,</span> p<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This is often used for single-field wrappers (called newtypes):</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">PoundsOfForce</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Newtons</span><span class="token punctuation">(</span><span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">compute_thruster_force</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">PoundsOfForce</span> <span class="token punctuation">{</span>
    <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token string">&quot;Ask a rocket scientist at NASA&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">set_thruster_force</span><span class="token punctuation">(</span>force<span class="token punctuation">:</span> <span class="token class-name">Newtons</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> force <span class="token operator">=</span> <span class="token function">compute_thruster_force</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">set_thruster_force</span><span class="token punctuation">(</span>force<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="enums" tabindex="-1"><a class="header-anchor" href="#enums" aria-hidden="true">#</a> Enums</h3><p>The <code>enum</code> keyword allows the creation of a type which has a few different variants:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">Direction</span> <span class="token punctuation">{</span>
    <span class="token class-name">Left</span><span class="token punctuation">,</span>
    <span class="token comment">// Right,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">PlayerMove</span> <span class="token punctuation">{</span>
    <span class="token comment">// Pass,        // Simple variant</span>
    <span class="token class-name">Run</span><span class="token punctuation">(</span><span class="token class-name">Direction</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// Tuple variant</span>
    <span class="token comment">// Teleport { x: u32, y: u32 }, // Struct variant</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> m<span class="token punctuation">:</span> <span class="token class-name">PlayerMove</span> <span class="token operator">=</span> <span class="token class-name">PlayerMove</span><span class="token punctuation">::</span><span class="token class-name">Run</span><span class="token punctuation">(</span><span class="token class-name">Direction</span><span class="token punctuation">::</span><span class="token class-name">Left</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;On this turn: {:?}&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Enumerations allow you to collect a set of values under one type.</p></li><li><p><code>Direction</code> is a type with variants. There are two values of <code>Direction</code>: <code>Direction::Left</code> and <code>Direction::Right</code>.</p></li><li><p><code>PlayerMove</code> is a type with three variants. In addition to the payloads, Rust will store a discriminant so that it knows at runtime which variant is in a <code>PlayerMove</code> value.</p></li><li><p>This might be a good time to compare structs and enums:</p><ul><li>In both, you can have a simple version without fields (unit struct) or one with different types of fields (variant payloads).</li><li>You could even implement the different variants of an enum with separate structs but then they wouldn’t be the same type as they would if they were all defined in an enum.</li></ul></li><li><p>Rust uses minimal space to store the discriminant.</p><ul><li><p>If necessary, it stores an integer of the smallest required size</p></li><li><p>If the allowed variant values do not cover all bit patterns, it will use invalid bit patterns to encode the discriminant (the “niche optimization”). For example, <code>Option&lt;&amp;u8&gt;</code> stores either a pointer to an integer or <code>NULL</code> for the <code>None</code> variant.</p></li><li><p>You can control the discriminant if needed (e.g., for compatibility with C):</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[repr(u32)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">Bar</span> <span class="token punctuation">{</span>
    <span class="token class-name">A</span><span class="token punctuation">,</span>  <span class="token comment">// 0</span>
    <span class="token class-name">B</span> <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token class-name">C</span><span class="token punctuation">,</span>  <span class="token comment">// 10001</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Bar</span><span class="token punctuation">::</span><span class="token class-name">A</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Bar</span><span class="token punctuation">::</span><span class="token class-name">B</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;C: {}&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Bar</span><span class="token punctuation">::</span><span class="token class-name">C</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Without <code>repr</code>, the discriminant type takes 2 bytes, because 10001 fits 2 bytes.</p></li></ul></li></ul><h3 id="static-and-const" tabindex="-1"><a class="header-anchor" href="#static-and-const" aria-hidden="true">#</a> Static and Const</h3><p>Static and constant variables are two different ways to create globally-scoped values that cannot be moved or reallocated during the execution of the program.</p><h4 id="const" tabindex="-1"><a class="header-anchor" href="#const" aria-hidden="true">#</a> const</h4><p>Constant variables are evaluated at compile time and their values are inlined wherever they are used:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">const</span> <span class="token constant">DIGEST_SIZE</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ZERO</span><span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">compute_digest</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">;</span> <span class="token constant">DIGEST_SIZE</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> digest <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">ZERO</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token constant">DIGEST_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span> <span class="token keyword">in</span> text<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        digest<span class="token punctuation">[</span>idx <span class="token operator">%</span> <span class="token constant">DIGEST_SIZE</span><span class="token punctuation">]</span> <span class="token operator">=</span> digest<span class="token punctuation">[</span>idx <span class="token operator">%</span> <span class="token constant">DIGEST_SIZE</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">wrapping_add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    digest
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> digest <span class="token operator">=</span> <span class="token function">compute_digest</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;digest: {digest:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Only functions marked <code>const</code> can be called at compile time to generate <code>const</code> values. <code>const</code> functions can however be called at runtime.</p><h4 id="static" tabindex="-1"><a class="header-anchor" href="#static" aria-hidden="true">#</a> static</h4><p>Static variables will live during the whole execution of the program, and therefore will not move:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">static</span> <span class="token constant">BANNER</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;Welcome to RustOS 3.14&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{BANNER}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>Property</th><th>Static</th><th>Constant</th></tr></thead><tbody><tr><td>Has an address in memory</td><td>Yes</td><td>No (inlined)</td></tr><tr><td>Lives for the entire duration of the program</td><td>Yes</td><td>No</td></tr><tr><td>Can be mutable</td><td>Yes (unsafe)</td><td>No</td></tr><tr><td>Evaluated at compile time</td><td>Yes (initialised at compile time)</td><td>Yes</td></tr><tr><td>Inlined wherever it is used</td><td>No</td><td>Yes</td></tr></tbody></table><h3 id="type-aliases" tabindex="-1"><a class="header-anchor" href="#type-aliases" aria-hidden="true">#</a> Type Aliases</h3><p>A type alias creates a name for another type. The two types can be used interchangeably.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">enum</span> <span class="token type-definition class-name">CarryableConcreteItem</span> <span class="token punctuation">{</span>
    <span class="token class-name">Left</span><span class="token punctuation">,</span>
    <span class="token class-name">Right</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token class-name">CarryableConcreteItem</span><span class="token punctuation">;</span>

<span class="token comment">// Aliases are more useful with long, complex types:</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">sync<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Arc</span><span class="token punctuation">,</span> <span class="token class-name">RwLock</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token namespace">cell<span class="token punctuation">::</span></span><span class="token class-name">RefCell</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token type-definition class-name">PlayerInventory</span> <span class="token operator">=</span> <span class="token class-name">RwLock</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Arc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">Item</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pattern-matching-1" tabindex="-1"><a class="header-anchor" href="#pattern-matching-1" aria-hidden="true">#</a> Pattern Matching</h2><h3 id="let-control-flow" tabindex="-1"><a class="header-anchor" href="#let-control-flow" aria-hidden="true">#</a> Let Control Flow</h3><p>Rust has a few control flow constructs which differ from other languages. They are used for pattern matching:</p><ul><li><code>if let</code> expressions</li><li><code>while let</code> expressions</li><li><code>match</code> expressions</li></ul><h3 id="let-if-expression" tabindex="-1"><a class="header-anchor" href="#let-if-expression" aria-hidden="true">#</a> let if expression</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">sleep_for</span><span class="token punctuation">(</span>secs<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> dur <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>dur<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">try_from_secs_f32</span><span class="token punctuation">(</span>secs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dur
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span>dur<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;slept for {:?}&quot;</span><span class="token punctuation">,</span> dur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">sleep_for</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep_for</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Unlike <code>match</code>, <code>if let</code> does not have to cover all branches. This can make it more concise than <code>match</code>.</li><li>A common usage is handling <code>Some</code> values when working with <code>Option</code>.</li><li>Unlike <code>match</code>, <code>if let</code> does not support guard clauses for pattern matching.</li></ul><h4 id="let-else-expression" tabindex="-1"><a class="header-anchor" href="#let-else-expression" aria-hidden="true">#</a> let else expression</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">hex_or_die_trying</span><span class="token punctuation">(</span>maybe_string<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span> maybe_string <span class="token punctuation">{</span>
        s
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;got None&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> first_byte_char <span class="token operator">=</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>first_byte_char<span class="token punctuation">)</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        first_byte_char
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;got empty string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span> <span class="token operator">=</span> first_byte_char<span class="token punctuation">.</span><span class="token function">to_digit</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;not a hex digit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;result: {:?}&quot;</span><span class="token punctuation">,</span> <span class="token function">hex_or_die_trying</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>if-let</code>s can pile up, as shown. The <code>let-else</code> construct supports flattening this nested code. Rewrite:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">hex_or_die_trying</span><span class="token punctuation">(</span>maybe_string<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=</span> maybe_string <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;got None&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>first_byte_char<span class="token punctuation">)</span> <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;got empty string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span> <span class="token operator">=</span> first_byte_char<span class="token punctuation">.</span><span class="token function">to_digit</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;not a hex digit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>digit<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="while-let-expression" tabindex="-1"><a class="header-anchor" href="#while-let-expression" aria-hidden="true">#</a> while let expression</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Comprehensive Rust 🦀&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;character: {c}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// (There are more efficient ways to reverse a string!)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Point out that the <code>while let</code> loop will keep going as long as the value matches the pattern.</li><li>You could rewrite the <code>while let</code> loop as an infinite loop with an if statement that breaks when there is no value to unwrap for <code>name.pop()</code>. The <code>while let</code> provides syntactic sugar for the above scenario.</li></ul><h2 id="methods-and-traits" tabindex="-1"><a class="header-anchor" href="#methods-and-traits" aria-hidden="true">#</a> Methods and Traits</h2><h3 id="methods" tabindex="-1"><a class="header-anchor" href="#methods" aria-hidden="true">#</a> Methods</h3><p>Rust allows you to associate functions with new types with an <code>impl</code> block:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Race</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    laps<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Race</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
            laps<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Exclusive borrowed read-write access to self</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">add_lap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> lap<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>laps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>lap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">print_laps</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Recorded {} laps for {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>laps<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>idx<span class="token punctuation">,</span> laps<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>laps<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Lap {idx}: {laps} sec&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">finish</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> total<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>laps<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Race {} is finished, total lap time: {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> race <span class="token operator">=</span> <span class="token class-name">Race</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">&quot;Monaco Grand Prix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    race<span class="token punctuation">.</span><span class="token function">add_lap</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    race<span class="token punctuation">.</span><span class="token function">add_lap</span><span class="token punctuation">(</span><span class="token number">68</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    race<span class="token punctuation">.</span><span class="token function">print_laps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    race<span class="token punctuation">.</span><span class="token function">add_lap</span><span class="token punctuation">(</span><span class="token number">71</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    race<span class="token punctuation">.</span><span class="token function">print_laps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// note: `Race::finish` takes ownership of the receiver `self`, which moves `race`</span>
    <span class="token comment">// race.add_lap(56);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>self</code> arguments specify the “receiver” - the object the method acts on. There are several common receivers for a method:</p><ul><li><code>&amp;self</code>: borrows the object from the caller using a shared and immutable reference. <strong>The object can be used again afterwards.</strong></li><li><code>&amp;mut self</code>: borrows the object from the caller using a unique and mutable reference. <strong>The object can be used again afterwards.</strong></li><li><code>self</code>: takes ownership of the object and moves it away from the caller. The method becomes the owner of the object. T<strong>he object will be dropped (deallocated) when the method returns</strong>, unless its ownership is explicitly transmitted. Complete ownership does not automatically mean mutability.</li><li><code>mut self</code>: same as above, but the method can mutate the object.</li><li>No receiver: this becomes a static method on the struct. Typically used to create constructors which are called <code>new</code> by convention.</li></ul><h3 id="traits" tabindex="-1"><a class="header-anchor" href="#traits" aria-hidden="true">#</a> Traits</h3><p>Rust lets you abstract over types with traits. They’re similar to <strong>interfaces</strong>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token keyword">i8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Cat</span> <span class="token punctuation">{</span>
    lives<span class="token punctuation">:</span> <span class="token keyword">i8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">trait</span> <span class="token type-definition class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;What&#39;s your name? {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Pet</span> <span class="token keyword">for</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;Woof, my name is {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Pet</span> <span class="token keyword">for</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;WTF?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span> lives<span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Fido&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    c<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    d<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>A trait defines a number of methods that types must have in order to implement the trait.</li><li>Traits are implemented in an <code>impl &lt;trait&gt; for &lt;type&gt; { .. }</code> block.</li><li>Traits may specify pre-implemented (provided) methods and methods that users are required to implement themselves. Provided methods can rely on required methods. In this case, <code>greet</code> is provided, and relies on <code>talk</code>.</li></ul><h3 id="deriving" tabindex="-1"><a class="header-anchor" href="#deriving" aria-hidden="true">#</a> Deriving</h3><p>Supported traits can be automatically implemented for your custom types, as follows:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug, Clone, Default)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Player</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    strength<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
    hit_points<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Player</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    p2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} vs. {:?}&quot;</span><span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Derivation is implemented with macros, and many crates provide useful derive macros to add useful functionality. For example, <code>serde</code> can derive serialization support for a struct using <code>#[derive(Serialize)]</code>.</p><h3 id="trait-objects" tabindex="-1"><a class="header-anchor" href="#trait-objects" aria-hidden="true">#</a> Trait Objects</h3><p>Trait objects allow for values of different types, for instance in a collection:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Dog</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token keyword">i8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Cat</span> <span class="token punctuation">{</span>
    lives<span class="token punctuation">:</span> <span class="token keyword">i8</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">trait</span> <span class="token type-definition class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Pet</span> <span class="token keyword">for</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;Woof, my name is {}!&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Pet</span> <span class="token keyword">for</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">talk</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;WTF!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> pets<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Pet</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
        <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> <span class="token punctuation">{</span> lives<span class="token punctuation">:</span> <span class="token number">9</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Dog</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Fido&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            age<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> pet <span class="token keyword">in</span> pets <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, who are you? {}&quot;</span><span class="token punctuation">,</span> pet<span class="token punctuation">.</span><span class="token function">talk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Memory layout after allocating <code>pets</code>:</p><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202312210553388.png" alt="image-20231221055323257" tabindex="0" loading="lazy"><figcaption>image-20231221055323257</figcaption></figure><ul><li>Types that implement a given trait may be of different sizes. This makes it impossible to have things like <code>Vec&lt;dyn Pet&gt;</code> in the example above.</li><li><code>dyn Pet</code> is a way to tell the compiler about a dynamically sized type that implements <code>Pet</code>.</li><li>In the example, <code>pets</code> is allocated on the stack and the vector data is on the heap. The two vector elements are <em>fat pointers</em>: <ul><li>A fat pointer is a double-width pointer. It has two components: a pointer to the actual object and a pointer to the <a href="https://en.wikipedia.org/wiki/Virtual_method_table" target="_blank" rel="noopener noreferrer">virtual method table<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (vtable) for the <code>Pet</code> implementation of that particular object.</li><li>The data for the <code>Dog</code> named Fido is the <code>name</code> and <code>age</code> fields. The <code>Cat</code> has a <code>lives</code> field.</li></ul></li></ul><p>Compare these outputs in the above example:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} {}&quot;</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Dog</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Cat</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} {}&quot;</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token class-name">Dog</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token class-name">Cat</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Pet</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Pet</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="generics" tabindex="-1"><a class="header-anchor" href="#generics" aria-hidden="true">#</a> Generics</h2><h3 id="generic-functions" tabindex="-1"><a class="header-anchor" href="#generic-functions" aria-hidden="true">#</a> Generic functions</h3><p>Rust supports generics, which lets you abstract algorithms or data structures (such as sorting or a binary tree) over the types used or stored.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">pick</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>n<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> even<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> odd<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> n <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        even
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        odd
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;picked a number: {:?}&quot;</span><span class="token punctuation">,</span> <span class="token function">pick</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;picked a tuple: {:?}&quot;</span><span class="token punctuation">,</span> <span class="token function">pick</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;dog&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;cat&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Rust infers a type for T based on the types of the arguments and return value.</li><li>This is similar to C++ templates, but Rust partially compiles the generic function immediately, so that function must be valid for all types matching the constraints. For example, try modifying <code>pick</code> to return <code>even + odd</code> if <code>n == 0</code>. Even if only the <code>pick</code> instantiation with integers is used, Rust still considers it invalid. C++ would let you do this.</li><li>Generic code is turned into non-generic code based on the call sites. This is a zero-cost abstraction: you get exactly the same result as if you had hand-coded the data structures without the abstraction.</li></ul><h3 id="generic-data-types" tabindex="-1"><a class="header-anchor" href="#generic-data-types" aria-hidden="true">#</a> Generic Data Types</h3><p>You can use generics to abstract over the concrete field type:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// impl&lt;T&gt; means methods are defined for any T</span>
<span class="token comment">// Point&lt;T&gt; means types in Point are defined for any T</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">coords</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> integer <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> float <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{integer:?} and {float:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;coords: {:?}&quot;</span><span class="token punctuation">,</span> integer<span class="token punctuation">.</span><span class="token function">coords</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Why <code>T</code> is specified twice in <code>impl&lt;T&gt; Point&lt;T&gt; {}</code>? Isn’t that redundant? <ul><li>This is because it is a generic implementation section for generic type. They are independently generic.</li><li>It means these methods are defined for any <code>T</code>.</li><li>It is possible to write <code>impl Point&lt;u32&gt; { .. }</code>. <ul><li><code>Point</code> is still generic and you can use <code>Point&lt;f64&gt;</code>, but methods in this block will only be available for <code>Point&lt;u32&gt;</code>.</li></ul></li></ul></li></ul><h3 id="trait-bounds" tabindex="-1"><a class="header-anchor" href="#trait-bounds" aria-hidden="true">#</a> Trait Bounds</h3><p>When working with generics, you often want to require the types to implement some trait, so that you can call this trait’s methods.</p><p>You can do this with <code>T: Trait</code> or <code>impl Trait</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">duplicate</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> pair <span class="token operator">=</span> <span class="token function">duplicate</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{pair:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="where-clause" tabindex="-1"><a class="header-anchor" href="#where-clause" aria-hidden="true">#</a> where clause</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">duplicate</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">)</span>
<span class="token keyword">where</span>
    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>It declutters the function signature if you have many parameters.</li><li>t has additional features making it more powerful. The extra feature is that the type on the left of “:” can be arbitrary, like <code>Option&lt;T&gt;</code>.</li></ul><h3 id="impl-trait" tabindex="-1"><a class="header-anchor" href="#impl-trait" aria-hidden="true">#</a> impl Trait</h3><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token comment">// Syntactic sugar for:</span>
<span class="token comment">//   fn add_42_millions&lt;T: Into&lt;i32&gt;&gt;(x: T) -&gt; i32 {</span>
<span class="token keyword">fn</span> <span class="token function-definition function">add_42_millions</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">impl</span> <span class="token class-name">Into</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">42_000_000</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">pair_of</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Debug</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> x <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> many <span class="token operator">=</span> <span class="token function">add_42_millions</span><span class="token punctuation">(</span><span class="token number">42_i8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{many}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> many_more <span class="token operator">=</span> <span class="token function">add_42_millions</span><span class="token punctuation">(</span><span class="token number">10_000_000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{many_more}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> debuggable <span class="token operator">=</span> <span class="token function">pair_of</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;debuggable: {debuggable:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>impl Trait</code> allows you to work with types which you cannot name. The meaning of <code>impl Trait</code> is a bit different in the different positions.</p><ul><li><p>For a parameter, <code>impl Trait</code> is like an anonymous generic parameter with a trait bound.</p></li><li><p>For a return type, it means that the return type is some concrete type that implements the trait, without naming the type. This can be useful when you don’t want to expose the concrete type in a public API.</p><p>Inference is hard in return position. A function returning <code>impl Foo</code> picks the concrete type it returns, without writing it out in the source. A function returning a generic type like <code>collect&lt;B&gt;() -&gt; B</code> can return any type satisfying <code>B</code>, and the caller may need to choose one, such as with <code>let x: Vec&lt;_&gt; = foo.collect()</code> or with the turbofish, <code>foo.collect::&lt;Vec&lt;_&gt;&gt;()</code>.</p></li></ul><h2 id="standard-library-types" tabindex="-1"><a class="header-anchor" href="#standard-library-types" aria-hidden="true">#</a> Standard Library Types</h2><h3 id="documentation" tabindex="-1"><a class="header-anchor" href="#documentation" aria-hidden="true">#</a> Documentation</h3><p>ust comes with extensive documentation. For example:</p><ul><li>All of the details about <a href="https://doc.rust-lang.org/stable/reference/expressions/loop-expr.html" target="_blank" rel="noopener noreferrer">loops<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>Primitive types like <a href="https://doc.rust-lang.org/stable/std/primitive.u8.html" target="_blank" rel="noopener noreferrer"><code>u8</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>Standard library types like <a href="https://doc.rust-lang.org/stable/std/option/enum.Option.html" target="_blank" rel="noopener noreferrer"><code>Option</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> or <a href="https://doc.rust-lang.org/stable/std/collections/struct.BinaryHeap.html" target="_blank" rel="noopener noreferrer"><code>BinaryHeap</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li></ul><p>In fact, you can document your own code:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token comment">/// Determine whether the first argument is divisible by the second argument.</span>
<span class="token comment">///</span>
<span class="token comment">/// If the second argument is zero, the result is false.</span>
<span class="token keyword">fn</span> <span class="token function-definition function">is_divisible_by</span><span class="token punctuation">(</span>lhs<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> rhs<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> rhs <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    lhs <span class="token operator">%</span> rhs <span class="token operator">==</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The contents are treated as Markdown. All published Rust library crates are automatically documented at <a href="https://docs.rs/" target="_blank" rel="noopener noreferrer"><code>docs.rs</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> using the <a href="https://doc.rust-lang.org/rustdoc/what-is-rustdoc.html" target="_blank" rel="noopener noreferrer">rustdoc<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> tool. It is idiomatic to document all public items in an API using this pattern.</p><p>To document an item from inside the item (such as inside a module), use <code>//!</code> or <code>/*! .. */</code>, called “inner doc comments”:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>//! This module contains functionality relating to divisibility of integers.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="option" tabindex="-1"><a class="header-anchor" href="#option" aria-hidden="true">#</a> Option</h3><p>It stores either a value of type <code>T</code> or nothing. For example, <a href="https://doc.rust-lang.org/stable/std/string/struct.String.html#method.find" target="_blank" rel="noopener noreferrer"><code>String::find</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> returns an <code>Option&lt;usize&gt;</code>.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;Löwe 老虎 Léopard Gepardi&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> position<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span> <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">&#39;é&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;find returned {position:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    position <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">&#39;Z&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;find returned {position:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Character not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Option</code> is widely used, not just in the standard library.</li><li><code>unwrap</code> will return the value in an <code>Option</code>, or panic. <code>expect</code> is similar but takes an error message. <ul><li>You can panic on None, but you can’t “accidentally” forget to check for None.</li><li>It’s common to <code>unwrap</code>/<code>expect</code> all over the place when hacking something together, but production code typically handles <code>None</code> in a nicer fashion.</li></ul></li><li>The niche optimization means that <code>Option&lt;T&gt;</code> often has the same size in memory as <code>T</code>.</li></ul><h3 id="result" tabindex="-1"><a class="header-anchor" href="#result" aria-hidden="true">#</a> Result</h3><p><code>Result</code> is similar to <code>Option</code>, but indicates the success or failure of an operation, each with a different type.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> file<span class="token punctuation">:</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">File</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;diary.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> file <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token keyword">mut</span> file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> <span class="token keyword">mut</span> contents <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> contents<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Dear diary: {contents} ({bytes} bytes)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Could not read file content&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;The diary could not be opened: {err}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>As with <code>Option</code>, the successful value sits inside of <code>Result</code>, forcing the developer to explicitly extract it. This encourages error checking. In the case where an error should never happen, <code>unwrap()</code> or <code>expect()</code> can be called, and this is a signal of the developer intent too.</li><li><code>Result</code> documentation is a recommended read. Not during the course, but it is worth mentioning. It contains a lot of convenience methods and functions that help functional-style programming.</li></ul><h3 id="string" tabindex="-1"><a class="header-anchor" href="#string" aria-hidden="true">#</a> String</h3><p><a href="https://doc.rust-lang.org/std/string/struct.String.html" target="_blank" rel="noopener noreferrer"><code>String</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is the standard heap-allocated growable UTF-8 string buffer:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s1<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s1: len = {}, capacity = {}&quot;</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s1<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> s2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span>s1<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    s2<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    s2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token char">&#39;!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2: len = {}, capacity = {}&quot;</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s2<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s3 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;🇨🇭&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s3: len = {}, number of chars = {}&quot;</span><span class="token punctuation">,</span> s3<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             s3<span class="token punctuation">.</span><span class="token function">chars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>String</code> implements <a href="https://doc.rust-lang.org/std/string/struct.String.html#deref-methods-str" target="_blank" rel="noopener noreferrer"><code>Deref</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, which means that you can call all <code>str</code> methods on a <code>String</code>.</p><ul><li><code>String::new</code> returns a new empty string, use <code>String::with_capacity</code> when you know how much data you want to push to the string.</li><li><code>String::len</code> returns the size of the <code>String</code> in bytes (which can be different from its length in characters).</li><li><code>String::chars</code> returns an iterator over the actual characters. Note that a <code>char</code> can be different from what a human will consider a “character” due to <a href="https://docs.rs/unicode-segmentation/latest/unicode_segmentation/struct.Graphemes.html" target="_blank" rel="noopener noreferrer">grapheme clusters<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>When people refer to strings they could either be talking about <code>&amp;str</code> or <code>String</code>.</li><li>When a type implements <code>Deref&lt;Target = T&gt;</code>, the compiler will let you transparently call methods from <code>T</code>. <ul><li>We haven’t discussed the <code>Deref</code> trait yet, so at this point this mostly explains the structure of the sidebar in the documentation.</li><li><code>String</code> implements <code>Deref&lt;Target = str&gt;</code> which transparently gives it access to <code>str</code>’s methods.</li><li>Write and compare <code>let s3 = s1.deref();</code> and <code>let s3 = &amp;*s1;</code>.</li></ul></li><li><code>String</code> is implemented as a wrapper around a vector of bytes, many of the operations you see supported on vectors are also supported on <code>String</code>, but with some extra guarantees.</li><li>Compare the different ways to index a <code>String</code>: <ul><li>To a character by using <code>s3.chars().nth(i).unwrap()</code> where <code>i</code> is in-bound, out-of-bounds.</li><li>To a substring by using <code>s3[0..4]</code>, where that slice is on character boundaries or not.</li></ul></li></ul><h3 id="vec" tabindex="-1"><a class="header-anchor" href="#vec" aria-hidden="true">#</a> Vec</h3><p><a href="https://doc.rust-lang.org/std/vec/struct.Vec.html" target="_blank" rel="noopener noreferrer"><code>Vec</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is the standard resizable heap-allocated buffer:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>fn main() {
    let mut v1 = Vec::new();
    v1.push(42);
    print_vec(&amp;v1);

    let mut v2 = Vec::with_capacity(v1.len() + 1);
    v2.extend(v1.iter());
    v2.push(999);
    print_vec(&amp;v2);

    // Canonical marco to initialize a vector with elements
    let mut v3 = vec![0, 0, 1, 2, 3];
    print_vec(&amp;v3);

    // Retain only the even elements.
    v3.retain(|x| x &amp; 1 == 0);
    print_vec(&amp;v3);

    // Remove consecutive duplicates
    v3.dedup();
    println!(&quot;{v3:?}&quot;);
}

fn print_vec(v: &amp;Vec&lt;i64&gt;) {
    println!(&quot;v1: len: {}, cap: {}&quot;, v.len(), v.capacity());
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Vec</code> is a type of collection, along with <code>String</code> and <code>HashMap</code>. The data it contains is stored on the heap. This means the amount of data doesn’t need to be known at compile time. It can grow or shrink at runtime.</li><li>Notice how <code>Vec&lt;T&gt;</code> is a generic type too, but you don’t have to specify <code>T</code> explicitly. As always with Rust type inference, the <code>T</code> was established during the first <code>push</code> call.</li><li><code>vec![...]</code> is a canonical macro to use instead of <code>Vec::new()</code> and it supports adding initial elements to the vector.</li><li>To index the vector you use <code>[</code> <code>]</code>, but they will panic if out of bounds. Alternatively, using <code>get</code> will return an <code>Option</code>. The <code>pop</code> function will remove the last element.</li></ul><h3 id="hashmap" tabindex="-1"><a class="header-anchor" href="#hashmap" aria-hidden="true">#</a> HashMap</h3><p>Standard hash map with protection against <strong>HashDoS attacks</strong>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> m <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;m: {m:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;m contains D: {}&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;m contains A: {}&quot;</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span><span class="token function">contains_key</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> m<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A: {}&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A is not exists&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// insert a entry with default val when the key is not found</span>
    <span class="token keyword">let</span> e <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>e <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{e:#?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>HashMap</code> is not defined in the prelude and needs to be brought into scope.</p></li><li><p>since Rust 1.56, HashMap implements [<code>From&lt;[(K, V); N]&gt;</code>](&lt;<a href="https://doc.rust-lang.org/std/collections/hash_map/struct.HashMap.html#impl-From" target="_blank" rel="noopener noreferrer">https://doc.rust-lang.org/std/collections/hash_map/struct.HashMap.html#impl-From<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>&lt;[(K,+V);+N]&gt;-for-HashMap&gt;), which allows us to easily initialize a hash map from a literal array:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">let</span> page_counts <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">(</span><span class="token string">&quot;Harry Potter and the Sorcerer&#39;s Stone&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">336</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;The Hunger Games&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">374</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Alternatively HashMap can be built from any <code>Iterator</code> which yields key-value tuples.</p></li></ul><h2 id="memory-management" tabindex="-1"><a class="header-anchor" href="#memory-management" aria-hidden="true">#</a> Memory Management</h2><h3 id="program-memory" tabindex="-1"><a class="header-anchor" href="#program-memory" aria-hidden="true">#</a> Program Memory</h3><p>Programs allocate memory in two ways:</p><ul><li>Stack: Continuous area of memory for local variables. <ul><li>Values have fixed sizes known at compile time.</li><li>Extremely fast: just move a stack pointer.</li><li>Easy to manage: follows function calls.</li><li>Great memory locality.</li></ul></li><li>Heap: Storage of values outside of function calls. <ul><li>Values have dynamic sizes determined at runtime.</li><li>Slightly slower than the stack: some book-keeping needed.</li><li>No guarantee of memory locality.</li></ul></li></ul><p>Creating a <code>String</code> puts fixed-sized metadata on the stack and dynamically sized data, the actual string, on the heap:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202312210946295.png" alt="image-20231221094611493" tabindex="0" loading="lazy"><figcaption>image-20231221094611493</figcaption></figure><h3 id="approaches-to-memory-management" tabindex="-1"><a class="header-anchor" href="#approaches-to-memory-management" aria-hidden="true">#</a> Approaches to Memory Management</h3><p>Traditionally, languages have fallen into two broad categories:</p><ul><li>Full control via manual memory management: C, C++, Pascal, … <ul><li>Programmer decides when to allocate or free heap memory.</li><li>Programmer must determine whether a pointer still points to valid memory.</li><li>Studies show, programmers make mistakes.</li></ul></li><li>Full safety via automatic memory management at runtime: Java, Python, Go, Haskell, … <ul><li>A runtime system ensures that memory is not freed until it can no longer be referenced.</li><li>Typically implemented with reference counting, garbage collection, or RAII.</li></ul></li></ul><p>Rust offers a new mix:</p><blockquote><p>Full control <em>and</em> safety via compile time enforcement of correct memory management.</p></blockquote><p>It does this with an explicit ownership concept.</p><ul><li>C must manage heap manually with <code>malloc</code> and <code>free</code>. Common errors include forgetting to call <code>free</code>, calling it multiple times for the same pointer, or dereferencing a pointer after the memory it points to has been freed.</li><li>C++ has tools like smart pointers (<code>unique_ptr</code>, <code>shared_ptr</code>) that take advantage of language guarantees about calling destructors to ensure memory is freed when a function returns. It is still quite easy to mis-use these tools and create similar bugs to C.</li><li>Java, Go, and Python rely on the garbage collector to identify memory that is no longer reachable and discard it. This guarantees that any pointer can be dereferenced, eliminating use-after-free and other classes of bugs. But, GC has a runtime cost and is difficult to tune properly.</li></ul><p>Rust’s ownership and borrowing model can, in many cases, get the performance of C, with alloc and free operations precisely where they are required – zero cost. It also provides tools similar to C++’s smart pointers. When required, other options such as reference counting are available, and there are even third-party crates available to support runtime garbage collection (not covered in this class).</p><h3 id="ownership" tabindex="-1"><a class="header-anchor" href="#ownership" aria-hidden="true">#</a> Ownership</h3><p>All variable bindings have a <em>scope</em> where they are valid and it is an error to use a variable outside its scope:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {}&quot;</span><span class="token punctuation">,</span> p<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// cannot find value `p` in this scope</span>
    <span class="token comment">// println!(&quot;y: {}&quot;, p.1);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We say that the variable <em>owns</em> the value. Every Rust value has precisely one owner at all times.</p><p>At the end of the scope, the variable is <em>dropped</em> and the data is freed. A destructor can run here to free up resources.</p><h3 id="move-semantics" tabindex="-1"><a class="header-anchor" href="#move-semantics" aria-hidden="true">#</a> Move Semantics</h3><p>An assignment will transfer <em>ownership</em> between variables:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> s1<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2: {s2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// borrow of moved value: `s1`</span>
    <span class="token comment">// println!(&quot;s1: {s1}&quot;);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>The assignment of <code>s1</code> to <code>s2</code> transfers ownership.</li><li>When <code>s1</code> goes out of scope, nothing happens: it does not own anything.</li><li>When <code>s2</code> goes out of scope, the string data is freed.</li></ul><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202312211028647.png" alt="image-20231221102838776" tabindex="0" loading="lazy"><figcaption>image-20231221102838776</figcaption></figure><p>When you pass a value to a function, the value is assigned to the function parameter. This transfers ownership:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> s1<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2: {s2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// borrow of moved value: `s1`</span>
    <span class="token comment">// println!(&quot;s1: {s1}&quot;);</span>

    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">say_hello</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// use of moved value: `name`</span>
    <span class="token comment">// say_hello(name);</span>

    <span class="token comment">// pass a clone of name</span>
    <span class="token keyword">let</span> name2 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">say_hello</span><span class="token punctuation">(</span>name2<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">say_hello</span><span class="token punctuation">(</span>name2<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// main func can retain ownership by passing name as reference</span>
    <span class="token keyword">let</span> name3 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Kesa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">say_hello_ref</span><span class="token punctuation">(</span>name3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">say_hello_ref</span><span class="token punctuation">(</span>name3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">say_hello</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello {name}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">say_hello_ref</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Hello {name}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>With the first call to <code>say_hello</code>, <code>main</code> gives up ownership of <code>name</code>. Afterwards, <code>name</code> cannot be used anymore within <code>main</code>.</li><li>The heap memory allocated for <code>name</code> will be freed at the end of the <code>say_hello</code> function.</li><li><code>main</code> can retain ownership if it passes <code>name</code> as a reference (<code>&amp;name</code>) and if <code>say_hello</code> accepts a reference as a parameter.</li><li>In Rust, clones are explicit (by using <code>clone</code>). <code>main</code> can pass a clone of <code>name</code> in the first call (<code>name.clone()</code>).</li></ul><h3 id="clone" tabindex="-1"><a class="header-anchor" href="#clone" aria-hidden="true">#</a> Clone</h3><p>Sometimes you <em>want</em> to make a copy of a value. The <code>Clone</code> trait accomplishes this.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Default, Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Backends</span> <span class="token punctuation">{</span>
    hostnames<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    weights<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Backends</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">set_hostname</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> hostnames<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>hostnames <span class="token operator">=</span> hostnames<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>weights <span class="token operator">=</span> hostnames<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="copy-types" tabindex="-1"><a class="header-anchor" href="#copy-types" aria-hidden="true">#</a> Copy Types</h3><p>While move semantics are the default, certain types are copied by default:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;x: {x}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// would not be accessible if not Copy</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;y: {y}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>These types implement the <code>Copy</code> trait.</p><p>You can opt-in your own types to use copy semantics:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Copy, Clone, Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> p2 <span class="token operator">=</span> p1<span class="token punctuation">;</span> <span class="token comment">// call p1.clone implicitly</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;p1: {p1:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;p2: {p2:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>After the assignment, both <code>p1</code> and <code>p2</code> own their own data.</li><li>We can also use <code>p1.clone()</code> to explicitly copy the data.</li></ul><p>Copying and cloning are not the same thing:</p><ul><li>Copying refers to bitwise copies of memory regions and does not work on arbitrary objects.</li><li>Copying does not allow for custom logic (unlike copy constructors in C++).</li><li>Cloning is a more general operation and also allows for custom behavior by implementing the <code>Clone</code> trait.</li><li>Copying does not work on types that implement the <code>Drop</code> trait.</li></ul><h3 id="the-drop-trait" tabindex="-1"><a class="header-anchor" href="#the-drop-trait" aria-hidden="true">#</a> The Drop Trait</h3><p>Values which implement <a href="https://doc.rust-lang.org/std/ops/trait.Drop.html" target="_blank" rel="noopener noreferrer"><code>Drop</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> can specify code to run when they go out of scope:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Droppable</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;static</span> <span class="token keyword">str</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">Droppable</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Dropping {}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">Droppable</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;a&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">Droppable</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;b&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">Droppable</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;c&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token class-name">Droppable</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;d&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Exiting block B&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Exiting block A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">drop</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Exiting block main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Ouput</span><span class="token punctuation">:</span>
<span class="token class-name">Exiting</span> block <span class="token class-name">B</span>
<span class="token class-name">Dropping</span> d
<span class="token class-name">Dropping</span> c
<span class="token class-name">Exiting</span> block <span class="token class-name">A</span>
<span class="token class-name">Dropping</span> b
<span class="token class-name">Dropping</span> a
<span class="token class-name">Exiting</span> block main
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Note that <code>std::mem::drop</code> is not the same as <code>std::ops::Drop::drop</code>.</li><li>Values are automatically dropped when they go out of scope.</li><li>When a value is dropped, if it implements <code>std::ops::Drop</code> then its <code>Drop::drop</code> implementation will be called.</li><li>All its fields will then be dropped too, whether or not it implements <code>Drop</code>.</li><li><code>std::mem::drop</code> is just an empty function that takes any value. The significance is that it takes ownership of the value, so at the end of its scope it gets dropped. This makes it a convenient way to explicitly drop values earlier than they would otherwise go out of scope. <ul><li>This can be useful for objects that do some work on <code>drop</code>: releasing locks, closing files, etc.</li></ul></li></ul><blockquote><p>Why doesn’t <code>Drop::drop</code> take <code>self</code>?</p><p>If it did, <code>std::mem::drop</code> would be called at the end of the block, resulting in another call to <code>Drop::drop</code>, and a stack overflow!</p></blockquote><h2 id="smart-pointers" tabindex="-1"><a class="header-anchor" href="#smart-pointers" aria-hidden="true">#</a> Smart Pointers</h2><h3 id="box" tabindex="-1"><a class="header-anchor" href="#box" aria-hidden="true">#</a> Box</h3><p><a href="https://doc.rust-lang.org/std/boxed/struct.Box.html" target="_blank" rel="noopener noreferrer"><code>Box</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is an owned pointer to data on the heap:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> five <span class="token operator">=</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;five: {}&quot;</span><span class="token punctuation">,</span> <span class="token operator">*</span>five<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202312211108379.png" alt="image-20231221110848358" tabindex="0" loading="lazy"><figcaption>image-20231221110848358</figcaption></figure><p><code>Box&lt;T&gt;</code> implements <code>Deref&lt;Target = T&gt;</code>, which means that you can <a href="https://doc.rust-lang.org/std/ops/trait.Deref.html#more-on-deref-coercion" target="_blank" rel="noopener noreferrer">call methods from <code>T</code> directly on a <code>Box</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><p>Recursive data types or data types with dynamic sizes need to use a <code>Box</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">/// A non-empty list, consisting of the first element and the rest of the list.</span>
    <span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">/// An empty list.</span>
    <span class="token class-name">Nil</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> list<span class="token punctuation">:</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">::</span><span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">::</span><span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">::</span><span class="token class-name">Nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{list:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202312211112861.png" alt="image-20231221111249947" tabindex="0" loading="lazy"><figcaption>image-20231221111249947</figcaption></figure><ul><li><code>Box</code> is like <code>std::unique_ptr</code> in C++, except that it’s guaranteed to be not null.</li><li>A <code>Box</code> can be useful when you: <ul><li>have a type whose size that can’t be known at compile time, but the Rust compiler wants to know an exact size.</li><li>want to transfer ownership of a large amount of data. To avoid copying large amounts of data on the stack, instead store the data on the heap in a <code>Box</code> so only the pointer is moved.</li></ul></li><li>If <code>Box</code> was not used and we attempted to embed a <code>List</code> directly into the <code>List</code>, the compiler would not compute a fixed size of the struct in memory (<code>List</code> would be of infinite size).</li><li><code>Box</code> solves this problem as it has the same size as a regular pointer and just points at the next element of the <code>List</code> in the heap.</li><li>Remove the <code>Box</code> in the List definition and show the compiler error. “Recursive with indirection” is a hint you might want to use a Box or reference of some kind, instead of storing a value directly.</li></ul><h4 id="niche-optimization" tabindex="-1"><a class="header-anchor" href="#niche-optimization" aria-hidden="true">#</a> Niche Optimization</h4><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Nil</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> list<span class="token punctuation">:</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">::</span><span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">::</span><span class="token class-name">Element</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token punctuation">::</span><span class="token class-name">Nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{list:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>A <code>Box</code> cannot be empty, so the pointer is always valid and non-<code>null</code>. This allows the compiler to optimize the memory layout:</p><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202312211115613.png" alt="image-20231221111514775" tabindex="0" loading="lazy"><figcaption>image-20231221111514775</figcaption></figure><h3 id="rc" tabindex="-1"><a class="header-anchor" href="#rc" aria-hidden="true">#</a> Rc</h3><p><a href="https://doc.rust-lang.org/std/rc/struct.Rc.html" target="_blank" rel="noopener noreferrer"><code>Rc</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is a reference-counted shared pointer. Use this when you need to refer to the same data from multiple places:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>rc<span class="token punctuation">::</span></span><span class="token class-name">Rc</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;a: {a}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;b: {b}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Rc</code>’s count ensures that its contained value is valid for as long as there are references.</li><li><code>Rc</code> in Rust is like <code>std::shared_ptr</code> in C++.</li><li><code>Rc::clone</code> is cheap: it creates a pointer to the same allocation and increases the reference count. Does not make a deep clone and can generally be ignored when looking for performance issues in code.</li><li><code>make_mut</code> actually clones the inner value if necessary (“clone-on-write”) and returns a mutable reference.</li><li>Use <code>Rc::strong_count</code> to check the reference count.</li><li><code>Rc::downgrade</code> gives you a <em>weakly reference-counted</em> object to create cycles that will be dropped properly (likely in combination with <code>RefCell</code>).</li></ul><h2 id="borrowing-value" tabindex="-1"><a class="header-anchor" href="#borrowing-value" aria-hidden="true">#</a> Borrowing Value</h2><p>Instead of transferring ownership when calling a function, you can let a function <em>borrow</em> the value:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">add</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
    <span class="token class-name">Point</span><span class="token punctuation">(</span>p1<span class="token number">.0</span> <span class="token operator">+</span> p2<span class="token number">.0</span><span class="token punctuation">,</span> p1<span class="token number">.1</span> <span class="token operator">+</span> p2<span class="token number">.1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> p1 <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> p2 <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{p1:?} + {p2:?} = {p3:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>The <code>add</code> function <em>borrows</em> two points and returns a new point.</li><li>The caller retains ownership of the inputs.</li></ul><h3 id="borrow-checking" tabindex="-1"><a class="header-anchor" href="#borrow-checking" aria-hidden="true">#</a> Borrow Checking</h3><p>Rust’s <em>borrow checker</em> puts constraints on the ways you can borrow values. For a given value, at any time:</p><ul><li>You can have <strong>one or more shared references</strong> to the value, <em>or</em></li><li>You can have <strong>exactly one exclusive reference</strong> to the value.</li></ul><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> a<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> c<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> a<span class="token punctuation">;</span>
        <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;a: {a}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// cannot borrow `a` as mutable because</span>
    <span class="token comment">// it is also borrowed as immutable</span>
    <span class="token comment">// println!(&quot;b: {b}&quot;);</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Note that the requirement is that conflicting references not <em>exist</em> at the same point. It does not matter where the reference is dereferenced.</li><li>The above code does not compile because <code>a</code> is borrowed as mutable (through <code>c</code>) and as immutable (through <code>b</code>) at the same time.</li><li>The exclusive reference constraint is quite strong. Rust uses it to ensure that data races do not occur. Rust also <em>relies</em> on this constraint to optimize code. For example, a value behind a shared reference can be safely cached in a register for the lifetime of that reference.</li></ul><h3 id="interior-mutability" tabindex="-1"><a class="header-anchor" href="#interior-mutability" aria-hidden="true">#</a> Interior Mutability</h3><p>Rust provides a few safe means of modifying a value given only a shared reference to that value. All of these replace compile-time checks with runtime checks.</p><h4 id="cell-and-refcell" tabindex="-1"><a class="header-anchor" href="#cell-and-refcell" aria-hidden="true">#</a> Cell and RefCell</h4><p><a href="https://doc.rust-lang.org/std/cell/struct.Cell.html" target="_blank" rel="noopener noreferrer"><code>Cell</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://doc.rust-lang.org/std/cell/struct.RefCell.html" target="_blank" rel="noopener noreferrer"><code>RefCell</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> implement what Rust calls <em>interior mutability:</em> mutation of values in an immutable context.</p><p><code>Cell</code> is typically used for simple types, as it requires copying or moving values. More complex interior types typically use <code>RefCell</code>, which tracks shared and exclusive references at runtime and panics if they are misused.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cell<span class="token punctuation">::</span></span><span class="token class-name">RefCell</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>rc<span class="token punctuation">::</span></span><span class="token class-name">Rc</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, Default)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Node</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Rc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">Node</span><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Rc</span><span class="token operator">&lt;</span><span class="token class-name">RefCell</span><span class="token operator">&lt;</span><span class="token class-name">Node</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token class-name">Rc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">RefCell</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Node</span> <span class="token punctuation">{</span>
            value<span class="token punctuation">,</span>
            <span class="token punctuation">..</span><span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">sum</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i64</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> c<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> root <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    root<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> subtree <span class="token operator">=</span> <span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subtree<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    subtree<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    root<span class="token punctuation">.</span><span class="token function">borrow_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>subtree<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;graph: {root:#?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;graph sum: {}&quot;</span><span class="token punctuation">,</span> root<span class="token punctuation">.</span><span class="token function">borrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>If we were using <code>Cell</code> instead of <code>RefCell</code> in this example, we would have to move the <code>Node</code> out of the <code>Rc</code> to push children, then move it back in. This is safe because there’s always one, un-referenced value in the cell, but it’s not ergonomic.</li><li>To do anything with a Node, you must call a <code>RefCell</code> method, usually <code>borrow</code> or <code>borrow_mut</code>.</li></ul><h2 id="slices" tabindex="-1"><a class="header-anchor" href="#slices" aria-hidden="true">#</a> Slices</h2><p>A slice gives you a view into a larger collection:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> a<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span> <span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;a: {a:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// cannot assign to `a[_]` because it is borrowed</span>
    <span class="token comment">// a[3] = 400;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s: {s:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;a: {a:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Slices borrow data from the sliced type.</li><li>We create a slice by borrowing <code>a</code> and specifying the starting and ending indexes in brackets.</li><li>If the slice starts at index 0, Rust’s range syntax allows us to drop the starting index, meaning that <code>&amp;a[0..a.len()]</code> and <code>&amp;a[..a.len()]</code> are identical.</li><li>The same is true for the last index, so <code>&amp;a[2..a.len()]</code> and <code>&amp;a[2..]</code> are identical.</li><li>To easily create a slice of the full array, we can therefore use <code>&amp;a[..]</code>.</li><li><code>s</code> is a reference to a slice of <code>i32</code>s. Notice that the type of <code>s</code> (<code>&amp;[i32]</code>) no longer mentions the array length. This allows us to perform computation on slices of different sizes.</li><li>Slices always borrow from another object. In this example, <code>a</code> has to remain ‘alive’ (in scope) for at least as long as our slice.</li><li>You cannot modify the <code>a[3]</code> before printing <code>s</code> for memory safety reasons you cannot do it through <code>a</code> at this point in the execution, but you can read the data from both <code>a</code> and <code>s</code> safely. It works before you created the slice, and again after the <code>println</code>, when the slice is no longer used.</li></ul><h3 id="string-reference" tabindex="-1"><a class="header-anchor" href="#string-reference" aria-hidden="true">#</a> String Reference</h3><p><code>&amp;str</code> is almost like <code>&amp;[char]</code>, but with its data stored in a variable-length encoding (UTF-8).</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;World&quot;</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s1: {s1}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> s2<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2: {s2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    s2<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s2: {s2}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s3<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>s2<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;s3: {s3}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><code>&amp;str</code> an immutable reference to a string slice.</p></li><li><p><code>String</code> a mutable string buffer.</p></li><li><p><code>&amp;str</code> introduces a string slice, which is an immutable reference to UTF-8 encoded string data stored in a block of memory. String literals (<code>”Hello”</code>), are stored in the program’s binary.</p></li><li><p>Rust’s <code>String</code> type is a wrapper around a vector of bytes. As with a <code>Vec&lt;T&gt;</code>, it is owned.</p></li><li><p>As with many other types <code>String::from()</code> creates a string from a string literal; <code>String::new()</code> creates a new empty string, to which string data can be added using the <code>push()</code> and <code>push_str()</code> methods.</p></li><li><p>The <code>format!()</code> macro is a convenient way to generate an owned string from dynamic values. It accepts the same format specification as <code>println!()</code>.</p></li><li><p>You can borrow <code>&amp;str</code> slices from <code>String</code> via <code>&amp;</code> and optionally range selection. If you select a byte range that is not aligned to character boundaries, the expression will panic. The <code>chars</code> iterator iterates over characters and is preferred over trying to get character boundaries right.</p></li><li><p>Byte strings literals allow you to create a <code>&amp;[u8]</code> value directly:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> <span class="token string">b&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="lifetime-annotations" tabindex="-1"><a class="header-anchor" href="#lifetime-annotations" aria-hidden="true">#</a> Lifetime Annotations</h3><p>A reference has a <em>lifetime</em>, which must not “outlive” the value it refers to. This is verified by the borrow checker.</p><p>The lifetime can be implicit - this is what we have seen so far. Lifetimes can also be explicit: <code>&amp;&#39;a Point</code>, <code>&amp;&#39;document str</code>. Lifetimes start with <code>&#39;</code> and <code>&#39;a</code> is a typical default name. Read <code>&amp;&#39;a Point</code> as “a borrowed <code>Point</code> which is valid for at least the lifetime <code>a</code>”.</p><p>Lifetimes are always inferred by the compiler: you cannot assign a lifetime yourself. Explicit lifetime annotations create constraints where there is ambiguity; the compiler verifies that there is a valid solution.</p><p>Lifetimes become more complicated when considering passing values to and returning values from functions.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">left_most</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> p1<span class="token number">.0</span> <span class="token operator">&lt;</span> p2<span class="token number">.0</span> <span class="token punctuation">{</span> p1 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span> p2 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> p1<span class="token punctuation">:</span> <span class="token class-name">Point</span> <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> p2<span class="token punctuation">:</span> <span class="token class-name">Point</span> <span class="token operator">=</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> p3 <span class="token operator">=</span> <span class="token function">left_most</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// What is the lifetime of p3?</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;p3: {p3:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>n this example, the the compiler does not know what lifetime to infer for <code>p3</code>. Looking inside the function body shows that it can only safely assume that <code>p3</code>’s lifetime is the shorter of <code>p1</code> and <code>p2</code>. But just like types, Rust requires explicit annotations of lifetimes on function arguments and return values.</p></li><li><p>Add <code>&#39;a</code> appropriately to <code>left_most</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">left_most</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Point</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>his says, “given p1 and p2 which both outlive <code>&#39;a</code>, the return value lives for at least <code>&#39;a</code>.</p></li></ul><h3 id="lifetimes-in-function-calls" tabindex="-1"><a class="header-anchor" href="#lifetimes-in-function-calls" aria-hidden="true">#</a> Lifetimes in Function Calls</h3><p>Lifetimes for function arguments and return values must be fully specified, but Rust allows lifetimes to be elided in most cases with <a href="https://doc.rust-lang.org/nomicon/lifetime-elision.html" target="_blank" rel="noopener noreferrer">a few simple rules<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. This is not inference – it is just a syntactic shorthand.</p><ul><li>Each argument which does not have a lifetime annotation is given one.</li><li>If there is only one argument lifetime, it is given to all un-annotated return values.</li><li>If there are multiple argument lifetimes, but the first one is for <code>self</code>, that lifetime is given to all un-annotated return values.</li></ul><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">cab_distance</span><span class="token punctuation">(</span>p1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">,</span> p2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>p1<span class="token number">.0</span> <span class="token operator">-</span> p2<span class="token number">.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>p1<span class="token number">.1</span> <span class="token operator">-</span> p2<span class="token number">.1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">nearest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>points<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token punctuation">[</span><span class="token class-name">Point</span><span class="token punctuation">]</span><span class="token punctuation">,</span> query<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;a</span> <span class="token class-name">Point</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> nearest <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> points <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> nearest_dist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> nearest <span class="token punctuation">{</span>
            <span class="token keyword">let</span> dist <span class="token operator">=</span> <span class="token function">cab_distance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> dist <span class="token operator">&lt;</span> nearest_dist <span class="token punctuation">{</span>
                nearest <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> dist<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            nearest <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token function">cab_distance</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    nearest<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> p<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>
        <span class="token function">nearest</span><span class="token punctuation">(</span>
            <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token operator">&amp;</span><span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In this example, <code>cab_distance</code> is trivially elided.</p><p>The <code>nearest</code> function provides another example of a function with multiple references in its arguments that requires explicit annotation.</p><h3 id="lifetimes-in-data-structures" tabindex="-1"><a class="header-anchor" href="#lifetimes-in-data-structures" aria-hidden="true">#</a> Lifetimes in Data Structures</h3><p>If a data type stores borrowed data, it must be annotated with a lifetime:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Highlight</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;doc</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;doc</span> <span class="token keyword">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">erase</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Bye {text}!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;The quick brown fox jumps over the lazy dog.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> fox <span class="token operator">=</span> <span class="token class-name">Highlight</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>text<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">..</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> dog <span class="token operator">=</span> <span class="token class-name">Highlight</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>text<span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">..</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// erase(text);</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{fox:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{dog:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>In the above example, the annotation on <code>Highlight</code> enforces that the data underlying the contained <code>&amp;str</code> lives at least as long as any instance of <code>Highlight</code> that uses that data.</li><li>If <code>text</code> is consumed before the end of the lifetime of <code>fox</code> (or <code>dog</code>), the borrow checker throws an error.</li><li>Types with borrowed data force users to hold on to the original data. This can be useful for creating lightweight views, but it generally makes them somewhat harder to use.</li><li>When possible, make data structures own their data directly.</li><li>Some structs with multiple references inside can have more than one lifetime annotation. This can be necessary if there is a need to describe lifetime relationships between the references themselves, in addition to the lifetime of the struct itself. Those are very advanced use cases.</li></ul><h2 id="iterators" tabindex="-1"><a class="header-anchor" href="#iterators" aria-hidden="true">#</a> Iterators</h2><h3 id="iterator" tabindex="-1"><a class="header-anchor" href="#iterator" aria-hidden="true">#</a> Iterator</h3><p>The <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html" target="_blank" rel="noopener noreferrer"><code>Iterator</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> trait supports iterating over values in a collection. It requires a <code>next</code> method and provides lots of methods. Many standard library types implement <code>Iterator</code>, and you can implement it yourself, too:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Fibonacci</span> <span class="token punctuation">{</span>
    curr<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    next<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">Fibonacci</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Item</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> new_next <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>curr <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>curr <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>next<span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>next <span class="token operator">=</span> new_next<span class="token punctuation">;</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>curr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> fib <span class="token operator">=</span> <span class="token class-name">Fibonacci</span> <span class="token punctuation">{</span> curr<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> next<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token keyword">in</span> fib<span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;fib({i}): {n}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>The <code>Iterator</code> trait implements many common functional programming operations over collections (e.g. <code>map</code>, <code>filter</code>, <code>reduce</code>, etc). This is the trait where you can find all the documentation about them. In Rust these functions should produce the code as efficient as equivalent imperative implementations.</li><li><code>IntoIterator</code> is the trait that makes for loops work. It is implemented by collection types such as <code>Vec&lt;T&gt;</code> and references to them such as <code>&amp;Vec&lt;T&gt;</code> and <code>&amp;[T]</code>. Ranges also implement it. This is why you can iterate over a vector with <code>for i in some_vec { .. }</code> but <code>some_vec.next()</code> doesn’t exist.</li></ul><h3 id="intoiterator" tabindex="-1"><a class="header-anchor" href="#intoiterator" aria-hidden="true">#</a> IntoIterator</h3><p>The <code>Iterator</code> trait tells you how to <em>iterate</em> once you have created an iterator. The related trait <a href="https://doc.rust-lang.org/std/iter/trait.IntoIterator.html" target="_blank" rel="noopener noreferrer"><code>IntoIterator</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> defines how to create an iterator for a type. It is used automatically by the <code>for</code> loop.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Grid</span> <span class="token punctuation">{</span>
    x_coords<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    y_coords<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">IntoIterator</span> <span class="token keyword">for</span> <span class="token class-name">Grid</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">IntoIter</span> <span class="token operator">=</span> <span class="token class-name">GridIter</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">into_iter</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">GridIter</span> <span class="token punctuation">{</span>
        <span class="token class-name">GridIter</span> <span class="token punctuation">{</span> grid<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">,</span> i<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> j<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">GridIter</span> <span class="token punctuation">{</span>
    grid<span class="token punctuation">:</span> <span class="token class-name">Grid</span><span class="token punctuation">,</span>
    i<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
    j<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Iterator</span> <span class="token keyword">for</span> <span class="token class-name">GridIter</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Item</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>i <span class="token operator">&gt;=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>grid<span class="token punctuation">.</span>x_coords<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>j <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>j <span class="token operator">&gt;=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>grid<span class="token punctuation">.</span>y_coords<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">None</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>grid<span class="token punctuation">.</span>x_coords<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>grid<span class="token punctuation">.</span>y_coords<span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        res
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> grid <span class="token operator">=</span> <span class="token class-name">Grid</span> <span class="token punctuation">{</span>
        x_coords<span class="token punctuation">:</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        y_coords<span class="token punctuation">:</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">in</span> grid <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;point = {x}, {y}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Every implementation of <code>IntoIterator</code> must declare two types:</p><ul><li><code>Item</code>: the type to iterate over, such as <code>i8</code>,</li><li><code>IntoIter</code>: the <code>Iterator</code> type returned by the <code>into_iter</code> method.</li></ul><p>Note that <code>IntoIter</code> and <code>Item</code> are linked: the iterator must have the same <code>Item</code> type, which means that it returns <code>Option&lt;Item&gt;</code></p><p>The example iterates over all combinations of x and y coordinates.</p><p>Try iterating over the grid twice in <code>main</code>. Why does this fail? Note that <code>IntoIterator::into_iter</code> takes ownership of <code>self</code>.</p><p>Fix this issue by implementing <code>IntoIterator</code> for <code>&amp;Grid</code> and storing a reference to the <code>Grid</code> in <code>GridIter</code>.</p><p>The same problem can occur for standard library types: <code>for e in some_vector</code> will take ownership of <code>some_vector</code> and iterate over owned elements from that vector. Use <code>for e in &amp;some_vector</code> instead, to iterate over references to elements of <code>some_vector</code>.</p><h3 id="fromiterator" tabindex="-1"><a class="header-anchor" href="#fromiterator" aria-hidden="true">#</a> FromIterator</h3><p><a href="https://doc.rust-lang.org/std/iter/trait.FromIterator.html" target="_blank" rel="noopener noreferrer"><code>FromIterator</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> lets you build a collection from an <a href="https://doc.rust-lang.org/std/iter/trait.Iterator.html" target="_blank" rel="noopener noreferrer"><code>Iterator</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> primes <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> prime_squares <span class="token operator">=</span> primes
        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>prime<span class="token closure-punctuation punctuation">|</span></span> prime <span class="token operator">*</span> prime<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">&gt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;prime_squares: {prime_squares:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">collect</span><span class="token operator">&lt;</span><span class="token class-name">B</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">B</span>
<span class="token keyword">where</span>
    <span class="token class-name">B</span><span class="token punctuation">:</span> <span class="token class-name">FromIterator</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Item</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">Self</span><span class="token punctuation">:</span> <span class="token class-name">Sized</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>There are two ways to specify <code>B</code> for this method:</p><ul><li>With the “turbofish”: <code>some_iterator.collect::&lt;COLLECTION_TYPE&gt;()</code>, as shown. The <code>_</code> shorthand used here lets Rust infer the type of the <code>Vec</code> elements.</li><li>With type inference: <code>let prime_squares: Vec&lt;_&gt; = some_iterator.collect()</code>. Rewrite the example to use this form.</li></ul><p>There are basic implementations of <code>FromIterator</code> for <code>Vec</code>, <code>HashMap</code>, etc. There are also more specialized implementations which let you do cool things like convert an <code>Iterator&lt;Item = Result&lt;V, E&gt;&gt;</code> into a <code>Result&lt;Vec&lt;V&gt;, E&gt;</code>.</p><h2 id="modules" tabindex="-1"><a class="header-anchor" href="#modules" aria-hidden="true">#</a> Modules</h2><p><code>mod</code> lets us namespace types and functions:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">mod</span> <span class="token module-declaration namespace">foo</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;In the foo module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">mod</span> <span class="token module-declaration namespace">bar</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;In the bar module&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">foo<span class="token punctuation">::</span></span><span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">bar<span class="token punctuation">::</span></span><span class="token function">do_something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Packages provide functionality and include a <code>Cargo.toml</code> file that describes how to build a bundle of 1+ crates.</li><li>Crates are a tree of modules, where a binary crate creates an executable and a library crate compiles to a library.</li><li>Modules define organization, scope, and are the focus of this section.</li></ul><h3 id="filesystem-hierarchy" tabindex="-1"><a class="header-anchor" href="#filesystem-hierarchy" aria-hidden="true">#</a> Filesystem Hierarchy</h3><p>Omitting the module content will tell Rust to look for it in another file:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mod garden;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This tells rust that the <code>garden</code> module content is found at <code>src/garden.rs</code>. Similarly, a <code>garden::vegetables</code> module can be found at <code>src/garden/vegetables.rs</code>.</p><p>The <code>crate</code> root is in:</p><ul><li><code>src/lib.rs</code> (for a library crate)</li><li><code>src/main.rs</code> (for a binary crate)</li></ul><p>Modules defined in files can be documented, too, using “inner doc comments”. These document the item that contains them – in this case, a module.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token comment">//! This module implements the garden, including a highly performant germination</span>
<span class="token comment">//! implementation.</span>

<span class="token comment">// Re-export types from this module.</span>
<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">seeds<span class="token punctuation">::</span></span><span class="token class-name">SeedPacket</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">garden<span class="token punctuation">::</span></span><span class="token class-name">Garden</span><span class="token punctuation">;</span>

<span class="token comment">/// Sow the given seed packets.</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">sow</span><span class="token punctuation">(</span>seeds<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">SeedPacket</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">/// Harvest the produce in the garden that is ready.</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">harvest</span><span class="token punctuation">(</span>garden<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Garden</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token macro property">todo!</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Deeper nesting can use folders, even if the main module is a file:</p><div class="language-ignore line-numbers-mode" data-ext="ignore"><pre class="language-ignore"><code><span class="token entry string">src<span class="token punctuation">/</span></span>
<span class="token entry string">├── main.rs</span>
<span class="token entry string">├── top_module.rs</span>
<span class="token entry string">└── top_module<span class="token punctuation">/</span></span>
    <span class="token entry string">└── sub_module.rs</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>The place rust will look for modules can be changed with a compiler directive:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[path = <span class="token string">&quot;some/path.rs&quot;</span>]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">some_module</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>This is useful, for example, if you would like to place tests for a module in a file named <code>some_module_test.rs</code>, similar to the convention in Go.</p></li></ul><h3 id="visibility" tabindex="-1"><a class="header-anchor" href="#visibility" aria-hidden="true">#</a> Visibility</h3><p>Modules are a privacy boundary:</p><ul><li>Module items are private by default (hides implementation details).</li><li>Parent and sibling items are always visible.</li><li>In other words, if an item is visible in module <code>foo</code>, it’s visible in all the descendants of <code>foo</code>.</li></ul><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">mod</span> <span class="token module-declaration namespace">outer</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">private</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;outer::private&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">public</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;outer::public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">mod</span> <span class="token module-declaration namespace">inner</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">private</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;outer::inner::private&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">public</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;outer::inner::public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">super</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>private</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">outer<span class="token punctuation">::</span></span><span class="token function">public</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Use the <code>pub</code> keyword to make modules public.</li></ul><p>Additionally, there are advanced <code>pub(...)</code> specifiers to restrict the scope of public visibility.</p><ul><li>See the <a href="https://doc.rust-lang.org/reference/visibility-and-privacy.html#pubin-path-pubcrate-pubsuper-and-pubself" target="_blank" rel="noopener noreferrer">Rust Reference<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</li><li>Configuring <code>pub(crate)</code> visibility is a common pattern.</li><li>Less commonly, you can give visibility to a specific path.</li><li>In any case, visibility must be granted to an ancestor module (and all of its descendants).</li></ul><h3 id="use-super-self" tabindex="-1"><a class="header-anchor" href="#use-super-self" aria-hidden="true">#</a> use, super, self</h3><p>A module can bring symbols from another module into scope with <code>use</code>. You will typically see something like this at the top of each module:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashSet</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span>abort<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="paths" tabindex="-1"><a class="header-anchor" href="#paths" aria-hidden="true">#</a> Paths</h3><p>Paths are resolved as follows:</p><ol><li>As a relative path: <ul><li><code>foo</code> or <code>self::foo</code> refers to <code>foo</code> in the current module,</li><li><code>super::foo</code> refers to <code>foo</code> in the parent module.</li></ul></li><li>As an absolute path: <ul><li><code>crate::foo</code> refers to <code>foo</code> in the root of the current crate,</li><li><code>bar::foo</code> refers to <code>foo</code> in the <code>bar</code> crate.</li></ul></li></ol><p>It is common to “re-export” symbols at a shorter path. For example, the top-level <code>lib.rs</code> in a crate might have:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">mod</span> <span class="token module-declaration namespace">storage</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">storage<span class="token punctuation">::</span>disk<span class="token punctuation">::</span></span><span class="token class-name">DiskStorage</span><span class="token punctuation">;</span>
<span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">storage<span class="token punctuation">::</span>network<span class="token punctuation">::</span></span><span class="token class-name">NetworkStorage</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>making <code>DiskStorage</code> and <code>NetworkStorage</code> available to other crates with a convenient, short path.</p><ul><li>For the most part, only items that appear in a module need to be <code>use</code>’d. However, a trait must be in scope to call any methods on that trait, even if a type implementing that trait is already in scope. For example, to use the <code>read_to_string</code> method on a type implementing the <code>Read</code> trait, you need to <code>use std::io::Read</code>.</li><li>The <code>use</code> statement can have a wildcard: <code>use std::io::*</code>. This is discouraged because it is not clear which items are imported, and those might change over time.</li></ul><h2 id="tests" tabindex="-1"><a class="header-anchor" href="#tests" aria-hidden="true">#</a> Tests</h2><h3 id="unit-test" tabindex="-1"><a class="header-anchor" href="#unit-test" aria-hidden="true">#</a> Unit Test</h3><p>Rust and Cargo come with a simple unit test framework:</p><ul><li>Unit tests are supported throughout your code.</li><li>Integration tests are supported via the <code>tests/</code> directory.</li></ul><p>Tests are marked with <code>#[test]</code>. Unit tests are often put in a nested <code>tests</code> module, using <code>#[cfg(test)]</code> to conditionally compile them only when building tests.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">first_word</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> text<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token char">&#39; &#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&amp;</span>text<span class="token punctuation">[</span><span class="token punctuation">..</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token operator">&amp;</span>text<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">test</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">super</span><span class="token punctuation">::</span><span class="token operator">*</span><span class="token punctuation">;</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">test_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">first_word</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">test_single_word</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">first_word</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">test_multiple_words</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token function">first_word</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>This lets you unit test private helpers.</li><li>The <code>#[cfg(test)]</code> attribute is only active when you run <code>cargo test</code>.</li></ul><h3 id="integration-tests" tabindex="-1"><a class="header-anchor" href="#integration-tests" aria-hidden="true">#</a> Integration Tests</h3><p>If you want to test your library as a client, use an integration test.</p><p>Create a <code>.rs</code> file under <code>tests/</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token comment">// tests/my_library.rs</span>
<span class="token keyword">use</span> <span class="token namespace">my_library<span class="token punctuation">::</span></span>init<span class="token punctuation">;</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>These tests only have access to the public API of your crate.</p><h3 id="documentation-tests" tabindex="-1"><a class="header-anchor" href="#documentation-tests" aria-hidden="true">#</a> Documentation Tests</h3><p>Rust has built-in support for documentation tests:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token comment">/// Shortens a string to the given length.</span>
<span class="token comment">///</span>
<span class="token comment">/// ```</span>
<span class="token comment">/// # use playground::shorten_string;</span>
<span class="token comment">/// assert_eq!(shorten_string(&quot;Hello World&quot;, 5), &quot;Hello&quot;);</span>
<span class="token comment">/// assert_eq!(shorten_string(&quot;Hello World&quot;, 20), &quot;Hello World&quot;);</span>
<span class="token comment">/// ```</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">shorten_string</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span>
    <span class="token operator">&amp;</span>s<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token function">min</span><span class="token punctuation">(</span>length<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Code blocks in <code>///</code> comments are automatically seen as Rust code.</li><li>The code will be compiled and executed as part of <code>cargo test</code>.</li><li>Adding <code># </code>in the code will hide it from the docs, but will still compile/run it.</li></ul><h3 id="mock" tabindex="-1"><a class="header-anchor" href="#mock" aria-hidden="true">#</a> Mock</h3><p>For mocking, <a href="https://docs.rs/mockall/" target="_blank" rel="noopener noreferrer">Mockall<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is a widely used library. You need to refactor your code to use traits, which you can then quickly mock:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[mockall::automock]</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Pet</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">is_hungry</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> since_last_meal<span class="token punctuation">:</span> <span class="token class-name">Duration</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">bool</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[test]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">test_robot_dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> mock_dog <span class="token operator">=</span> <span class="token class-name">MockPet</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mock_dog<span class="token punctuation">.</span><span class="token function">expect_is_hungry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">return_const</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>mock_dog<span class="token punctuation">.</span><span class="token function">is_hungry</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="error-handling" tabindex="-1"><a class="header-anchor" href="#error-handling" aria-hidden="true">#</a> Error Handling</h2><p>Rust handles fatal errors with a “panic”.</p><p>Rust will trigger a panic if a fatal error happens at runtime:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;v[100]: {}&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Panics are for unrecoverable and unexpected errors. <ul><li>Panics are symptoms of bugs in the program.</li><li>Runtime failures like failed bounds checks can panic</li><li>Assertions (such as <code>assert!</code>) panic on failure</li><li>Purpose-specific panics can use the <code>panic!</code> macro.</li></ul></li><li>A panic will “unwind” the stack, dropping values just as if the functions had returned.</li><li>Use non-panicking APIs (such as <code>Vec::get</code>) if crashing is not acceptable.</li></ul><p>By default, a panic will cause the stack to unwind. The unwinding can be caught:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>panic<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">panic<span class="token punctuation">::</span></span><span class="token function">catch_unwind</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token string">&quot;No problem here!&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{result:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token namespace">panic<span class="token punctuation">::</span></span><span class="token function">catch_unwind</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;oh no!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{result:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Catching is unusual; do not attempt to implement exceptions with <code>catch_unwind</code>!</li><li>This can be useful in servers which should keep running even if a single request crashes.</li><li>This does not work if <code>panic = &#39;abort&#39;</code> is set in your <code>Cargo.toml</code>.</li></ul><h3 id="try-operator" tabindex="-1"><a class="header-anchor" href="#try-operator" aria-hidden="true">#</a> Try Operator</h3><p>Runtime errors like connection-refused or file-not-found are handled with the <code>Result</code> type, but matching this type on every call can be cumbersome. The try-operator <code>?</code> is used to return errors to the caller. It lets you turn the common</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">match</span> some_expression <span class="token punctuation">{</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">,</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>into the much simpler</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code>some_expression<span class="token operator">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>We can use this to simplify our error handling code:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fs<span class="token punctuation">,</span> io<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">read_username</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> username_file_result <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> username_file <span class="token operator">=</span> <span class="token keyword">match</span> username_file_result <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> file<span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> username <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> username_file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//fs::write(&quot;config.dat&quot;, &quot;alice&quot;).unwrap();</span>
    <span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token function">read_username</span><span class="token punctuation">(</span><span class="token string">&quot;config.dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;username or error: {username:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="try-conversions" tabindex="-1"><a class="header-anchor" href="#try-conversions" aria-hidden="true">#</a> Try Conversions</h3><p>The effective expansion of <code>?</code> is a little more complicated than previously indicated:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code>expression<span class="token operator">?</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>works the same as</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">match</span> expression <span class="token punctuation">{</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">,</span>
    <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">From</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>From::from</code> call here means we attempt to convert the error type to the type returned by the function. This makes it easy to encapsulate errors into higher-level errors.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Display</span><span class="token punctuation">,</span> <span class="token class-name">Formatter</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Read</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">ReadUsernameError</span> <span class="token punctuation">{</span>
    <span class="token class-name">IoError</span><span class="token punctuation">(</span><span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">EmptyUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Error</span> <span class="token keyword">for</span> <span class="token class-name">ReadUsernameError</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">ReadUsernameError</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">{</span>
        <span class="token keyword">match</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">IoError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;IO error: {e}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">EmptyUsername</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">&quot;Found no username in {filename}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">From</span><span class="token operator">&lt;</span><span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token class-name">ReadUsernameError</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">from</span><span class="token punctuation">(</span>err<span class="token punctuation">:</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">IoError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">read_username</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ReadUsernameError</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> username <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> username<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> username<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">ReadUsernameError</span><span class="token punctuation">::</span><span class="token class-name">EmptyUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//fs::write(&quot;config.dat&quot;, &quot;&quot;).unwrap();</span>
    <span class="token keyword">let</span> username <span class="token operator">=</span> <span class="token function">read_username</span><span class="token punctuation">(</span><span class="token string">&quot;config.dat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;username or error: {username:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>?</code> operator must return a value compatible with the return type of the function. For <code>Result</code>, it means that the error types have to be compatible. A function that returns <code>Result&lt;T, ErrorOuter&gt;</code> can only use <code>?</code> on a value of type <code>Result&lt;U, ErrorInner&gt;</code> if <code>ErrorOuter</code> and <code>ErrorInner</code> are the same type or if <code>ErrorOuter</code> implements <code>From&lt;ErrorInner&gt;</code>.</p><p>A common alternative to a <code>From</code> implementation is <code>Result::map_err</code>, especially when the conversion only happens in one place.</p><p>There is no compatibility requirement for <code>Option</code>. A function returning <code>Option&lt;T&gt;</code> can use the <code>?</code> operator on <code>Option&lt;U&gt;</code> for arbitrary <code>T</code> and <code>U</code> types.</p><p>A function that returns <code>Result</code> cannot use <code>?</code> on <code>Option</code> and vice versa. However, <code>Option::ok_or</code> converts <code>Option</code> to <code>Result</code> whereas <code>Result::ok</code> turns <code>Result</code> into <code>Option</code>.</p><h3 id="dynamic-error-types" tabindex="-1"><a class="header-anchor" href="#dynamic-error-types" aria-hidden="true">#</a> Dynamic Error Types</h3><p>Sometimes we want to allow any type of error to be returned without writing our own enum covering all the different possibilities. The <code>std::error::Error</code> trait makes it easy to create a trait object that can contain any error.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fs<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">read_count</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> count_str <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> count_str<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> count<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> count_str<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;count.dat&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;1i3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">match</span> <span class="token function">read_count</span><span class="token punctuation">(</span><span class="token string">&quot;count.dat&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Count: {count}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Error: {err}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>read_count</code> function can return <code>std::io::Error</code> (from file operations) or <code>std::num::ParseIntError</code> (from <code>String::parse</code>).</p><p>Boxing errors saves on code, but gives up the ability to cleanly handle different error cases differently in the program. As such it’s generally not a good idea to use <code>Box&lt;dyn Error&gt;</code> in the public API of a library, but it can be a good option in a program where you just want to display the error message somewhere.</p><p>Make sure to implement the <code>std::error::Error</code> trait when defining a custom error type so it can be boxed. But if you need to support the <code>no_std</code> attribute, keep in mind that the <code>std::error::Error</code> trait is currently compatible with <code>no_std</code> in <a href="https://github.com/rust-lang/rust/issues/103765" target="_blank" rel="noopener noreferrer">nightly<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> only.</p><h3 id="thiserror-and-anyhow" tabindex="-1"><a class="header-anchor" href="#thiserror-and-anyhow" aria-hidden="true">#</a> thiserror and anyhow</h3><p>The <a href="https://docs.rs/thiserror/" target="_blank" rel="noopener noreferrer"><code>thiserror</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> and <a href="https://docs.rs/anyhow/" target="_blank" rel="noopener noreferrer"><code>anyhow</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> crates are widely used to simplify error handling. <code>thiserror</code> helps create custom error types that implement <code>From&lt;T&gt;</code>. <code>anyhow</code> helps with error handling in functions, including adding contextual information to your errors.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span>bail<span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">{</span>fs<span class="token punctuation">,</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">thiserror<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Clone, Debug, Eq, Error, PartialEq)]</span>
<span class="token attribute attr-name">#[error(<span class="token string">&quot;Found no username in {0}&quot;</span>)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">EmptyUsernameError</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">read_username</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> username <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">with_capacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">with_context</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to open {path}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span>
        <span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> username<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to read&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> username<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">bail!</span><span class="token punctuation">(</span><span class="token class-name">EmptyUsernameError</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//fs::write(&quot;config.dat&quot;, &quot;&quot;).unwrap();</span>
    <span class="token keyword">match</span> <span class="token function">read_username</span><span class="token punctuation">(</span><span class="token string">&quot;config.dat&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Username: {username}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Error: {err:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="concurrency" tabindex="-1"><a class="header-anchor" href="#concurrency" aria-hidden="true">#</a> Concurrency</h2><p>Rust threads work similarly to threads in other languages:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Count in thread: {i}!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Main thread: {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Threads are all daemon threads, the main thread does not wait for them.</p></li><li><p>Thread panics are independent of each other.</p><ul><li>Panics can carry a payload, which can be unpacked with <code>downcast_ref</code>.</li></ul></li><li><p>Notice that the thread is stopped before it reaches 10 — the main thread is not waiting.</p></li><li><p>Use <code>let handle = thread::spawn(...)</code> and later <code>handle.join()</code> to wait for the thread to finish.</p></li><li><p>Trigger a panic in the thread, notice how this doesn’t affect <code>main</code>.</p></li><li><p>Use the <code>Result</code> return value from <code>handle.join()</code> to get access to the panic payload.</p></li></ul><h3 id="scoped-threads" tabindex="-1"><a class="header-anchor" href="#scoped-threads" aria-hidden="true">#</a> Scoped Threads</h3><p>Normal threads cannot borrow from their environment:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Length: {}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>However, you can use a <a href="https://doc.rust-lang.org/std/thread/fn.scope.html" target="_blank" rel="noopener noreferrer">scoped thread<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for this:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>scope<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        scope<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Length: {}&quot;</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>The reason for that is that when the <code>thread::scope</code> function completes, all the threads are guaranteed to be joined, so they can return borrowed data.</li><li>Normal Rust borrowing rules apply: you can either borrow mutably by one thread, or immutably by any number of threads.</li></ul><h3 id="channels" tabindex="-1"><a class="header-anchor" href="#channels" aria-hidden="true">#</a> Channels</h3><p>Rust channels have two parts: a <code>Sender&lt;T&gt;</code> and a <code>Receiver&lt;T&gt;</code>. The two parts are connected via the channel, but you only see the end-points.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Received: {:?}&quot;</span><span class="token punctuation">,</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Received: {:?}&quot;</span><span class="token punctuation">,</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> tx2 <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tx2<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Received: {:?}&quot;</span><span class="token punctuation">,</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>mpsc</code> stands for Multi-Producer, Single-Consumer. <code>Sender</code> and <code>SyncSender</code> implement <code>Clone</code> (so you can make multiple producers) but <code>Receiver</code> does not.</li><li><code>send()</code> and <code>recv()</code> return <code>Result</code>. If they return <code>Err</code>, it means the counterpart <code>Sender</code> or <code>Receiver</code> is dropped and the channel is closed.</li></ul><h3 id="unbounded-channels" tabindex="-1"><a class="header-anchor" href="#unbounded-channels" aria-hidden="true">#</a> Unbounded Channels</h3><p>You get an unbounded and asynchronous channel with <code>mpsc::channel()</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> thread_id <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;Message {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{thread_id:?}: sent Message {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{thread_id:?}: done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> msg <span class="token keyword">in</span> rx<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Main: got {msg}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bounded-channels" tabindex="-1"><a class="header-anchor" href="#bounded-channels" aria-hidden="true">#</a> Bounded Channels</h3><p>With bounded (synchronous) channels, <code>send</code> can block the current thread:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span>mpsc<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">sync_channel</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> thread_id <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;Message {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{thread_id:?}: sent Message {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{thread_id:?}: done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> msg <span class="token keyword">in</span> rx<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Main: got {msg}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Calling <code>send</code> will block the current thread until there is space in the channel for the new message. The thread can be blocked indefinitely if there is nobody who reads from the channel.</li><li>A call to <code>send</code> will abort with an error (that is why it returns <code>Result</code>) if the channel is closed. A channel is closed when the receiver is dropped.</li><li>A bounded channel with a size of zero is called a “rendezvous channel”. Every send will block the current thread until another thread calls <code>read</code>.</li></ul><h3 id="send-and-sync" tabindex="-1"><a class="header-anchor" href="#send-and-sync" aria-hidden="true">#</a> Send and Sync</h3><p>How does Rust know to forbid shared access across threads? The answer is in two traits:</p><ul><li><a href="https://doc.rust-lang.org/std/marker/trait.Send.html" target="_blank" rel="noopener noreferrer"><code>Send</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: a type <code>T</code> is <code>Send</code> if it is safe to move a <code>T</code> across a thread boundary.</li><li><a href="https://doc.rust-lang.org/std/marker/trait.Sync.html" target="_blank" rel="noopener noreferrer"><code>Sync</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: a type <code>T</code> is <code>Sync</code> if it is safe to move a <code>&amp;T</code> across a thread boundary.</li></ul><p><code>Send</code> and <code>Sync</code> are <a href="https://google.github.io/comprehensive-rust/unsafe/unsafe-traits.html" target="_blank" rel="noopener noreferrer">unsafe traits<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. The compiler will automatically derive them for your types as long as they only contain <code>Send</code> and <code>Sync</code> types. You can also implement them manually when you know it is valid.</p><h4 id="send" tabindex="-1"><a class="header-anchor" href="#send" aria-hidden="true">#</a> Send</h4><p>A type <code>T</code> is <a href="https://doc.rust-lang.org/std/marker/trait.Send.html" target="_blank" rel="noopener noreferrer"><code>Send</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> if it is safe to move a <code>T</code> value to another thread.</p><p>The effect of moving ownership to another thread is that <em>destructors</em> will run in that thread. So the question is when you can allocate a value in one thread and deallocate it in another.</p><h4 id="sync" tabindex="-1"><a class="header-anchor" href="#sync" aria-hidden="true">#</a> Sync</h4><p>A type <code>T</code> is <a href="https://doc.rust-lang.org/std/marker/trait.Sync.html" target="_blank" rel="noopener noreferrer"><code>Sync</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> if it is safe to access a <code>T</code> value from multiple threads at the same time.</p><p>More precisely, the definition is:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>T` is `Sync` if and only if `&amp;T` is `Send
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This statement is essentially a shorthand way of saying that if a type is thread-safe for shared use, it is also thread-safe to pass references of it across threads.</p><p>This is because if a type is Sync it means that it can be shared across multiple threads without the risk of data races or other synchronization issues, so it is safe to move it to another thread. A reference to the type is also safe to move to another thread, because the data it references can be accessed from any thread safely.</p><h2 id="shared-state" tabindex="-1"><a class="header-anchor" href="#shared-state" aria-hidden="true">#</a> Shared State</h2><h3 id="arc" tabindex="-1"><a class="header-anchor" href="#arc" aria-hidden="true">#</a> Arc</h3><p><a href="https://doc.rust-lang.org/std/sync/struct.Arc.html" target="_blank" rel="noopener noreferrer"><code>Arc</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> allows shared read-only access via <code>Arc::clone</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Arc</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> handles <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        handles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> thread_id <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{thread_id:?}: {v:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    handles<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>h<span class="token closure-punctuation punctuation">|</span></span> h<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;v: {v:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>Arc</code> stands for “Atomic Reference Counted”, a thread safe version of <code>Rc</code> that uses atomic operations.</li><li><code>Arc&lt;T&gt;</code> implements <code>Clone</code> whether or not <code>T</code> does. It implements <code>Send</code> and <code>Sync</code> if and only if <code>T</code> implements them both.</li><li><code>Arc::clone()</code> has the cost of atomic operations that get executed, but after that the use of the <code>T</code> is free.</li><li>Beware of reference cycles, <code>Arc</code>does not use a garbage collector to detect them. <ul><li><code>std::sync::Weak</code> can help.</li></ul></li></ul><h3 id="mutex" tabindex="-1"><a class="header-anchor" href="#mutex" aria-hidden="true">#</a> Mutex</h3><p><a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html" target="_blank" rel="noopener noreferrer"><code>Mutex</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ensures mutual exclusion <em>and</em> allows mutable access to <code>T</code> behind a read-only interface:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;v: {:?}&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> guard <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        guard<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;v: {:?}&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Notice how we have a <a href="https://doc.rust-lang.org/std/sync/struct.Mutex.html#impl-Sync-for-Mutex" target="_blank" rel="noopener noreferrer"><code>impl Sync for Mutex</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> blanket implementation.</p><ul><li><code>Mutex</code> in Rust looks like a collection with just one element — the protected data. <ul><li>It is not possible to forget to acquire the mutex before accessing the protected data.</li></ul></li><li>You can get an <code>&amp;mut T</code> from an <code>&amp;Mutex&lt;T&gt;</code> by taking the lock. The <code>MutexGuard</code> ensures that the <code>&amp;mut T</code> doesn’t outlive the lock being held.</li><li><code>Mutex&lt;T&gt;</code> implements both <code>Send</code> and <code>Sync</code> iff (if and only if) <code>T</code> implements <code>Send</code>.</li><li>A read-write lock counterpart: <code>RwLock</code>.</li></ul><h2 id="async" tabindex="-1"><a class="header-anchor" href="#async" aria-hidden="true">#</a> Async</h2><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>executor<span class="token punctuation">::</span></span>block_on<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">count_to</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span>count <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Count is: {i}!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">async_main</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">count_to</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">async_main</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Note that this is a simplified example to show the syntax. There is no long running operation or any real concurrency in it!</li><li>What is the return type of an async call? <ul><li>Use <code>let future: () = async_main(10);</code> in <code>main</code> to see the type.</li></ul></li><li>The “async” keyword is syntactic sugar. The compiler replaces the return type with a future.</li><li>You cannot make <code>main</code> async, without additional instructions to the compiler on how to use the returned future.</li><li>You need an executor to run async code. <code>block_on</code> blocks the current thread until the provided future has run to completion.</li><li><code>.await</code> asynchronously waits for the completion of another operation. Unlike <code>block_on</code>, <code>.await</code> doesn’t block the current thread.</li><li><code>.await</code> can only be used inside an <code>async</code> function (or block; these are introduced later).</li></ul><h3 id="futures" tabindex="-1"><a class="header-anchor" href="#futures" aria-hidden="true">#</a> Futures</h3><p><a href="https://doc.rust-lang.org/std/future/trait.Future.html" target="_blank" rel="noopener noreferrer"><code>Future</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> is a trait, implemented by objects that represent an operation that may not be complete yet. A future can be polled, and <code>poll</code> returns a <a href="https://doc.rust-lang.org/std/task/enum.Poll.html" target="_blank" rel="noopener noreferrer"><code>Poll</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>pin<span class="token punctuation">::</span></span><span class="token class-name">Pin</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span><span class="token class-name">Context</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Future</span> <span class="token punctuation">{</span>
    <span class="token keyword">type</span> <span class="token type-definition class-name">Output</span><span class="token punctuation">;</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">poll</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">:</span> <span class="token class-name">Pin</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">Self</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> cx<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Context</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">&#39;_</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Poll</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Output</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">Poll</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">Ready</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token class-name">Pending</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>An async function returns an <code>impl Future</code>. It’s also possible (but uncommon) to implement <code>Future</code> for your own types. For example, the <code>JoinHandle</code> returned from <code>tokio::spawn</code> implements <code>Future</code> to allow joining to it.</p><p>The <code>.await</code> keyword, applied to a Future, causes the current async function to pause until that Future is ready, and then evaluates to its output.</p><ul><li>he <code>Future</code> and <code>Poll</code> types are implemented exactly as shown; click the links to show the implementations in the docs.</li><li>We will not get to <code>Pin</code> and <code>Context</code>, as we will focus on writing async code, rather than building new async primitives. Briefly: <ul><li><code>Context</code> allows a Future to schedule itself to be polled again when an event occurs.</li><li><code>Pin</code> ensures that the Future isn’t moved in memory, so that pointers into that future remain valid. This is required to allow references to remain valid after an <code>.await</code>.</li></ul></li></ul><h3 id="runtimes" tabindex="-1"><a class="header-anchor" href="#runtimes" aria-hidden="true">#</a> Runtimes</h3><p>A <em>runtime</em> provides support for performing operations asynchronously (a <em>reactor</em>) and is responsible for executing futures (an <em>executor</em>). Rust does not have a “built-in” runtime, but several options are available:</p><ul><li><a href="https://tokio.rs/" target="_blank" rel="noopener noreferrer">Tokio<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: performant, with a well-developed ecosystem of functionality like <a href="https://hyper.rs/" target="_blank" rel="noopener noreferrer">Hyper<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for HTTP or <a href="https://github.com/hyperium/tonic" target="_blank" rel="noopener noreferrer">Tonic<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for gRPC.</li><li><a href="https://async.rs/" target="_blank" rel="noopener noreferrer">async-std<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: aims to be a “std for async”, and includes a basic runtime in <code>async::task</code>.</li><li><a href="https://docs.rs/smol/latest/smol/" target="_blank" rel="noopener noreferrer">smol<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>: simple and lightweight</li></ul><p>Several larger applications have their own runtimes. For example, <a href="https://fuchsia.googlesource.com/fuchsia/+/refs/heads/main/src/lib/fuchsia-async/src/lib.rs" target="_blank" rel="noopener noreferrer">Fuchsia<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> already has one.</p><h4 id="tokio" tabindex="-1"><a class="header-anchor" href="#tokio" aria-hidden="true">#</a> Tokio</h4><p>Tokio provides:</p><ul><li>A multi-threaded runtime for executing asynchronous code.</li><li>An asynchronous version of the standard library.</li><li>A large ecosystem of libraries.</li></ul><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span></span>time<span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">count_to</span><span class="token punctuation">(</span>count<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..=</span>count <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Count in task: {i}!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">time<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token namespace">time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token function">count_to</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Main task: {i}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token namespace">time<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token namespace">time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tasks" tabindex="-1"><a class="header-anchor" href="#tasks" aria-hidden="true">#</a> Tasks</h3><p>Rust has a task system, which is a form of lightweight threading.</p><p>A task has a single top-level future which the executor polls to make progress. That future may have one or more nested futures that its <code>poll</code> method polls, corresponding loosely to a call stack. Concurrency within a task is possible by polling multiple child futures, such as racing a timer and an I/O operation.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">AsyncReadExt</span><span class="token punctuation">,</span> <span class="token class-name">AsyncWriteExt</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>net<span class="token punctuation">::</span></span><span class="token class-name">TcpListener</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> listener <span class="token operator">=</span> <span class="token class-name">TcpListener</span><span class="token punctuation">::</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:6142&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;listening on port 6142&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span><span class="token keyword">mut</span> socket<span class="token punctuation">,</span> addr<span class="token punctuation">)</span> <span class="token operator">=</span> listener<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>

        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;connection from {addr:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">write_all</span><span class="token punctuation">(</span><span class="token string">b&quot;Who are you?\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;socket error: {e:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">let</span> <span class="token keyword">mut</span> buf <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> reply <span class="token operator">=</span> <span class="token keyword">match</span> socket<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buf<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">[</span><span class="token punctuation">..</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;Thanks for dialing in, {name}!\n&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;socket error: {e:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> socket<span class="token punctuation">.</span><span class="token function">write_all</span><span class="token punctuation">(</span>reply<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;socket error: {e:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="async-channels" tabindex="-1"><a class="header-anchor" href="#async-channels" aria-hidden="true">#</a> Async Channels</h3><p>Several crates have support for asynchronous channels. For instance <code>tokio</code>:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>sync<span class="token punctuation">::</span>mpsc<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Receiver</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">ping_handler</span><span class="token punctuation">(</span><span class="token keyword">mut</span> input<span class="token punctuation">:</span> <span class="token class-name">Receiver</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> count<span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Received {count} pings so far.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;ping_handler complete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>sender<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> ping_handler_task <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token function">ping_handler</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span> <span class="token punctuation">{</span>
        sender<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to send ping.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Sent {} pings so far.&quot;</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">drop</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ping_handler_task<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Something went wrong in ping handler task.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="futures-control-flow" tabindex="-1"><a class="header-anchor" href="#futures-control-flow" aria-hidden="true">#</a> Futures Control Flow</h3><p>Futures can be combined together to produce concurrent compute flow graphs. We have already seen tasks, that function as independent threads of execution.</p><h4 id="join" tabindex="-1"><a class="header-anchor" href="#join" aria-hidden="true">#</a> Join</h4><p>A join operation waits until all of a set of futures are ready, and returns a collection of their results. This is similar to <code>Promise.all</code> in JavaScript or <code>asyncio.gather</code> in Python.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span></span>future<span class="token punctuation">;</span>
<span class="token keyword">use</span> reqwest<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">size_of_page</span><span class="token punctuation">(</span>url<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> urls<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">;</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;https://google.com&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;https://httpbin.org/ip&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;https://play.rust-lang.org/&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;BAD_URL&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> futures_iter <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>size_of_page<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token namespace">future<span class="token punctuation">::</span></span><span class="token function">join_all</span><span class="token punctuation">(</span>futures_iter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> page_sizes_dict<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=</span>
        urls<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">zip</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> page_sizes_dict<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="select" tabindex="-1"><a class="header-anchor" href="#select" aria-hidden="true">#</a> Select</h4><p>A select operation waits until any of a set of futures is ready, and responds to that future’s result. In JavaScript, this is similar to <code>Promise.race</code>. In Python, it compares to <code>asyncio.wait(task_set, return_when=asyncio.FIRST_COMPLETED)</code>.</p><p>Similar to a match statement, the body of <code>select!</code> has a number of arms, each of the form <code>pattern = future =&gt; statement</code>. When the <code>future</code> is ready, the <code>statement</code> is executed with the variables in <code>pattern</code> bound to the <code>future</code>’s result.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>sync<span class="token punctuation">::</span>mpsc<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">Receiver</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token punctuation">{</span>sleep<span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token class-name">Cat</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">Dog</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">first_animal_to_finish_race</span><span class="token punctuation">(</span>
    <span class="token keyword">mut</span> cat_rcv<span class="token punctuation">:</span> <span class="token class-name">Receiver</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">mut</span> dog_rcv<span class="token punctuation">:</span> <span class="token class-name">Receiver</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Animal</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token macro property">select!</span> <span class="token punctuation">{</span>
        cat_name <span class="token operator">=</span> cat_rcv<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">::</span><span class="token class-name">Cat</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> cat_name<span class="token operator">?</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        dog_name <span class="token operator">=</span> dog_rcv<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Animal</span><span class="token punctuation">::</span><span class="token class-name">Dog</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> dog_name<span class="token operator">?</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>cat_sender<span class="token punctuation">,</span> cat_receiver<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>dog_sender<span class="token punctuation">,</span> dog_receiver<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
        cat_sender
            <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Felix&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span>
            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to send cat.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
        dog_sender
            <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;Rex&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span>
            <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to send dog.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> winner <span class="token operator">=</span> <span class="token function">first_animal_to_finish_race</span><span class="token punctuation">(</span>cat_receiver<span class="token punctuation">,</span> dog_receiver<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">await</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to receive winner&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Winner is {winner:?}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pitfalls-of-async-await" tabindex="-1"><a class="header-anchor" href="#pitfalls-of-async-await" aria-hidden="true">#</a> Pitfalls of async/await</h2><h3 id="blocking-the-executor" tabindex="-1"><a class="header-anchor" href="#blocking-the-executor" aria-hidden="true">#</a> Blocking the executor</h3><p>Most async runtimes only allow IO tasks to run concurrently. This means that CPU blocking tasks will block the executor and prevent other tasks from being executed. An easy workaround is to use async equivalent methods where possible.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">futures<span class="token punctuation">::</span>future<span class="token punctuation">::</span></span>join_all<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">sleep_ms</span><span class="token punctuation">(</span>start<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Instant</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span> duration_ms<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span>duration_ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;future {id} slept for {duration_ms}ms, finished after {}ms&quot;</span><span class="token punctuation">,</span>
        start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main(flavor = <span class="token string">&quot;current_thread&quot;</span>)]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> sleep_futures <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>t<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">sleep_ms</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>start<span class="token punctuation">,</span> t<span class="token punctuation">,</span> t <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">join_all</span><span class="token punctuation">(</span>sleep_futures<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="pin" tabindex="-1"><a class="header-anchor" href="#pin" aria-hidden="true">#</a> Pin</h3><p>When you await a future, all local variables (that would ordinarily be stored on a stack frame) are instead stored in the Future for the current async block. If your future has pointers to data on the stack, those pointers might get invalidated. This is unsafe.</p><p>Therefore, you must guarantee that the addresses your future points to don’t change. That is why we need to “pin” futures. Using the same future repeatedly in a <code>select!</code> often leads to issues with pinned values.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token punctuation">{</span>mpsc<span class="token punctuation">,</span> oneshot<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>task<span class="token punctuation">::</span></span>spawn<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token punctuation">{</span>sleep<span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// A work item. In this case, just sleep for the given time and respond</span>
<span class="token comment">// with a message on the `respond_on` channel.</span>
<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Work</span> <span class="token punctuation">{</span>
    input<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    respond_on<span class="token punctuation">:</span> <span class="token namespace">oneshot<span class="token punctuation">::</span></span><span class="token class-name">Sender</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// A worker which listens for work on a queue and performs it.</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">worker</span><span class="token punctuation">(</span><span class="token keyword">mut</span> work_queue<span class="token punctuation">:</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token class-name">Receiver</span><span class="token operator">&lt;</span><span class="token class-name">Work</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> iterations <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
        <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token macro property">select!</span> <span class="token punctuation">{</span>
            <span class="token class-name">Some</span><span class="token punctuation">(</span>work<span class="token punctuation">)</span> <span class="token operator">=</span> work_queue<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span> <span class="token comment">// Pretend to work.</span>
                work<span class="token punctuation">.</span>respond_on
                    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>work<span class="token punctuation">.</span>input <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;failed to send response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                iterations <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// TODO: report number of iterations every 100ms</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// A requester which requests work and waits for it to complete.</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">do_work</span><span class="token punctuation">(</span>work_queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token class-name">Sender</span><span class="token operator">&lt;</span><span class="token class-name">Work</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> input<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">oneshot<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    work_queue
        <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token class-name">Work</span> <span class="token punctuation">{</span>
            input<span class="token punctuation">,</span>
            respond_on<span class="token punctuation">:</span> tx<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token keyword">await</span>
        <span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;failed to send on work queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rx<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">&quot;failed waiting for response&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">mpsc<span class="token punctuation">::</span></span><span class="token function">channel</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token function">worker</span><span class="token punctuation">(</span>rx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">100</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token function">do_work</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tx<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;work result for iteration {i}: {resp}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="async-traits" tabindex="-1"><a class="header-anchor" href="#async-traits" aria-hidden="true">#</a> Async Traits</h3><p>Async methods in traits are not yet supported in the stable channel (<a href="https://blog.rust-lang.org/inside-rust/2022/11/17/async-fn-in-trait-nightly.html" target="_blank" rel="noopener noreferrer">An experimental feature exists in nightly and should be stabilized in the mid term.<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>)</p><p>The crate <a href="https://docs.rs/async-trait/latest/async_trait/" target="_blank" rel="noopener noreferrer">async_trait<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> provides a workaround through a macro:</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">async_trait<span class="token punctuation">::</span></span>async_trait<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token punctuation">{</span>sleep<span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[async_trait]</span>
<span class="token keyword">trait</span> <span class="token type-definition class-name">Sleeper</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">sleep</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">FixedSleeper</span> <span class="token punctuation">{</span>
    sleep_ms<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[async_trait]</span>
<span class="token keyword">impl</span> <span class="token class-name">Sleeper</span> <span class="token keyword">for</span> <span class="token class-name">FixedSleeper</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">sleep</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>sleep_ms<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">run_all_sleepers_multiple_times</span><span class="token punctuation">(</span>sleepers<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Sleeper</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> n_times<span class="token punctuation">:</span> <span class="token keyword">usize</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>n_times <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;running all sleepers..&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> sleeper <span class="token keyword">in</span> <span class="token operator">&amp;</span>sleepers <span class="token punctuation">{</span>
            <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sleeper<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;slept for {}ms&quot;</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_millis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> sleepers<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Sleeper</span><span class="token operator">&gt;&gt;</span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
        <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">FixedSleeper</span> <span class="token punctuation">{</span> sleep_ms<span class="token punctuation">:</span> <span class="token number">50</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">FixedSleeper</span> <span class="token punctuation">{</span> sleep_ms<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">run_all_sleepers_multiple_times</span><span class="token punctuation">(</span>sleepers<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cancellation" tabindex="-1"><a class="header-anchor" href="#cancellation" aria-hidden="true">#</a> Cancellation</h3><p>Dropping a future implies it can never be polled again. This is called <em>cancellation</em> and it can occur at any <code>await</code> point. Care is needed to ensure the system works correctly even when futures are cancelled. For example, it shouldn’t deadlock or lose data.</p><div class="language-rust line-numbers-mode" data-ext="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token class-name">ErrorKind</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">tokio<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">AsyncReadExt</span><span class="token punctuation">,</span> <span class="token class-name">AsyncWriteExt</span><span class="token punctuation">,</span> <span class="token class-name">DuplexStream</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">LinesReader</span> <span class="token punctuation">{</span>
    stream<span class="token punctuation">:</span> <span class="token class-name">DuplexStream</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">LinesReader</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>stream<span class="token punctuation">:</span> <span class="token class-name">DuplexStream</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span> stream <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">next</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> bytes <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token keyword">mut</span> buf <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token keyword">self</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buf<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            bytes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">b&#39;\n&#39;</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> bytes<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">InvalidData</span><span class="token punctuation">,</span> <span class="token string">&quot;not UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">slow_copy</span><span class="token punctuation">(</span>source<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">mut</span> dest<span class="token punctuation">:</span> <span class="token class-name">DuplexStream</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> b <span class="token keyword">in</span> source<span class="token punctuation">.</span><span class="token function">bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dest<span class="token punctuation">.</span><span class="token function">write_u8</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>client<span class="token punctuation">,</span> server<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token function">duplex</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token function">slow_copy</span><span class="token punctuation">(</span><span class="token string">&quot;hi\nthere\n&quot;</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> client<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> lines <span class="token operator">=</span> <span class="token class-name">LinesReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> interval <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">loop</span> <span class="token punctuation">{</span>
        <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token macro property">select!</span> <span class="token punctuation">{</span>
            _ <span class="token operator">=</span> interval<span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;tick!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            line <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span> <span class="token operator">=</span> line<span class="token operator">?</span> <span class="token punctuation">{</span>
                <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    handle<span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="reference" tabindex="-1"><a class="header-anchor" href="#reference" aria-hidden="true">#</a> Reference</h3><ol><li><a href="https://www.rust-lang.org/learn/get-started" target="_blank" rel="noopener noreferrer">Rust<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> official site</li><li><a href="https://google.github.io/comprehensive-rust" target="_blank" rel="noopener noreferrer">https://google.github.io/comprehensive-rust<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://doc.rust-lang.org/book" target="_blank" rel="noopener noreferrer">https://doc.rust-lang.org/book<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ol></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><!----></div></footer><!----><div class="waline-wrapper" id="comment" darkmode="false" style="display:block;"><div data-waline provider="Waline"><!--v-if--><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">昵称</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">邮箱</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">网址</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="请留言。(填写邮箱可在被回复时收到邮件提醒)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>预览:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="表情" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="表情包"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="上传图片"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="预览"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if-->  字</div><button type="button" class="wl-btn">登录</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->提交<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="搜索表情包"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> 评论</div><ul class="wl-sort"><!--[--><li class="active">按正序</li><li class="">按倒序</li><li class="">按热度</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><div class="wl-power"> Powered by <a href="https://github.com/walinejs/waline" target="_blank" rel="noopener noreferrer"> Waline </a> v2.15.2</div></div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Powered by <a href="https://v2.vuepress.vuejs.org/">Vuepress-next</a> and <a href="https://theme-hope.vuejs.press/">Theme-hope</a></div><div class="copyright">Copyright ©2021-present Kesa</div></footer></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-0294952b.js" defer></script>
  </body>
</html>
