(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{652:function(_,v,t){_.exports=t.p+"assets/img/format,png.c5be51e1.png"},653:function(_,v,t){_.exports=t.p+"assets/img/format,png-16500101709586.9c82a442.png"},778:function(_,v,t){"use strict";t.r(v);var s=t(5),a=Object(s.a)({},(function(){var _=this,v=_.$createElement,s=_._self._c||v;return s("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[s("h2",{attrs:{id:"_1-tcp-三次握手和四次挥手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-tcp-三次握手和四次挥手"}},[_._v("#")]),_._v(" 1. TCP 三次握手和四次挥手")]),_._v(" "),s("h3",{attrs:{id:"三次握手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三次握手"}},[_._v("#")]),_._v(" 三次握手")]),_._v(" "),s("p",[s("img",{attrs:{src:t(652),alt:"三次握手"}})]),_._v(" "),s("ol",[s("li",[_._v("客户端发送"),s("strong",[_._v("连接请求报文（SYN = 1，seq = x）")]),_._v("，客户端进入 SYN-SENT （"),s("strong",[_._v("同步已发送")]),_._v("）状态。"),s("mark",[_._v("TCP 规定，SYN 报文（SYN = 1），不能携带数据，但需要消耗一个序列号。")])]),_._v(" "),s("li",[_._v("TCP 服务器收到请求报文后，若同意连接，则发出"),s("strong",[_._v("确认报文（SYN = 1，ACK = 1，ack = x+1，seq = y）")]),_._v("， TCP 服务器进入 **SYN-RCVD （同步接收）**状态。"),s("mark",[_._v("此报文无法携带数据，需要消耗一个序列号。")])]),_._v(" "),s("li",[_._v("TCP 客户端收到后，向服务器发送"),s("strong",[_._v("确认报文（ACK = 1， ack = y+1，seq = x+1）")]),_._v("。此时连接建立，客户端进入"),s("strong",[_._v("连接已建立 （ESTABLISHED）状态")]),_._v("。"),s("mark",[_._v("此报文可携带数据，若无数据则不消耗序列号")]),_._v("。")]),_._v(" "),s("li",[_._v("当服务器收到客户端的确认报文后，进入**连接已建立（ESTABLISHED）**状态。")])]),_._v(" "),s("h3",{attrs:{id:"为何需要三次握手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为何需要三次握手"}},[_._v("#")]),_._v(" 为何需要三次握手")]),_._v(" "),s("p",[_._v("确认双方的"),s("strong",[_._v("接收和发送均正常")]),_._v("和"),s("strong",[_._v("防止")]),_._v("滞留的连接报文到达服务器，"),s("strong",[_._v("建立无效连接")]),_._v("导致资源浪费。")]),_._v(" "),s("ol",[s("li",[_._v("客户端发送连接请求报文 （SYN = 1，seq = x），服务端接收。\n"),s("ul",[s("li",[_._v("C: 无法确认状态；")]),_._v(" "),s("li",[_._v("S: 确认 C 端发送正常，S 端接收正常；")])])]),_._v(" "),s("li",[_._v("服务端发送确认报文 （SYN = 1，ACK = 1，ack = x+1，seq = y），客户端接收。\n"),s("ul",[s("li",[_._v("C: 确认 C 端发送和接收正常，S 端发送和接收正常；")]),_._v(" "),s("li",[_._v("S: 无法确认状态；")])])]),_._v(" "),s("li",[_._v("客户端发送确认报文 （ACK = 1，seq = x+1，ack = y+1），服务端接收。\n"),s("ul",[s("li",[_._v("C: 无需确认状态；")]),_._v(" "),s("li",[_._v("S: 确认 C 端接收正常，S 端发送正常；")])])])]),_._v(" "),s("h3",{attrs:{id:"四次挥手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四次挥手"}},[_._v("#")]),_._v(" 四次挥手")]),_._v(" "),s("p",[s("img",{attrs:{src:t(653),alt:"四次挥手"}})]),_._v(" "),s("ol",[s("li",[_._v("客户端发送"),s("strong",[_._v("连接释放报文（FIN = 1，seq = u）")]),_._v("，停止发送数据，进入 **终止等待-1（FIN-WAIT-1）**状态。"),s("mark",[_._v("TCP 规定，FIN 报文即使不携带数据也要消耗一个序号")]),_._v("。")]),_._v(" "),s("li",[_._v("服务端接收后，发送"),s("strong",[_._v("确认报文（ACK = 1，ack = u+1，seq = v）")]),_._v("，服务端进入 **关闭等待（CLOSE-WAIT）**状态。")]),_._v(" "),s("li",[_._v("客户端接收后，进入**终止等待-2（FIN-WAIT-2）**状态。此时可以接收服务器报文。")]),_._v(" "),s("li",[_._v("服务器数据发送完毕后，发送"),s("strong",[_._v("连接释放报文（FIN = 1，ACK = 1，ack = u+1，seq = w）")]),_._v("，服务器进入**最后确认（LAST-ACK）**状态。")]),_._v(" "),s("li",[_._v("客户端收到服务器后，发出确认报文（ACK = 1，ack = w+1，seq = u+1）。此时，客户端进入 **TIME-WAIT （时间等待）**状态。客户端在经过 "),s("strong",[_._v("2MSL")]),_._v("（最长报文寿命） 后才会进入 "),s("strong",[_._v("CLOSED")]),_._v(" 状态。")]),_._v(" "),s("li",[_._v("服务端接收到了确认报文，就会进入 "),s("strong",[_._v("CLOSED")]),_._v(" 状态。")])]),_._v(" "),s("h3",{attrs:{id:"为何等待-2msl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为何等待-2msl"}},[_._v("#")]),_._v(" 为何等待 2MSL")]),_._v(" "),s("p",[_._v("确保服务器能够收到连接释放的确认报文。若客户端发送的 ACK 报文没有被收到，则服务端会重新发送 FIN + ACK 报文。客户端收到并发送 ACK 后，再次进入 TIME-WAIT 状态。")]),_._v(" "),s("h3",{attrs:{id:"为何需要四次握手"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为何需要四次握手"}},[_._v("#")]),_._v(" 为何需要四次握手")]),_._v(" "),s("p",[_._v("基于 TCP 的半关闭（half-close）的特性。")]),_._v(" "),s("p",[_._v("客户端发送连接释放的通知后进入半关闭状态（不发送，只接受），服务端发送完数据后，通知连接释放，此时 TCP 进入关闭状态。")])])}),[],!1,null,null,null);v.default=a.exports}}]);