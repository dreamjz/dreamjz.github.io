import{_ as l,Z as o,$ as i,a0 as s,a1 as n,a2 as e,a4 as t,H as p}from"./framework-d03928c9.js";const r={},c={href:"https://draveness.me/golang",target:"_blank",rel:"noopener noreferrer"},m={href:"https://draveness.me/golang/docs/part2-foundation/ch03-datastructure/golang-hashmap/",target:"_blank",rel:"noopener noreferrer"},h=t('<ol><li>装载因子达到 6.5</li><li>溢出桶过多</li></ol><p>我想到了两个问题：</p><ol><li>装载因子为什么是 6.5，不能选择其他数字么？</li><li>溢出桶过多，判断标准是什么，怎样才算过多？</li></ol><p>带着疑问查询相关资料，并作了总结，代码使用<code>gov1.18</code>。</p><h2 id="_1-触发扩容的装载因子值为什么是-6-5" tabindex="-1"><a class="header-anchor" href="#_1-触发扩容的装载因子值为什么是-6-5" aria-hidden="true">#</a> 1. 触发扩容的装载因子值为什么是 6.5</h2>',5),d={href:"https://github.com/golang/go/blob/release-branch.go1.18/src/runtime/map.go",target:"_blank",rel:"noopener noreferrer"},u=s("code",null,"runtime/map.go",-1),g=t(`<div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>// Picking loadFactor: too large and we have lots of overflow
// buckets, too small and we waste a lot of space. I wrote
// a simple program to check some stats for different loads:
// (64-bit, 8 byte keys and elems)
//  loadFactor    %overflow  bytes/entry     hitprobe    missprobe
//        4.00         2.13        20.77         3.00         4.00
//        4.50         4.05        17.30         3.25         4.50
//        5.00         6.85        14.77         3.50         5.00
//        5.50        10.55        12.94         3.75         5.50
//        6.00        15.27        11.67         4.00         6.00
//        6.50        20.90        10.79         4.25         6.50
//        7.00        27.14        10.15         4.50         7.00
//        7.50        34.03         9.73         4.75         7.50
//        8.00        41.10         9.40         5.00         8.00
//
// %overflow   = percentage of buckets which have an overflow bucket
// bytes/entry = overhead bytes used per key/elem pair
// hitprobe    = # of entries to check when looking up a present key
// missprobe   = # of entries to check when looking up an absent key
//
// Keep in mind this data is for maximally loaded tables, i.e. just
// before the table grows. Typical tables will be somewhat less loaded.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="装载因子和溢出桶比率的关系" tabindex="-1"><a class="header-anchor" href="#装载因子和溢出桶比率的关系" aria-hidden="true">#</a> 装载因子和溢出桶比率的关系</h3><p>对于溢出桶的比例<code>%overflow</code>，由上可以看出，在装载因子在6.5之后，溢出桶的比例扩大速度会增加（相较于6.5之前）。将数据进行简单的多项式拟合可以的出以下图表：</p><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202309251915130.png" alt="image-20230925191511240" tabindex="0" loading="lazy"><figcaption>image-20230925191511240</figcaption></figure><p>由上图可以看出，装载因子在6.5之后，溢出桶的变化速率明显加快。</p><h3 id="装载因子和键值对占用字节数的关系" tabindex="-1"><a class="header-anchor" href="#装载因子和键值对占用字节数的关系" aria-hidden="true">#</a> 装载因子和键值对占用字节数的关系</h3><p>若将装载因子<code>loadFactor</code>和<code>bytes/entry</code>进行简单的拟合：</p><figure><img src="https://raw.githubusercontent.com/dreamjz/pics/main/pics/2023/202309251921270.png" alt="image-20230925192144940" tabindex="0" loading="lazy"><figcaption>image-20230925192144940</figcaption></figure><p>由上图可以看出当装载因子超过6.5时，键值对所占用的内存大小的增大比率明显放缓；若选取较小的装载因子进行扩容，会导致较多的空闲容量无法利用。</p><h3 id="装载因子与hitprobe和missprobe的关系" tabindex="-1"><a class="header-anchor" href="#装载因子与hitprobe和missprobe的关系" aria-hidden="true">#</a> 装载因子与<code>hitprobe</code>和<code>missprobe</code>的关系</h3><p>随着装载因子的增长，<code>hitprobe</code>和<code>missprobe</code>均为线性的，不会出现明显的波动。</p><h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h3><p><strong>触发扩容的装载因子值为6.5，是根据实验数据，平衡空间利用率和溢出桶数量的结果</strong></p><h2 id="_2-触发扩容的溢出桶数量是多少" tabindex="-1"><a class="header-anchor" href="#_2-触发扩容的溢出桶数量是多少" aria-hidden="true">#</a> 2. 触发扩容的溢出桶数量是多少</h2>`,14),v={href:"https://github.com/golang/go/blob/release-branch.go1.18/src/runtime/map.go#L1090",target:"_blank",rel:"noopener noreferrer"},b=s("code",null,"runtime.tooManyOverflowBuckets",-1),k=t(`<div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// tooManyOverflowBuckets reports whether noverflow buckets is too many for a map with 1&lt;&lt;B buckets.</span>
<span class="token comment">// Note that most of these overflow buckets must be in sparse use;</span>
<span class="token comment">// if use was dense, then we&#39;d have already triggered regular map growth.</span>
<span class="token keyword">func</span> <span class="token function">tooManyOverflowBuckets</span><span class="token punctuation">(</span>noverflow <span class="token builtin">uint16</span><span class="token punctuation">,</span> B <span class="token builtin">uint8</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
	<span class="token comment">// If the threshold is too low, we do extraneous work.</span>
	<span class="token comment">// If the threshold is too high, maps that grow and shrink can hold on to lots of unused memory.</span>
	<span class="token comment">// &quot;too many&quot; means (approximately) as many overflow buckets as regular buckets.</span>
	<span class="token comment">// See incrnoverflow for more details.</span>
	<span class="token keyword">if</span> B <span class="token operator">&gt;</span> <span class="token number">15</span> <span class="token punctuation">{</span>
		B <span class="token operator">=</span> <span class="token number">15</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// The compiler doesn&#39;t see here that B &lt; 16; mask B to generate shorter shift code.</span>
	<span class="token keyword">return</span> noverflow <span class="token operator">&gt;=</span> <span class="token function">uint16</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>B<span class="token operator">&amp;</span><span class="token number">15</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由注释中的</p><blockquote><p>&quot;too many&quot; means (approximately) as many overflow buckets as regular buckets.</p></blockquote><p>可以得出：<strong>“太多”的意思是溢出桶的数量（近似）和正常桶的数量一样多</strong></p>`,4),f=s("p",null,[n("此处有个值得关注的点，就是以正常桶的数量为 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"15")])]),s("annotation",{encoding:"application/x-tex"},"2^{15}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"15")])])])])])])])])])])]),n(" 为界，有不同的处理：")],-1),w=s("ol",null,[s("li",null,[n("当正常桶的数量小于等于 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"15")])]),s("annotation",{encoding:"application/x-tex"},"2^{15}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"15")])])])])])])])])])])]),n("时，直接比较溢出桶的数量（此时是准确值）和正常桶数量，大于等于则判定溢出桶过多")]),s("li",null,[n("当正常桶的数量大于 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"15")])]),s("annotation",{encoding:"application/x-tex"},"2^{15}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"15")])])])])])])])])])])]),n("时，将比较溢出桶的数量（此时是近似值）和 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"15")])]),s("annotation",{encoding:"application/x-tex"},"2^{15}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"15")])])])])])])])])])])]),n("，大于等于则判定溢出桶过多")])],-1),y={href:"https://github.com/golang/go/blob/release-branch.go1.18/src/runtime/map.go#L227",target:"_blank",rel:"noopener noreferrer"},_=s("code",null,"runtime.incroverflow",-1),x=t(`<div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token comment">// incrnoverflow increments h.noverflow.</span>
<span class="token comment">// noverflow counts the number of overflow buckets.</span>
<span class="token comment">// This is used to trigger same-size map growth.</span>
<span class="token comment">// See also tooManyOverflowBuckets.</span>
<span class="token comment">// To keep hmap small, noverflow is a uint16.</span>
<span class="token comment">// When there are few buckets, noverflow is an exact count.</span>
<span class="token comment">// When there are many buckets, noverflow is an approximate count.</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>hmap<span class="token punctuation">)</span> <span class="token function">incrnoverflow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// We trigger same-size map growth if there are</span>
	<span class="token comment">// as many overflow buckets as buckets.</span>
	<span class="token comment">// We need to be able to count to 1&lt;&lt;h.B.</span>
	<span class="token keyword">if</span> h<span class="token punctuation">.</span>B <span class="token operator">&lt;</span> <span class="token number">16</span> <span class="token punctuation">{</span>
		h<span class="token punctuation">.</span>noverflow<span class="token operator">++</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Increment with probability 1/(1&lt;&lt;(h.B-15)).</span>
	<span class="token comment">// When we reach 1&lt;&lt;15 - 1, we will have approximately</span>
	<span class="token comment">// as many overflow buckets as buckets.</span>
	mask <span class="token operator">:=</span> <span class="token function">uint32</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>B<span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
	<span class="token comment">// Example: if h.B == 18, then mask == 7,</span>
	<span class="token comment">// and fastrand &amp; 7 == 0 with probability 1/8.</span>
	<span class="token keyword">if</span> <span class="token function">fastrand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>mask <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
		h<span class="token punctuation">.</span>noverflow<span class="token operator">++</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看出：</p>`,2),z=s("ol",null,[s("li",null,[n("当桶的数量小于 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"16")])]),s("annotation",{encoding:"application/x-tex"},"2^{16}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"16")])])])])])])])])])])]),n("时，溢出桶的数量将直接增加，此时溢出桶的数量是"),s("strong",null,"准确值")]),s("li",null,[n("当桶的数量大于 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"16")])]),s("annotation",{encoding:"application/x-tex"},"2^{16}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"16")])])])])])])])])])])]),n("时，溢出桶的数量只有"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mfrac",null,[s("mn",null,"1"),s("mn",null,"8")])]),s("annotation",{encoding:"application/x-tex"},"\\frac{1}{8}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1901em","vertical-align":"-0.345em"}}),s("span",{class:"mord"},[s("span",{class:"mopen nulldelimiter"}),s("span",{class:"mfrac"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8451em"}},[s("span",{style:{top:"-2.655em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"8")])])]),s("span",{style:{top:"-3.23em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),s("span",{style:{top:"-3.394em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"1")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.345em"}},[s("span")])])])]),s("span",{class:"mclose nulldelimiter"})])])])]),n("的概率增加，此时溢出桶的数量是"),s("strong",null,"近似值")])],-1),M={href:"https://github.com/golang/go/blob/release-branch.go1.18/src/runtime/stubs.go#L126",target:"_blank",rel:"noopener noreferrer"},B=s("code",null,"fastrand",-1),L={href:"https://en.wikipedia.org/wiki/Xorshift",target:"_blank",rel:"noopener noreferrer"},q=s("code",null,"Xorshift RNGs",-1),I=s("p",null,[n("也就是说当桶的数量大于 "),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"16")])]),s("annotation",{encoding:"application/x-tex"},"2^{16}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"16")])])])])])])])])])])]),n("时，此时溢出桶的数量增加概率只有"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("mfrac",null,[s("mn",null,"1"),s("mn",null,"8")])]),s("annotation",{encoding:"application/x-tex"},"\\frac{1}{8}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"1.1901em","vertical-align":"-0.345em"}}),s("span",{class:"mord"},[s("span",{class:"mopen nulldelimiter"}),s("span",{class:"mfrac"},[s("span",{class:"vlist-t vlist-t2"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8451em"}},[s("span",{style:{top:"-2.655em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"8")])])]),s("span",{style:{top:"-3.23em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"frac-line",style:{"border-bottom-width":"0.04em"}})]),s("span",{style:{top:"-3.394em"}},[s("span",{class:"pstrut",style:{height:"3em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"1")])])])]),s("span",{class:"vlist-s"},"​")]),s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.345em"}},[s("span")])])])]),s("span",{class:"mclose nulldelimiter"})])])])]),n("，若此时溢出桶的数量（近似值）大于等于"),s("span",{class:"katex"},[s("span",{class:"katex-mathml"},[s("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[s("semantics",null,[s("mrow",null,[s("msup",null,[s("mn",null,"2"),s("mn",null,"15")])]),s("annotation",{encoding:"application/x-tex"},"2^{15}")])])]),s("span",{class:"katex-html","aria-hidden":"true"},[s("span",{class:"base"},[s("span",{class:"strut",style:{height:"0.8141em"}}),s("span",{class:"mord"},[s("span",{class:"mord"},"2"),s("span",{class:"msupsub"},[s("span",{class:"vlist-t"},[s("span",{class:"vlist-r"},[s("span",{class:"vlist",style:{height:"0.8141em"}},[s("span",{style:{top:"-3.063em","margin-right":"0.05em"}},[s("span",{class:"pstrut",style:{height:"2.7em"}}),s("span",{class:"sizing reset-size6 size3 mtight"},[s("span",{class:"mord mtight"},[s("span",{class:"mord mtight"},"15")])])])])])])])])])])]),n("，说明其"),s("strong",null,"准确值"),n("可能超出这个数很多，可以"),s("strong",null,"近似"),n("的认为和正常桶的数量相同了。")],-1),N=s("h3",{id:"小结-1",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#小结-1","aria-hidden":"true"},"#"),n(" 小结")],-1),T=s("p",null,[s("strong",null,"当溢出桶的数量和正常桶的数量（近似）相同时，会被认为有着过多的溢出桶")],-1),W=s("h2",{id:"reference",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#reference","aria-hidden":"true"},"#"),n(" Reference")],-1),E={href:"https://arachnoid.com/polysolve/",target:"_blank",rel:"noopener noreferrer"},O={href:"https://draveness.me/golang",target:"_blank",rel:"noopener noreferrer"},V={href:"https://github.com/golang/go/blob/release-branch.go1.18",target:"_blank",rel:"noopener noreferrer"},X={href:"https://en.wikipedia.org/wiki/Xorshift",target:"_blank",rel:"noopener noreferrer"};function j(F,S){const a=p("ExternalLinkIcon");return o(),i("div",null,[s("p",null,[n("在阅读了"),s("a",c,[n("Go 语言设计与实现"),e(a)]),n("的"),s("a",m,[n("3.3 哈希表实现原理"),e(a)]),n("之后，了解到哈希表的扩容有两个触发条件：")]),h,s("p",null,[s("a",d,[u,e(a)]),n("的注释中有说明不同的装载因子对于哈希表的性能影响：")]),g,s("p",null,[n("溢出桶数量是否过多由函数"),s("a",v,[b,e(a)]),n("判断：")]),k,f,w,s("p",null,[n("上述条件中出现了近似值，是因为溢出桶的数量计算也有两种不同的情况，根据函数"),s("a",y,[_,e(a)]),n(":")]),x,z,s("p",null,[n("其中的"),s("a",M,[B,e(a)]),n("是采用"),s("a",L,[q,e(a)]),n("生成的伪随机数。")]),I,N,T,W,s("ol",null,[s("li",null,[s("a",E,[n("https://arachnoid.com/polysolve/"),e(a)])]),s("li",null,[s("a",O,[n("https://draveness.me/golang"),e(a)])]),s("li",null,[s("a",V,[n("https://github.com/golang/go/blob/release-branch.go1.18"),e(a)])]),s("li",null,[s("a",X,[n("https://en.wikipedia.org/wiki/Xorshift"),e(a)])])])])}const R=l(r,[["render",j],["__file","01.2.why_hmap_overflowthreshold_loadfactory.html.vue"]]);export{R as default};
